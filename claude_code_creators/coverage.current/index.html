<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Claude code creators</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.13.2/application.js' type='text/javascript'></script>
    <link href='./assets/0.13.2/application.css' media='screen, projection, print' rel='stylesheet' type='text/css' />
    <link rel="icon" type="image/png" href="./assets/0.13.2/favicon_yellow.png" />
  </head>

  <body data-branch-coverage=true>
    <div id="loading">
      <img src="./assets/0.13.2/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" class="hide">
      <div class="timestamp">Generated <abbr class="timeago" title="2025-08-02T05:28:49-07:00">2025-08-02T05:28:49-07:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent">
      <span class="yellow">
  82.21%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         12.29
       </span>
    </span> hits/line
    )
  </h2>

  <a name="AllFiles"></a>

  <div>
    <b>66</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>3339</b> relevant lines,
    <span class="green"><b>2745</b> lines covered</span> and
    <span class="red"><b>594</b> lines missed. </span>
    (<span class="yellow">
  82.21%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>991</b> total branches, </span>
      <span class="green"><b>644</b> branches covered</span> and
      <span class="red"><b>347</b> branches missed.</span>
      (<span class="red">
  64.98%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a75ab60e4e485cc2bdd28d362d741292c524ff0d" class="src_link" title="app/channels/cloud_sync_channel.rb">app/channels/cloud_sync_channel.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.29 %</td>
            <td class="cell--number">102</td>
            <td class="cell--number">34</td>
            <td class="cell--number">29</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2.85</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0172f96d73c29e139b3ee226cdd1c5fa9503aa7b" class="src_link" title="app/channels/presence_channel.rb">app/channels/presence_channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">325</td>
            <td class="cell--number">130</td>
            <td class="cell--number">104</td>
            <td class="cell--number">26</td>
            <td class="cell--number">4.86</td>
            
              <td class="red strong cell--number t-file__branch-coverage">56.00 %</td>
              <td class="cell--number">50</td>
              <td class="cell--number">28</td>
              <td class="cell--number">22</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#474830fcfd38153c38b6080bb7700cc649fc1a45" class="src_link" title="app/channels/sub_agent_channel.rb">app/channels/sub_agent_channel.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">42</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">65.00 %</td>
              <td class="cell--number">20</td>
              <td class="cell--number">13</td>
              <td class="cell--number">7</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc0574b5a4278eed5d8ca3e907ea59108013c01a" class="src_link" title="app/components/cloud_file_browser_component.rb">app/components/cloud_file_browser_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.96 %</td>
            <td class="cell--number">274</td>
            <td class="cell--number">119</td>
            <td class="cell--number">113</td>
            <td class="cell--number">6</td>
            <td class="cell--number">9.87</td>
            
              <td class="red strong cell--number t-file__branch-coverage">71.43 %</td>
              <td class="cell--number">35</td>
              <td class="cell--number">25</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6553a17182f72672beee3f9b8eece952599a92c5" class="src_link" title="app/components/cloud_file_item_component.rb">app/components/cloud_file_item_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.70 %</td>
            <td class="cell--number">281</td>
            <td class="cell--number">132</td>
            <td class="cell--number">125</td>
            <td class="cell--number">7</td>
            <td class="cell--number">35.07</td>
            
              <td class="red strong cell--number t-file__branch-coverage">78.33 %</td>
              <td class="cell--number">60</td>
              <td class="cell--number">47</td>
              <td class="cell--number">13</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9f6b0098c5fe22ff8b465a84bedfa3974de9f09c" class="src_link" title="app/components/cloud_provider_component.rb">app/components/cloud_provider_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.31 %</td>
            <td class="cell--number">156</td>
            <td class="cell--number">77</td>
            <td class="cell--number">68</td>
            <td class="cell--number">9</td>
            <td class="cell--number">16.48</td>
            
              <td class="red strong cell--number t-file__branch-coverage">67.86 %</td>
              <td class="cell--number">56</td>
              <td class="cell--number">38</td>
              <td class="cell--number">18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#81e992361caa0f2b2ff9aaac25882a2ed124ce3a" class="src_link" title="app/components/cloud_sync_status_component.rb">app/components/cloud_sync_status_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">79.43 %</td>
            <td class="cell--number">282</td>
            <td class="cell--number">141</td>
            <td class="cell--number">112</td>
            <td class="cell--number">29</td>
            <td class="cell--number">4.73</td>
            
              <td class="red strong cell--number t-file__branch-coverage">52.17 %</td>
              <td class="cell--number">69</td>
              <td class="cell--number">36</td>
              <td class="cell--number">33</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2ba6c1c0063afea732d6f5fd19caa1f69dc693c4" class="src_link" title="app/components/context_item_preview_component.rb">app/components/context_item_preview_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.32 %</td>
            <td class="cell--number">193</td>
            <td class="cell--number">71</td>
            <td class="cell--number">62</td>
            <td class="cell--number">9</td>
            <td class="cell--number">15.04</td>
            
              <td class="red strong cell--number t-file__branch-coverage">51.92 %</td>
              <td class="cell--number">52</td>
              <td class="cell--number">27</td>
              <td class="cell--number">25</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dead27ca8943d78ebb74a74b94091caa9a0ae291" class="src_link" title="app/components/context_sidebar_component.rb">app/components/context_sidebar_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">75.00 %</td>
            <td class="cell--number">162</td>
            <td class="cell--number">76</td>
            <td class="cell--number">57</td>
            <td class="cell--number">19</td>
            <td class="cell--number">20.50</td>
            
              <td class="red strong cell--number t-file__branch-coverage">41.94 %</td>
              <td class="cell--number">31</td>
              <td class="cell--number">13</td>
              <td class="cell--number">18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#69078d0012a08dad4a026120e51bf8bad9a8d62e" class="src_link" title="app/components/document_layout_component.rb">app/components/document_layout_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.00 %</td>
            <td class="cell--number">311</td>
            <td class="cell--number">100</td>
            <td class="cell--number">84</td>
            <td class="cell--number">16</td>
            <td class="cell--number">10.64</td>
            
              <td class="red strong cell--number t-file__branch-coverage">64.29 %</td>
              <td class="cell--number">42</td>
              <td class="cell--number">27</td>
              <td class="cell--number">15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b917806e1ca293e6dc3d73405198258535507596" class="src_link" title="app/components/editor_component.rb">app/components/editor_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.45 %</td>
            <td class="cell--number">218</td>
            <td class="cell--number">44</td>
            <td class="cell--number">42</td>
            <td class="cell--number">2</td>
            <td class="cell--number">4.66</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">5</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8bc1e653222dd123de33e8892ebf772595d9bb86" class="src_link" title="app/components/onboarding_modal_component.rb">app/components/onboarding_modal_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.61 %</td>
            <td class="cell--number">393</td>
            <td class="cell--number">72</td>
            <td class="cell--number">71</td>
            <td class="cell--number">1</td>
            <td class="cell--number">21.06</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">84.21 %</td>
              <td class="cell--number">19</td>
              <td class="cell--number">16</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc4b58719725b017623a42220ce1fd45e395f1ef" class="src_link" title="app/components/presence_indicator_component.rb">app/components/presence_indicator_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">154</td>
            <td class="cell--number">135</td>
            <td class="cell--number">0</td>
            <td class="cell--number">135</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#028c72ff24c7cfc72c1a18514708dc1504fc4403" class="src_link" title="app/components/sidebar_navigation_component.rb">app/components/sidebar_navigation_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">305</td>
            <td class="cell--number">68</td>
            <td class="cell--number">68</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31.65</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">86.36 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">19</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#59cb3317309d061a8bd8387a3489de96a0441d0f" class="src_link" title="app/components/sub_agent_conversation_component.rb">app/components/sub_agent_conversation_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">70</td>
            <td class="cell--number">56</td>
            <td class="cell--number">14</td>
            <td class="cell--number">9.24</td>
            
              <td class="red strong cell--number t-file__branch-coverage">44.00 %</td>
              <td class="cell--number">25</td>
              <td class="cell--number">11</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8af5866dd5bda3c53d98d9e2f1be63fb349d7efe" class="src_link" title="app/components/sub_agent_merge_component.rb">app/components/sub_agent_merge_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.98 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">57</td>
            <td class="cell--number">53</td>
            <td class="cell--number">4</td>
            <td class="cell--number">21.30</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#90dea76b9ac0901befa27c98f81ad9edfe3c7a18" class="src_link" title="app/components/sub_agent_sidebar_component.rb">app/components/sub_agent_sidebar_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">82.61 %</td>
            <td class="cell--number">109</td>
            <td class="cell--number">46</td>
            <td class="cell--number">38</td>
            <td class="cell--number">8</td>
            <td class="cell--number">20.57</td>
            
              <td class="red strong cell--number t-file__branch-coverage">47.37 %</td>
              <td class="cell--number">19</td>
              <td class="cell--number">9</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#509a5126627d08b461277fa7c3f57ad3dbf16155" class="src_link" title="app/components/theme_toggle_component.rb">app/components/theme_toggle_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">31</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.55</td>
            
              <td class="red strong cell--number t-file__branch-coverage">80.00 %</td>
              <td class="cell--number">15</td>
              <td class="cell--number">12</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fd43c3c57b68a64d92a2e94ea3de05dc174064fb" class="src_link" title="app/components/widget_drop_zone_component.rb">app/components/widget_drop_zone_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.77 %</td>
            <td class="cell--number">237</td>
            <td class="cell--number">71</td>
            <td class="cell--number">68</td>
            <td class="cell--number">3</td>
            <td class="cell--number">9.79</td>
            
              <td class="green strong cell--number t-file__branch-coverage">95.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">23</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a1a0e0279edb377f02af71fff78395d5dfb05002" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15.09</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#02bcdf60229f29a8a1e8d8614a00a6f623837551" class="src_link" title="app/controllers/cloud_files_controller.rb">app/controllers/cloud_files_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">47</td>
            <td class="cell--number">47</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.96</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">10</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a5b0690d8fd08a7b69bd7f4b0ae41638fbe7858e" class="src_link" title="app/controllers/cloud_integrations_controller.rb">app/controllers/cloud_integrations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.39 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">62</td>
            <td class="cell--number">61</td>
            <td class="cell--number">1</td>
            <td class="cell--number">4.77</td>
            
              <td class="green strong cell--number t-file__branch-coverage">95.45 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">21</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08af0401a099b034b4fe32e0e6e57c01a31380d8" class="src_link" title="app/controllers/concerns/authentication.rb">app/controllers/concerns/authentication.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">54</td>
            <td class="cell--number">31</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">55.10</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">5</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2195c3eeb15905c94d002efbb38ca925de2a9d2d" class="src_link" title="app/controllers/context_items_controller.rb">app/controllers/context_items_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">63.74 %</td>
            <td class="cell--number">226</td>
            <td class="cell--number">91</td>
            <td class="cell--number">58</td>
            <td class="cell--number">33</td>
            <td class="cell--number">3.58</td>
            
              <td class="red strong cell--number t-file__branch-coverage">20.00 %</td>
              <td class="cell--number">20</td>
              <td class="cell--number">4</td>
              <td class="cell--number">16</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d51bb8329b08172d69a22c0b7e98f2bb37bf852a" class="src_link" title="app/controllers/documents_controller.rb">app/controllers/documents_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.55 %</td>
            <td class="cell--number">102</td>
            <td class="cell--number">55</td>
            <td class="cell--number">52</td>
            <td class="cell--number">3</td>
            <td class="cell--number">4.25</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ca7c3f0f61fd64ed1092ce6cb9a06f11d9bcaa04" class="src_link" title="app/controllers/passwords_controller.rb">app/controllers/passwords_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.56</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#21eea85fc05e25472814743b8717e5a6539e13de" class="src_link" title="app/controllers/profiles_controller.rb">app/controllers/profiles_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3ffe10daf7f398fb7c45ec9318a650b6518e3b0c" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">39.13 %</td>
            <td class="cell--number">94</td>
            <td class="cell--number">46</td>
            <td class="cell--number">18</td>
            <td class="cell--number">28</td>
            <td class="cell--number">19.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">31.25 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">5</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6a8e8aeb6a859d71d3dc4e475f6aed4105502dc5" class="src_link" title="app/controllers/sub_agent_messages_controller.rb">app/controllers/sub_agent_messages_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">59</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.27</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#71cec14f6ad7722b00d7102cd69bdb0c6db4461c" class="src_link" title="app/controllers/sub_agents_controller.rb">app/controllers/sub_agents_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">77.10 %</td>
            <td class="cell--number">323</td>
            <td class="cell--number">131</td>
            <td class="cell--number">101</td>
            <td class="cell--number">30</td>
            <td class="cell--number">3.15</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">12</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cf8c00c065354e7edaf4304862decb9de847b6ad" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#46f40025f2d1a3d953973a74f0b57230cf0ef9db" class="src_link" title="app/controllers/welcome_controller.rb">app/controllers/welcome_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#298241307ed5132a76fd4bf970864ba298d08175" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">16</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0</td>
            <td class="cell--number">24.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#148c2fad3751cf16725df6b6f3a484309449ae90" class="src_link" title="app/helpers/context_items_helper.rb">app/helpers/context_items_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">157</td>
            <td class="cell--number">41</td>
            <td class="cell--number">41</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.22</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">23</td>
              <td class="cell--number">23</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ce9a466bae444d81c433d3ccbd420ebd203665ba" class="src_link" title="app/helpers/documents_helper.rb">app/helpers/documents_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c1c0f0687a2737a2cd8ea3ce563c041d3dd54630" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#17dd9072bc5a60001be68d54c77859e78c75f4ca" class="src_link" title="app/helpers/welcome_helper.rb">app/helpers/welcome_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#11802d3c53048302530fec92f70140e9d9ed5adc" class="src_link" title="app/jobs/claude_interaction_job.rb">app/jobs/claude_interaction_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">153</td>
            <td class="cell--number">58</td>
            <td class="cell--number">58</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.19</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">9</td>
              <td class="cell--number">9</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2d682f6c98c08a07fe7846522e021f1700000c90" class="src_link" title="app/jobs/cloud_file_import_job.rb">app/jobs/cloud_file_import_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.59 %</td>
            <td class="cell--number">220</td>
            <td class="cell--number">74</td>
            <td class="cell--number">70</td>
            <td class="cell--number">4</td>
            <td class="cell--number">8.04</td>
            
              <td class="red strong cell--number t-file__branch-coverage">63.64 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">14</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9f4dd05c24e4000df241d01d9b7eacccc61013da" class="src_link" title="app/jobs/cloud_file_sync_job.rb">app/jobs/cloud_file_sync_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.74 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">19</td>
            <td class="cell--number">18</td>
            <td class="cell--number">1</td>
            <td class="cell--number">9.63</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">5</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1f796e4b5f54d54763ad50fba18b565a66482909" class="src_link" title="app/mailers/passwords_mailer.rb">app/mailers/passwords_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#146d601a09491ded86b6aaad770eb1400b8e0fee" class="src_link" title="app/mailers/user_mailer.rb">app/mailers/user_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#034a5aa80fb18b74f39bb6c0025409f7fc5eb571" class="src_link" title="app/models/claude_context.rb">app/models/claude_context.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">46</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.61</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0141795328646f5a66fb9fa4c3bc7e9f9b0343e9" class="src_link" title="app/models/claude_message.rb">app/models/claude_message.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">67</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d6a1a7c90d96046925ea96e792709af8e156b195" class="src_link" title="app/models/claude_session.rb">app/models/claude_session.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.04</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">1</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f247494b799178d822e6f4b54c00f6e041ad6d71" class="src_link" title="app/models/cloud_file.rb">app/models/cloud_file.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">103</td>
            <td class="cell--number">46</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35.72</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d3a7c68d63f0ce32c4d5a35fd88e7e69e9be8eeb" class="src_link" title="app/models/cloud_integration.rb">app/models/cloud_integration.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.30 %</td>
            <td class="cell--number">75</td>
            <td class="cell--number">37</td>
            <td class="cell--number">36</td>
            <td class="cell--number">1</td>
            <td class="cell--number">28.19</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">6</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e2b0015ebb717c359bcd97bd1a7e64196cc44205" class="src_link" title="app/models/context_item.rb">app/models/context_item.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">111</td>
            <td class="cell--number">54</td>
            <td class="cell--number">54</td>
            <td class="cell--number">0</td>
            <td class="cell--number">26.70</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.44 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">17</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#55fac10793d5593b05efd25be44023da23f0496b" class="src_link" title="app/models/current.rb">app/models/current.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">73.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a1eb5483be4b4001589984bc5a3f19dbb93515aa" class="src_link" title="app/models/document.rb">app/models/document.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">136</td>
            <td class="cell--number">60</td>
            <td class="cell--number">60</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.57</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">81.25 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">13</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0f2edfdd6864454a1e6f442482823bd5bd0659c0" class="src_link" title="app/models/document_version.rb">app/models/document_version.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.02 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">43</td>
            <td class="cell--number">40</td>
            <td class="cell--number">3</td>
            <td class="cell--number">7.72</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">10</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#046d7a50e945f59c90c42c0b485356f369da096b" class="src_link" title="app/models/identity.rb">app/models/identity.rb</a></td>
            <td class="red strong cell--number t-file__coverage">55.56 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">9</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">6.11</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#74f115f9844b516ec62d50719d135eedc1cadbcf" class="src_link" title="app/models/session.rb">app/models/session.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#494b0aceb82b6972ebd60455c121582ccfa02279" class="src_link" title="app/models/sub_agent.rb">app/models/sub_agent.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">182</td>
            <td class="cell--number">90</td>
            <td class="cell--number">80</td>
            <td class="cell--number">10</td>
            <td class="cell--number">30.53</td>
            
              <td class="red strong cell--number t-file__branch-coverage">80.00 %</td>
              <td class="cell--number">20</td>
              <td class="cell--number">16</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#091d018c57e564910ac4993725f73fe7cca94575" class="src_link" title="app/models/sub_agent_message.rb">app/models/sub_agent_message.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">62</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.12</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8f31e0dd08a399d5e262d7187972ada946e410cb" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27.78</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">1</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04d664c6b250f4ceb1543a7dd094fabc8b2281ca" class="src_link" title="app/policies/application_policy.rb">app/policies/application_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">27</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#288d62f2a7c5e48d17e085fc93101503f4461083" class="src_link" title="app/policies/context_item_policy.rb">app/policies/context_item_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7.71</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b150ecee3a5557ba72077e50e07ca704a8ca886c" class="src_link" title="app/policies/document_policy.rb">app/policies/document_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.77 %</td>
            <td class="cell--number">71</td>
            <td class="cell--number">31</td>
            <td class="cell--number">30</td>
            <td class="cell--number">1</td>
            <td class="cell--number">17.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4cd7e23bc5c50bd2ef364b6ff90a7a488a5e4a85" class="src_link" title="app/policies/sub_agent_policy.rb">app/policies/sub_agent_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">20</td>
            <td class="cell--number">19</td>
            <td class="cell--number">1</td>
            <td class="cell--number">7.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c462efa6723942ffd0dd9f5bba5bc334edab43ee" class="src_link" title="app/services/claude_service.rb">app/services/claude_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.92 %</td>
            <td class="cell--number">174</td>
            <td class="cell--number">65</td>
            <td class="cell--number">63</td>
            <td class="cell--number">2</td>
            <td class="cell--number">10.40</td>
            
              <td class="red strong cell--number t-file__branch-coverage">68.75 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">11</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2b560731d0e2360c0fea28ebc1c08a7fe670213d" class="src_link" title="app/services/cloud_services/base_service.rb">app/services/cloud_services/base_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.28 %</td>
            <td class="cell--number">129</td>
            <td class="cell--number">58</td>
            <td class="cell--number">57</td>
            <td class="cell--number">1</td>
            <td class="cell--number">4.36</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d7326628ecfcc07fd1c3e1f6dce5521fc4f4f7de" class="src_link" title="app/services/cloud_services/dropbox_service.rb">app/services/cloud_services/dropbox_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">24.59 %</td>
            <td class="cell--number">228</td>
            <td class="cell--number">61</td>
            <td class="cell--number">15</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0.98</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">21</td>
              <td class="cell--number">0</td>
              <td class="cell--number">21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#695fe6fa6edefe2dfb1769f99ca069b20a91426b" class="src_link" title="app/services/cloud_services/google_drive_service.rb">app/services/cloud_services/google_drive_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.83 %</td>
            <td class="cell--number">211</td>
            <td class="cell--number">58</td>
            <td class="cell--number">55</td>
            <td class="cell--number">3</td>
            <td class="cell--number">5.03</td>
            
              <td class="red strong cell--number t-file__branch-coverage">71.43 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">10</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#efc6940cc6ca4ef58691ecccc8cf69a418dc6233" class="src_link" title="app/services/cloud_services/notion_service.rb">app/services/cloud_services/notion_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">17.65 %</td>
            <td class="cell--number">352</td>
            <td class="cell--number">119</td>
            <td class="cell--number">21</td>
            <td class="cell--number">98</td>
            <td class="cell--number">0.88</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">53</td>
              <td class="cell--number">0</td>
              <td class="cell--number">53</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#61186a6d864ccc7ef45640587372542da21e7749" class="src_link" title="app/services/sub_agent_service.rb">app/services/sub_agent_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.77 %</td>
            <td class="cell--number">150</td>
            <td class="cell--number">71</td>
            <td class="cell--number">68</td>
            <td class="cell--number">3</td>
            <td class="cell--number">6.10</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent">
      <span class="red">
  78.5%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         8.32
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Controllers"></a>

  <div>
    <b>13</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>572</b> relevant lines,
    <span class="green"><b>449</b> lines covered</span> and
    <span class="red"><b>123</b> lines missed. </span>
    (<span class="red">
  78.5%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>116</b> total branches, </span>
      <span class="green"><b>80</b> branches covered</span> and
      <span class="red"><b>36</b> branches missed.</span>
      (<span class="red">
  68.97%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a1a0e0279edb377f02af71fff78395d5dfb05002" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">24</td>
            <td class="cell--number">11</td>
            <td class="cell--number">11</td>
            <td class="cell--number">0</td>
            <td class="cell--number">15.09</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#02bcdf60229f29a8a1e8d8614a00a6f623837551" class="src_link" title="app/controllers/cloud_files_controller.rb">app/controllers/cloud_files_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">47</td>
            <td class="cell--number">47</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.96</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">10</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a5b0690d8fd08a7b69bd7f4b0ae41638fbe7858e" class="src_link" title="app/controllers/cloud_integrations_controller.rb">app/controllers/cloud_integrations_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.39 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">62</td>
            <td class="cell--number">61</td>
            <td class="cell--number">1</td>
            <td class="cell--number">4.77</td>
            
              <td class="green strong cell--number t-file__branch-coverage">95.45 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">21</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#08af0401a099b034b4fe32e0e6e57c01a31380d8" class="src_link" title="app/controllers/concerns/authentication.rb">app/controllers/concerns/authentication.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">54</td>
            <td class="cell--number">31</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">55.10</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">5</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2195c3eeb15905c94d002efbb38ca925de2a9d2d" class="src_link" title="app/controllers/context_items_controller.rb">app/controllers/context_items_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">63.74 %</td>
            <td class="cell--number">226</td>
            <td class="cell--number">91</td>
            <td class="cell--number">58</td>
            <td class="cell--number">33</td>
            <td class="cell--number">3.58</td>
            
              <td class="red strong cell--number t-file__branch-coverage">20.00 %</td>
              <td class="cell--number">20</td>
              <td class="cell--number">4</td>
              <td class="cell--number">16</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d51bb8329b08172d69a22c0b7e98f2bb37bf852a" class="src_link" title="app/controllers/documents_controller.rb">app/controllers/documents_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.55 %</td>
            <td class="cell--number">102</td>
            <td class="cell--number">55</td>
            <td class="cell--number">52</td>
            <td class="cell--number">3</td>
            <td class="cell--number">4.25</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">7</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ca7c3f0f61fd64ed1092ce6cb9a06f11d9bcaa04" class="src_link" title="app/controllers/passwords_controller.rb">app/controllers/passwords_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">18</td>
            <td class="cell--number">18</td>
            <td class="cell--number">0</td>
            <td class="cell--number">4.56</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">4</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#21eea85fc05e25472814743b8717e5a6539e13de" class="src_link" title="app/controllers/profiles_controller.rb">app/controllers/profiles_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">23</td>
            <td class="cell--number">23</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#3ffe10daf7f398fb7c45ec9318a650b6518e3b0c" class="src_link" title="app/controllers/sessions_controller.rb">app/controllers/sessions_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">39.13 %</td>
            <td class="cell--number">94</td>
            <td class="cell--number">46</td>
            <td class="cell--number">18</td>
            <td class="cell--number">28</td>
            <td class="cell--number">19.67</td>
            
              <td class="red strong cell--number t-file__branch-coverage">31.25 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">5</td>
              <td class="cell--number">11</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6a8e8aeb6a859d71d3dc4e475f6aed4105502dc5" class="src_link" title="app/controllers/sub_agent_messages_controller.rb">app/controllers/sub_agent_messages_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">59</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.27</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#71cec14f6ad7722b00d7102cd69bdb0c6db4461c" class="src_link" title="app/controllers/sub_agents_controller.rb">app/controllers/sub_agents_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">77.10 %</td>
            <td class="cell--number">323</td>
            <td class="cell--number">131</td>
            <td class="cell--number">101</td>
            <td class="cell--number">30</td>
            <td class="cell--number">3.15</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">12</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#cf8c00c065354e7edaf4304862decb9de847b6ad" class="src_link" title="app/controllers/users_controller.rb">app/controllers/users_controller.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">34</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0</td>
            <td class="cell--number">28</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#46f40025f2d1a3d953973a74f0b57230cf0ef9db" class="src_link" title="app/controllers/welcome_controller.rb">app/controllers/welcome_controller.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">3</td>
            <td class="cell--number">3</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Channels">
  <h2>
    <span class="group_name">Channels</span>
    (<span class="covered_percent">
      <span class="yellow">
  84.95%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         4.58
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Channels"></a>

  <div>
    <b>3</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>206</b> relevant lines,
    <span class="green"><b>175</b> lines covered</span> and
    <span class="red"><b>31</b> lines missed. </span>
    (<span class="yellow">
  84.95%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>86</b> total branches, </span>
      <span class="green"><b>55</b> branches covered</span> and
      <span class="red"><b>31</b> branches missed.</span>
      (<span class="red">
  63.95%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a75ab60e4e485cc2bdd28d362d741292c524ff0d" class="src_link" title="app/channels/cloud_sync_channel.rb">app/channels/cloud_sync_channel.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">85.29 %</td>
            <td class="cell--number">102</td>
            <td class="cell--number">34</td>
            <td class="cell--number">29</td>
            <td class="cell--number">5</td>
            <td class="cell--number">2.85</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0172f96d73c29e139b3ee226cdd1c5fa9503aa7b" class="src_link" title="app/channels/presence_channel.rb">app/channels/presence_channel.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">325</td>
            <td class="cell--number">130</td>
            <td class="cell--number">104</td>
            <td class="cell--number">26</td>
            <td class="cell--number">4.86</td>
            
              <td class="red strong cell--number t-file__branch-coverage">56.00 %</td>
              <td class="cell--number">50</td>
              <td class="cell--number">28</td>
              <td class="cell--number">22</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#474830fcfd38153c38b6080bb7700cc649fc1a45" class="src_link" title="app/channels/sub_agent_channel.rb">app/channels/sub_agent_channel.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">105</td>
            <td class="cell--number">42</td>
            <td class="cell--number">42</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.10</td>
            
              <td class="red strong cell--number t-file__branch-coverage">65.00 %</td>
              <td class="cell--number">20</td>
              <td class="cell--number">13</td>
              <td class="cell--number">7</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent">
      <span class="green">
  96.46%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         22.6
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Models"></a>

  <div>
    <b>14</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>508</b> relevant lines,
    <span class="green"><b>490</b> lines covered</span> and
    <span class="red"><b>18</b> lines missed. </span>
    (<span class="green">
  96.46%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>108</b> total branches, </span>
      <span class="green"><b>91</b> branches covered</span> and
      <span class="red"><b>17</b> branches missed.</span>
      (<span class="yellow">
  84.26%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#034a5aa80fb18b74f39bb6c0025409f7fc5eb571" class="src_link" title="app/models/claude_context.rb">app/models/claude_context.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">46</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.61</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0141795328646f5a66fb9fa4c3bc7e9f9b0343e9" class="src_link" title="app/models/claude_message.rb">app/models/claude_message.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">67</td>
            <td class="cell--number">34</td>
            <td class="cell--number">34</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27.38</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">4</td>
              <td class="cell--number">3</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d6a1a7c90d96046925ea96e792709af8e156b195" class="src_link" title="app/models/claude_session.rb">app/models/claude_session.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">47</td>
            <td class="cell--number">25</td>
            <td class="cell--number">25</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.04</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">1</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#f247494b799178d822e6f4b54c00f6e041ad6d71" class="src_link" title="app/models/cloud_file.rb">app/models/cloud_file.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">103</td>
            <td class="cell--number">46</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0</td>
            <td class="cell--number">35.72</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d3a7c68d63f0ce32c4d5a35fd88e7e69e9be8eeb" class="src_link" title="app/models/cloud_integration.rb">app/models/cloud_integration.rb</a></td>
            <td class="green strong cell--number t-file__coverage">97.30 %</td>
            <td class="cell--number">75</td>
            <td class="cell--number">37</td>
            <td class="cell--number">36</td>
            <td class="cell--number">1</td>
            <td class="cell--number">28.19</td>
            
              <td class="red strong cell--number t-file__branch-coverage">75.00 %</td>
              <td class="cell--number">8</td>
              <td class="cell--number">6</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#e2b0015ebb717c359bcd97bd1a7e64196cc44205" class="src_link" title="app/models/context_item.rb">app/models/context_item.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">111</td>
            <td class="cell--number">54</td>
            <td class="cell--number">54</td>
            <td class="cell--number">0</td>
            <td class="cell--number">26.70</td>
            
              <td class="green strong cell--number t-file__branch-coverage">94.44 %</td>
              <td class="cell--number">18</td>
              <td class="cell--number">17</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#55fac10793d5593b05efd25be44023da23f0496b" class="src_link" title="app/models/current.rb">app/models/current.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">7</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">73.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#a1eb5483be4b4001589984bc5a3f19dbb93515aa" class="src_link" title="app/models/document.rb">app/models/document.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">136</td>
            <td class="cell--number">60</td>
            <td class="cell--number">60</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.57</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">81.25 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">13</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#0f2edfdd6864454a1e6f442482823bd5bd0659c0" class="src_link" title="app/models/document_version.rb">app/models/document_version.rb</a></td>
            <td class="green strong cell--number t-file__coverage">93.02 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">43</td>
            <td class="cell--number">40</td>
            <td class="cell--number">3</td>
            <td class="cell--number">7.72</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">10</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#046d7a50e945f59c90c42c0b485356f369da096b" class="src_link" title="app/models/identity.rb">app/models/identity.rb</a></td>
            <td class="red strong cell--number t-file__coverage">55.56 %</td>
            <td class="cell--number">13</td>
            <td class="cell--number">9</td>
            <td class="cell--number">5</td>
            <td class="cell--number">4</td>
            <td class="cell--number">6.11</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#74f115f9844b516ec62d50719d135eedc1cadbcf" class="src_link" title="app/models/session.rb">app/models/session.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">3</td>
            <td class="cell--number">2</td>
            <td class="cell--number">2</td>
            <td class="cell--number">0</td>
            <td class="cell--number">11.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#494b0aceb82b6972ebd60455c121582ccfa02279" class="src_link" title="app/models/sub_agent.rb">app/models/sub_agent.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.89 %</td>
            <td class="cell--number">182</td>
            <td class="cell--number">90</td>
            <td class="cell--number">80</td>
            <td class="cell--number">10</td>
            <td class="cell--number">30.53</td>
            
              <td class="red strong cell--number t-file__branch-coverage">80.00 %</td>
              <td class="cell--number">20</td>
              <td class="cell--number">16</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#091d018c57e564910ac4993725f73fe7cca94575" class="src_link" title="app/models/sub_agent_message.rb">app/models/sub_agent_message.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">62</td>
            <td class="cell--number">26</td>
            <td class="cell--number">26</td>
            <td class="cell--number">0</td>
            <td class="cell--number">14.12</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8f31e0dd08a399d5e262d7187972ada946e410cb" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">56</td>
            <td class="cell--number">32</td>
            <td class="cell--number">32</td>
            <td class="cell--number">0</td>
            <td class="cell--number">27.78</td>
            
              <td class="red strong cell--number t-file__branch-coverage">50.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">1</td>
              <td class="cell--number">1</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         5.75
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Mailers"></a>

  <div>
    <b>2</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>8</b> relevant lines,
    <span class="green"><b>8</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#1f796e4b5f54d54763ad50fba18b565a66482909" class="src_link" title="app/mailers/passwords_mailer.rb">app/mailers/passwords_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">5.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#146d601a09491ded86b6aaad770eb1400b8e0fee" class="src_link" title="app/mailers/user_mailer.rb">app/mailers/user_mailer.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">6</td>
            <td class="cell--number">4</td>
            <td class="cell--number">4</td>
            <td class="cell--number">0</td>
            <td class="cell--number">6.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         8.78
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Helpers"></a>

  <div>
    <b>5</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>60</b> relevant lines,
    <span class="green"><b>60</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>35</b> total branches, </span>
      <span class="green"><b>35</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#298241307ed5132a76fd4bf970864ba298d08175" class="src_link" title="app/helpers/application_helper.rb">app/helpers/application_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">28</td>
            <td class="cell--number">16</td>
            <td class="cell--number">16</td>
            <td class="cell--number">0</td>
            <td class="cell--number">24.50</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">12</td>
              <td class="cell--number">12</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#148c2fad3751cf16725df6b6f3a484309449ae90" class="src_link" title="app/helpers/context_items_helper.rb">app/helpers/context_items_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">157</td>
            <td class="cell--number">41</td>
            <td class="cell--number">41</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.22</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">23</td>
              <td class="cell--number">23</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#ce9a466bae444d81c433d3ccbd420ebd203665ba" class="src_link" title="app/helpers/documents_helper.rb">app/helpers/documents_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c1c0f0687a2737a2cd8ea3ce563c041d3dd54630" class="src_link" title="app/helpers/users_helper.rb">app/helpers/users_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#17dd9072bc5a60001be68d54c77859e78c75f4ca" class="src_link" title="app/helpers/welcome_helper.rb">app/helpers/welcome_helper.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">2</td>
            <td class="cell--number">1</td>
            <td class="cell--number">1</td>
            <td class="cell--number">0</td>
            <td class="cell--number">1.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent">
      <span class="green">
  96.69%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         6.38
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Jobs"></a>

  <div>
    <b>3</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>151</b> relevant lines,
    <span class="green"><b>146</b> lines covered</span> and
    <span class="red"><b>5</b> lines missed. </span>
    (<span class="green">
  96.69%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>37</b> total branches, </span>
      <span class="green"><b>28</b> branches covered</span> and
      <span class="red"><b>9</b> branches missed.</span>
      (<span class="red">
  75.68%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#11802d3c53048302530fec92f70140e9d9ed5adc" class="src_link" title="app/jobs/claude_interaction_job.rb">app/jobs/claude_interaction_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">153</td>
            <td class="cell--number">58</td>
            <td class="cell--number">58</td>
            <td class="cell--number">0</td>
            <td class="cell--number">3.19</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">9</td>
              <td class="cell--number">9</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2d682f6c98c08a07fe7846522e021f1700000c90" class="src_link" title="app/jobs/cloud_file_import_job.rb">app/jobs/cloud_file_import_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.59 %</td>
            <td class="cell--number">220</td>
            <td class="cell--number">74</td>
            <td class="cell--number">70</td>
            <td class="cell--number">4</td>
            <td class="cell--number">8.04</td>
            
              <td class="red strong cell--number t-file__branch-coverage">63.64 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">14</td>
              <td class="cell--number">8</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9f4dd05c24e4000df241d01d9b7eacccc61013da" class="src_link" title="app/jobs/cloud_file_sync_job.rb">app/jobs/cloud_file_sync_job.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.74 %</td>
            <td class="cell--number">41</td>
            <td class="cell--number">19</td>
            <td class="cell--number">18</td>
            <td class="cell--number">1</td>
            <td class="cell--number">9.63</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">5</td>
              <td class="cell--number">1</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent">
      <span class="green">
  100.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Libraries"></a>

  <div>
    <b>0</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>0</b> relevant lines,
    <span class="green"><b>0</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed. </span>
    (<span class="green">
  100.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>0</b> total branches, </span>
      <span class="green"><b>0</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Services">
  <h2>
    <span class="group_name">Services</span>
    (<span class="covered_percent">
      <span class="red">
  64.58%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         4.21
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Services"></a>

  <div>
    <b>6</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>432</b> relevant lines,
    <span class="green"><b>279</b> lines covered</span> and
    <span class="red"><b>153</b> lines missed. </span>
    (<span class="red">
  64.58%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>126</b> total branches, </span>
      <span class="green"><b>41</b> branches covered</span> and
      <span class="red"><b>85</b> branches missed.</span>
      (<span class="red">
  32.54%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#c462efa6723942ffd0dd9f5bba5bc334edab43ee" class="src_link" title="app/services/claude_service.rb">app/services/claude_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.92 %</td>
            <td class="cell--number">174</td>
            <td class="cell--number">65</td>
            <td class="cell--number">63</td>
            <td class="cell--number">2</td>
            <td class="cell--number">10.40</td>
            
              <td class="red strong cell--number t-file__branch-coverage">68.75 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">11</td>
              <td class="cell--number">5</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2b560731d0e2360c0fea28ebc1c08a7fe670213d" class="src_link" title="app/services/cloud_services/base_service.rb">app/services/cloud_services/base_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.28 %</td>
            <td class="cell--number">129</td>
            <td class="cell--number">58</td>
            <td class="cell--number">57</td>
            <td class="cell--number">1</td>
            <td class="cell--number">4.36</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">87.50 %</td>
              <td class="cell--number">16</td>
              <td class="cell--number">14</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#d7326628ecfcc07fd1c3e1f6dce5521fc4f4f7de" class="src_link" title="app/services/cloud_services/dropbox_service.rb">app/services/cloud_services/dropbox_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">24.59 %</td>
            <td class="cell--number">228</td>
            <td class="cell--number">61</td>
            <td class="cell--number">15</td>
            <td class="cell--number">46</td>
            <td class="cell--number">0.98</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">21</td>
              <td class="cell--number">0</td>
              <td class="cell--number">21</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#695fe6fa6edefe2dfb1769f99ca069b20a91426b" class="src_link" title="app/services/cloud_services/google_drive_service.rb">app/services/cloud_services/google_drive_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.83 %</td>
            <td class="cell--number">211</td>
            <td class="cell--number">58</td>
            <td class="cell--number">55</td>
            <td class="cell--number">3</td>
            <td class="cell--number">5.03</td>
            
              <td class="red strong cell--number t-file__branch-coverage">71.43 %</td>
              <td class="cell--number">14</td>
              <td class="cell--number">10</td>
              <td class="cell--number">4</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#efc6940cc6ca4ef58691ecccc8cf69a418dc6233" class="src_link" title="app/services/cloud_services/notion_service.rb">app/services/cloud_services/notion_service.rb</a></td>
            <td class="red strong cell--number t-file__coverage">17.65 %</td>
            <td class="cell--number">352</td>
            <td class="cell--number">119</td>
            <td class="cell--number">21</td>
            <td class="cell--number">98</td>
            <td class="cell--number">0.88</td>
            
              <td class="red strong cell--number t-file__branch-coverage">0.00 %</td>
              <td class="cell--number">53</td>
              <td class="cell--number">0</td>
              <td class="cell--number">53</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#61186a6d864ccc7ef45640587372542da21e7749" class="src_link" title="app/services/sub_agent_service.rb">app/services/sub_agent_service.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.77 %</td>
            <td class="cell--number">150</td>
            <td class="cell--number">71</td>
            <td class="cell--number">68</td>
            <td class="cell--number">3</td>
            <td class="cell--number">6.10</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">6</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Components">
  <h2>
    <span class="group_name">Components</span>
    (<span class="covered_percent">
      <span class="red">
  80.0%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         14.77
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Components"></a>

  <div>
    <b>16</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>1310</b> relevant lines,
    <span class="green"><b>1048</b> lines covered</span> and
    <span class="red"><b>262</b> lines missed. </span>
    (<span class="red">
  80.0%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>481</b> total branches, </span>
      <span class="green"><b>312</b> branches covered</span> and
      <span class="red"><b>169</b> branches missed.</span>
      (<span class="red">
  64.86%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc0574b5a4278eed5d8ca3e907ea59108013c01a" class="src_link" title="app/components/cloud_file_browser_component.rb">app/components/cloud_file_browser_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.96 %</td>
            <td class="cell--number">274</td>
            <td class="cell--number">119</td>
            <td class="cell--number">113</td>
            <td class="cell--number">6</td>
            <td class="cell--number">9.87</td>
            
              <td class="red strong cell--number t-file__branch-coverage">71.43 %</td>
              <td class="cell--number">35</td>
              <td class="cell--number">25</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#6553a17182f72672beee3f9b8eece952599a92c5" class="src_link" title="app/components/cloud_file_item_component.rb">app/components/cloud_file_item_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">94.70 %</td>
            <td class="cell--number">281</td>
            <td class="cell--number">132</td>
            <td class="cell--number">125</td>
            <td class="cell--number">7</td>
            <td class="cell--number">35.07</td>
            
              <td class="red strong cell--number t-file__branch-coverage">78.33 %</td>
              <td class="cell--number">60</td>
              <td class="cell--number">47</td>
              <td class="cell--number">13</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#9f6b0098c5fe22ff8b465a84bedfa3974de9f09c" class="src_link" title="app/components/cloud_provider_component.rb">app/components/cloud_provider_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">88.31 %</td>
            <td class="cell--number">156</td>
            <td class="cell--number">77</td>
            <td class="cell--number">68</td>
            <td class="cell--number">9</td>
            <td class="cell--number">16.48</td>
            
              <td class="red strong cell--number t-file__branch-coverage">67.86 %</td>
              <td class="cell--number">56</td>
              <td class="cell--number">38</td>
              <td class="cell--number">18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#81e992361caa0f2b2ff9aaac25882a2ed124ce3a" class="src_link" title="app/components/cloud_sync_status_component.rb">app/components/cloud_sync_status_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">79.43 %</td>
            <td class="cell--number">282</td>
            <td class="cell--number">141</td>
            <td class="cell--number">112</td>
            <td class="cell--number">29</td>
            <td class="cell--number">4.73</td>
            
              <td class="red strong cell--number t-file__branch-coverage">52.17 %</td>
              <td class="cell--number">69</td>
              <td class="cell--number">36</td>
              <td class="cell--number">33</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#2ba6c1c0063afea732d6f5fd19caa1f69dc693c4" class="src_link" title="app/components/context_item_preview_component.rb">app/components/context_item_preview_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">87.32 %</td>
            <td class="cell--number">193</td>
            <td class="cell--number">71</td>
            <td class="cell--number">62</td>
            <td class="cell--number">9</td>
            <td class="cell--number">15.04</td>
            
              <td class="red strong cell--number t-file__branch-coverage">51.92 %</td>
              <td class="cell--number">52</td>
              <td class="cell--number">27</td>
              <td class="cell--number">25</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#dead27ca8943d78ebb74a74b94091caa9a0ae291" class="src_link" title="app/components/context_sidebar_component.rb">app/components/context_sidebar_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">75.00 %</td>
            <td class="cell--number">162</td>
            <td class="cell--number">76</td>
            <td class="cell--number">57</td>
            <td class="cell--number">19</td>
            <td class="cell--number">20.50</td>
            
              <td class="red strong cell--number t-file__branch-coverage">41.94 %</td>
              <td class="cell--number">31</td>
              <td class="cell--number">13</td>
              <td class="cell--number">18</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#69078d0012a08dad4a026120e51bf8bad9a8d62e" class="src_link" title="app/components/document_layout_component.rb">app/components/document_layout_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">84.00 %</td>
            <td class="cell--number">311</td>
            <td class="cell--number">100</td>
            <td class="cell--number">84</td>
            <td class="cell--number">16</td>
            <td class="cell--number">10.64</td>
            
              <td class="red strong cell--number t-file__branch-coverage">64.29 %</td>
              <td class="cell--number">42</td>
              <td class="cell--number">27</td>
              <td class="cell--number">15</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b917806e1ca293e6dc3d73405198258535507596" class="src_link" title="app/components/editor_component.rb">app/components/editor_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.45 %</td>
            <td class="cell--number">218</td>
            <td class="cell--number">44</td>
            <td class="cell--number">42</td>
            <td class="cell--number">2</td>
            <td class="cell--number">4.66</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">83.33 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">5</td>
              <td class="cell--number">1</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8bc1e653222dd123de33e8892ebf772595d9bb86" class="src_link" title="app/components/onboarding_modal_component.rb">app/components/onboarding_modal_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">98.61 %</td>
            <td class="cell--number">393</td>
            <td class="cell--number">72</td>
            <td class="cell--number">71</td>
            <td class="cell--number">1</td>
            <td class="cell--number">21.06</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">84.21 %</td>
              <td class="cell--number">19</td>
              <td class="cell--number">16</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#bc4b58719725b017623a42220ce1fd45e395f1ef" class="src_link" title="app/components/presence_indicator_component.rb">app/components/presence_indicator_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">0.00 %</td>
            <td class="cell--number">154</td>
            <td class="cell--number">135</td>
            <td class="cell--number">0</td>
            <td class="cell--number">135</td>
            <td class="cell--number">0.00</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#028c72ff24c7cfc72c1a18514708dc1504fc4403" class="src_link" title="app/components/sidebar_navigation_component.rb">app/components/sidebar_navigation_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">305</td>
            <td class="cell--number">68</td>
            <td class="cell--number">68</td>
            <td class="cell--number">0</td>
            <td class="cell--number">31.65</td>
            
              <td class="yellow strong cell--number t-file__branch-coverage">86.36 %</td>
              <td class="cell--number">22</td>
              <td class="cell--number">19</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#59cb3317309d061a8bd8387a3489de96a0441d0f" class="src_link" title="app/components/sub_agent_conversation_component.rb">app/components/sub_agent_conversation_component.rb</a></td>
            <td class="red strong cell--number t-file__coverage">80.00 %</td>
            <td class="cell--number">147</td>
            <td class="cell--number">70</td>
            <td class="cell--number">56</td>
            <td class="cell--number">14</td>
            <td class="cell--number">9.24</td>
            
              <td class="red strong cell--number t-file__branch-coverage">44.00 %</td>
              <td class="cell--number">25</td>
              <td class="cell--number">11</td>
              <td class="cell--number">14</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#8af5866dd5bda3c53d98d9e2f1be63fb349d7efe" class="src_link" title="app/components/sub_agent_merge_component.rb">app/components/sub_agent_merge_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">92.98 %</td>
            <td class="cell--number">123</td>
            <td class="cell--number">57</td>
            <td class="cell--number">53</td>
            <td class="cell--number">4</td>
            <td class="cell--number">21.30</td>
            
              <td class="red strong cell--number t-file__branch-coverage">66.67 %</td>
              <td class="cell--number">6</td>
              <td class="cell--number">4</td>
              <td class="cell--number">2</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#90dea76b9ac0901befa27c98f81ad9edfe3c7a18" class="src_link" title="app/components/sub_agent_sidebar_component.rb">app/components/sub_agent_sidebar_component.rb</a></td>
            <td class="yellow strong cell--number t-file__coverage">82.61 %</td>
            <td class="cell--number">109</td>
            <td class="cell--number">46</td>
            <td class="cell--number">38</td>
            <td class="cell--number">8</td>
            <td class="cell--number">20.57</td>
            
              <td class="red strong cell--number t-file__branch-coverage">47.37 %</td>
              <td class="cell--number">19</td>
              <td class="cell--number">9</td>
              <td class="cell--number">10</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#509a5126627d08b461277fa7c3f57ad3dbf16155" class="src_link" title="app/components/theme_toggle_component.rb">app/components/theme_toggle_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">93</td>
            <td class="cell--number">31</td>
            <td class="cell--number">31</td>
            <td class="cell--number">0</td>
            <td class="cell--number">17.55</td>
            
              <td class="red strong cell--number t-file__branch-coverage">80.00 %</td>
              <td class="cell--number">15</td>
              <td class="cell--number">12</td>
              <td class="cell--number">3</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#fd43c3c57b68a64d92a2e94ea3de05dc174064fb" class="src_link" title="app/components/widget_drop_zone_component.rb">app/components/widget_drop_zone_component.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.77 %</td>
            <td class="cell--number">237</td>
            <td class="cell--number">71</td>
            <td class="cell--number">68</td>
            <td class="cell--number">3</td>
            <td class="cell--number">9.79</td>
            
              <td class="green strong cell--number t-file__branch-coverage">95.83 %</td>
              <td class="cell--number">24</td>
              <td class="cell--number">23</td>
              <td class="cell--number">1</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
          <div class="file_list_container" id="Policies">
  <h2>
    <span class="group_name">Policies</span>
    (<span class="covered_percent">
      <span class="green">
  97.83%
</span>

     </span>
     covered at
     <span class="covered_strength">
       <span class="green">
         12.62
       </span>
    </span> hits/line
    )
  </h2>

  <a name="Policies"></a>

  <div>
    <b>4</b> files in total.
  </div>

  <div class="t-line-summary">
    <b>92</b> relevant lines,
    <span class="green"><b>90</b> lines covered</span> and
    <span class="red"><b>2</b> lines missed. </span>
    (<span class="green">
  97.83%
</span>
)
  </div>

  
    <div class="t-branch-summary">
      <span><b>2</b> total branches, </span>
      <span class="green"><b>2</b> branches covered</span> and
      <span class="red"><b>0</b> branches missed.</span>
      (<span class="green">
  100.0%
</span>
)
    </div>
  

  <div class="file_list--responsive">
    <table class="file_list">
      <thead>
        <tr>
          <th>File</th>
          <th class="cell--number">% covered</th>
          <th class="cell--number">Lines</th>
          <th class="cell--number">Relevant Lines</th>
          <th class="cell--number">Lines covered</th>
          <th class="cell--number">Lines missed</th>
          <th class="cell--number">Avg. Hits / Line</th>
          
            <th class="cell--number">Branch Coverage</th>
            <th class="cell--number">Branches</th>
            <th class="cell--number">Covered branches</th>
            <th class="cell--number">Missed branches </th>
          
        </tr>
      </thead>
      <tbody>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#04d664c6b250f4ceb1543a7dd094fabc8b2281ca" class="src_link" title="app/policies/application_policy.rb">app/policies/application_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">53</td>
            <td class="cell--number">27</td>
            <td class="cell--number">27</td>
            <td class="cell--number">0</td>
            <td class="cell--number">12.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#288d62f2a7c5e48d17e085fc93101503f4461083" class="src_link" title="app/policies/context_item_policy.rb">app/policies/context_item_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">100.00 %</td>
            <td class="cell--number">33</td>
            <td class="cell--number">14</td>
            <td class="cell--number">14</td>
            <td class="cell--number">0</td>
            <td class="cell--number">7.71</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#b150ecee3a5557ba72077e50e07ca704a8ca886c" class="src_link" title="app/policies/document_policy.rb">app/policies/document_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">96.77 %</td>
            <td class="cell--number">71</td>
            <td class="cell--number">31</td>
            <td class="cell--number">30</td>
            <td class="cell--number">1</td>
            <td class="cell--number">17.81</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">2</td>
              <td class="cell--number">2</td>
              <td class="cell--number">0</td>
            
          </tr>
        
          <tr class="t-file">
            <td class="strong t-file__name"><a href="#4cd7e23bc5c50bd2ef364b6ff90a7a488a5e4a85" class="src_link" title="app/policies/sub_agent_policy.rb">app/policies/sub_agent_policy.rb</a></td>
            <td class="green strong cell--number t-file__coverage">95.00 %</td>
            <td class="cell--number">45</td>
            <td class="cell--number">20</td>
            <td class="cell--number">19</td>
            <td class="cell--number">1</td>
            <td class="cell--number">7.75</td>
            
              <td class="green strong cell--number t-file__branch-coverage">100.00 %</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
              <td class="cell--number">0</td>
            
          </tr>
        
      </tbody>
    </table>
  </div>
</div>

        
      </div>

      <div id="footer">
        Generated by <a href="https://github.com/simplecov-ruby/simplecov">simplecov</a> v0.22.0
        and simplecov-html v0.13.2<br/>
        using Minitest, Unit Tests, minitest-0, minitest-1, minitest-2, minitest-3, minitest-4, minitest-5, minitest-6, minitest-7, minitest-8, minitest-9
      </div>

      <div class="source_files">
      
        <div class="source_table" id="a75ab60e4e485cc2bdd28d362d741292c524ff0d">
  <div class="header">
    <h3>app/channels/cloud_sync_channel.rb</h3>
    <h4>
      <span class="yellow">
  85.29%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>29</b> lines covered</span> and
      <span class="red"><b>5</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class CloudSyncChannel &lt; ApplicationCable::Channel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def subscribed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">    # Subscribe to cloud sync updates for the current user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="4">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    stream_for current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    # Also subscribe to specific integration channels if provided</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="7">
            
              <span class="hits">15</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    if params[:integration_id].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="8">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      integration = current_user.cloud_integrations.find_by(id: params[:integration_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="9">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      if integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="10">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        stream_for integration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def unsubscribed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    # Any cleanup needed when channel is unsubscribed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # Client can request sync status updates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def get_sync_status(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="21">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    integration_id = data[&quot;integration_id&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="23">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if integration_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="24">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      integration = current_user.cloud_integrations.find_by(id: integration_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="25">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if integration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        # Get current sync status (this would be enhanced with actual job tracking)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        status = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="28">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          integration_id: integration.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">          provider: integration.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">          syncing: false, # This would check actual sync job status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">          files_count: integration.cloud_files.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">          last_sync: integration.cloud_files.maximum(:last_synced_at),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">          error: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="36">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        transmit(status)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      # Return status for all user integrations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      statuses = current_user.cloud_integrations.map do |integration|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          integration_id: integration.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">          provider: integration.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">          syncing: false, # This would check actual sync job status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">          files_count: integration.cloud_files.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">          last_sync: integration.cloud_files.maximum(:last_synced_at),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">          error: nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      transmit({ integrations: statuses })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  # Client can trigger sync (with rate limiting)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def trigger_sync(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="57">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    integration_id = data[&quot;integration_id&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="59">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless integration_id.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="61">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    integration = current_user.cloud_integrations.find_by(id: integration_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="62">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return unless integration&amp;.active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    # Rate limiting: prevent sync requests more than once every 30 seconds</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    cache_key = &quot;sync_limit:#{current_user.id}:#{integration_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if Rails.cache.exist?(cache_key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      transmit({</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">        error: &quot;Sync rate limited. Please wait before syncing again.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        integration_id: integration_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    # Set rate limit cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="75">
            

            
              
            

            <code class="ruby">    Rails.cache.write(cache_key, true, expires_in: 30.seconds)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    # Queue sync job</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            

            
              
            

            <code class="ruby">    CloudFileSyncJob.perform_later(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    # Notify client that sync started</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">    transmit({</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      event: &quot;sync_started&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      integration_id: integration_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      provider: integration.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      message: &quot;Sync started for #{integration.provider_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    # Broadcast to all subscribers</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            

            
              
            

            <code class="ruby">    CloudSyncChannel.broadcast_to(current_user, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      event: &quot;sync_started&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      integration_id: integration_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      provider: integration.provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    # This assumes user is set in the connection</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">    connection.current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0172f96d73c29e139b3ee226cdd1c5fa9503aa7b">
  <div class="header">
    <h3>app/channels/presence_channel.rb</h3>
    <h4>
      <span class="red">
  80.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  56.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>130</b> relevant lines.
      <span class="green"><b>104</b> lines covered</span> and
      <span class="red"><b>26</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>50</b> total branches, </span>
          <span class="green"><b>28</b> branches covered</span> and
          <span class="red"><b>22</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class PresenceChannel &lt; ApplicationCable::Channel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def subscribed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="5">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="6">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    return reject unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="8">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    stream_for document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # Track user presence</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="11">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    add_user_to_presence(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    # Broadcast user joined to other subscribers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="14">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    broadcast_presence_update(document, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      type: &quot;user_joined&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">      user: serialize_user(current_user),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="20">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    logger.info &quot;User #{current_user.id} joined presence for document #{document.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="23">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def unsubscribed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="24">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="25">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    return unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    # Remove user from presence</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="28">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    remove_user_from_presence(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # Broadcast user left to other subscribers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    broadcast_presence_update(document, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      type: &quot;user_left&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="37">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    logger.info &quot;User #{current_user.id} left presence for document #{document.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  # Handle typing indicators</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def user_typing(data = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="42">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="43">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    # Update typing timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update_typing_status(document, true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    # Broadcast to other users (excluding sender)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="49">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    broadcast_presence_update(document, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      type: &quot;user_typing&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      user_name: current_user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    }, except: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def user_stopped_typing(data = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="58">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="59">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    # Update typing timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="62">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update_typing_status(document, false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    # Broadcast to other users (excluding sender)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="65">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    broadcast_presence_update(document, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      type: &quot;user_stopped_typing&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    }, except: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  # Handle cursor position updates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def cursor_moved(data = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="74">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="75">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="77">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    position = data[&quot;position&quot;] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">    # Handle both string and symbol keys for coordinates</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="79">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    x = position[&quot;x&quot;] || position[:x]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="80">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    y = position[&quot;y&quot;] || position[:y]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="81">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless x &amp;&amp; y</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    # Store cursor position (optional, for persistence)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="84">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update_cursor_position(document, x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    # Broadcast to other users (excluding sender)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="87">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    broadcast_presence_update(document, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      type: &quot;cursor_moved&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      user_name: current_user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      position: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        x: x.to_f,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        y: y.to_f</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    }, except: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  # Handle selection changes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def selection_changed(data = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="101">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="102">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    selection = data[&quot;selection&quot;] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    # Broadcast selection to other users (excluding sender)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    broadcast_presence_update(document, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      type: &quot;selection_changed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">      user_name: current_user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      selection: selection,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    }, except: current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">  # Get current presence for a document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def get_presence(data = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="118">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    document = find_document</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="119">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless document &amp;&amp; authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="121">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    presence_data = get_document_presence(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    # Send presence data back to requesting user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="124">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    transmit({</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      type: &quot;presence_data&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      users: presence_data[:users],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      cursors: presence_data[:cursors],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      typing_users: presence_data[:typing_users],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      timestamp: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="135">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def find_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="136">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">    document_id = params[:document_id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="137">
            
              <span class="hits">38</span>
            

            
              
                <span class="hits" title="else branch hit 36 times">
                  else: 36
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return nil unless document_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="139">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">    @document ||= Document.find_by(id: document_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def authorized_for_document?(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">    # Use Pundit policy to check authorization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="144">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    Pundit.policy(current_user, document).show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">  rescue Pundit::NotAuthorizedError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="146">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="149">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def add_user_to_presence(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">    # Store user presence in Redis or in-memory store</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="151">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    presence_key = &quot;document_#{document.id}_presence&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">    user_data = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="153">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">      name: current_user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      email: current_user.email_address,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      joined_at: Time.current.iso8601,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">      last_seen: Time.current.iso8601,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">      typing: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="161">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    if Rails.cache.respond_to?(:hset)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="162">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Redis-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            

            
              
            

            <code class="ruby">      Rails.cache.hset(presence_key, current_user.id, user_data.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            

            
              
            

            <code class="ruby">      Rails.cache.expire(presence_key, 1.hour.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">      # Memory-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="167">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      presence_data = Rails.cache.read(presence_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="168">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      presence_data[current_user.id] = user_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="169">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      Rails.cache.write(presence_key, presence_data, expires_in: 1.hour)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def remove_user_from_presence(document)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="174">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    presence_key = &quot;document_#{document.id}_presence&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="176">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    if Rails.cache.respond_to?(:hdel)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="177">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Redis-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            

            
              
            

            <code class="ruby">      Rails.cache.hdel(presence_key, current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      # Memory-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="181">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      presence_data = Rails.cache.read(presence_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="182">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      presence_data.delete(current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="183">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Rails.cache.write(presence_key, presence_data, expires_in: 1.hour)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="187">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def update_typing_status(document, typing)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="188">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    presence_key = &quot;document_#{document.id}_presence&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="190">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    if Rails.cache.respond_to?(:hget)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="191">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Redis-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            

            
              
            

            <code class="ruby">      user_data_json = Rails.cache.hget(presence_key, current_user.id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="193">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return unless user_data_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            

            
              
            

            <code class="ruby">      user_data = JSON.parse(user_data_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            

            
              
            

            <code class="ruby">      user_data[&quot;typing&quot;] = typing</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            

            
              
            

            <code class="ruby">      user_data[&quot;last_seen&quot;] = Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="198">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      user_data[&quot;typing_at&quot;] = typing ? Time.current.iso8601 : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            

            
              
            

            <code class="ruby">      Rails.cache.hset(presence_key, current_user.id, user_data.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      # Memory-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="203">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      presence_data = Rails.cache.read(presence_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="204">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if presence_data[current_user.id]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="205">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        presence_data[current_user.id][:typing] = typing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="206">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        presence_data[current_user.id][:last_seen] = Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="207">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">        presence_data[current_user.id][:typing_at] = typing ? Time.current.iso8601 : nil</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="208">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        Rails.cache.write(presence_key, presence_data, expires_in: 1.hour)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="213">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def update_cursor_position(document, x, y)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="214">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    cursor_key = &quot;document_#{document.id}_cursors&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">    cursor_data = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="216">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">      x: x.to_f,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">      y: y.to_f,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">      updated_at: Time.current.iso8601</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="222">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    if Rails.cache.respond_to?(:hset)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="223">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Redis-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="224">
            

            
              
            

            <code class="ruby">      Rails.cache.hset(cursor_key, current_user.id, cursor_data.to_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            

            
              
            

            <code class="ruby">      Rails.cache.expire(cursor_key, 10.minutes.to_i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      # Memory-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="228">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      cursors = Rails.cache.read(cursor_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="229">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      cursors[current_user.id] = cursor_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="230">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Rails.cache.write(cursor_key, cursors, expires_in: 10.minutes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="234">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def get_document_presence(document)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="235">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    presence_key = &quot;document_#{document.id}_presence&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="236">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    cursor_key = &quot;document_#{document.id}_cursors&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="238">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    users = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="239">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    cursors = {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="240">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    typing_users = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="242">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    if Rails.cache.respond_to?(:hgetall)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="243">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Redis-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="244">
            

            
              
            

            <code class="ruby">      presence_data = Rails.cache.hgetall(presence_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="245">
            

            
              
            

            <code class="ruby">      presence_data.each do |user_id, user_data_json|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="246">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        next if user_id.to_i == current_user.id # Exclude current user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="249">
            

            
              
            

            <code class="ruby">          user_data = JSON.parse(user_data_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="250">
            

            
              
            

            <code class="ruby">          users &lt;&lt; serialize_user_from_data(user_data)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="251">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          typing_users &lt;&lt; user_id.to_i if user_data[&quot;typing&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">        rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="253">
            

            
              
            

            <code class="ruby">          next</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            

            
              
            

            <code class="ruby">      cursor_data = Rails.cache.hgetall(cursor_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="258">
            

            
              
            

            <code class="ruby">      cursor_data.each do |user_id, cursor_json|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="259">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        next if user_id.to_i == current_user.id # Exclude current user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">        begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="262">
            

            
              
            

            <code class="ruby">          cursor_info = JSON.parse(cursor_json)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="263">
            

            
              
            

            <code class="ruby">          cursors[user_id] = cursor_info</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">        rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="265">
            

            
              
            

            <code class="ruby">          next</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      # Memory-backed cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="270">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      presence_data = Rails.cache.read(presence_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="271">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      presence_data.each do |user_id, user_data|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="272">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">        next if user_id == current_user.id # Exclude current user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="274">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        users &lt;&lt; serialize_user_from_data(user_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="275">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">        typing_users &lt;&lt; user_id if user_data[:typing]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="278">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      cursors = Rails.cache.read(cursor_key) || {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="279">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      cursors = cursors.reject { |user_id, _| user_id == current_user.id }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="283">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      users: users,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">      cursors: cursors,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
            

            <code class="ruby">      typing_users: typing_users</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="289">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def broadcast_presence_update(document, data, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">    # Exclude specific users if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="291">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 18 times">
                  else: 18
                </span>
              
            

            <code class="ruby">    if options[:except]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="292">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      excluded_users = Array(options[:except])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">      # This would need to be implemented based on your ActionCable setup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby">      # For now, we&#39;ll broadcast to all and let clients filter</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="297">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    PresenceChannel.broadcast_to(document, data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="300">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def serialize_user(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="302">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      id: user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">      name: user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">      email: user.email_address,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">      avatar_url: nil  # Avatar functionality not implemented in User model</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="309">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def serialize_user_from_data(user_data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="310">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    if user_data.is_a?(Hash) &amp;&amp; user_data.key?(&quot;id&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="311">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # JSON data (from Redis)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="313">
            

            
              
            

            <code class="ruby">        id: user_data[&quot;id&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">        name: user_data[&quot;name&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">        email: user_data[&quot;email&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">        joined_at: user_data[&quot;joined_at&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">        last_seen: user_data[&quot;last_seen&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">        typing: user_data[&quot;typing&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      # Ruby hash data (from memory cache)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="322">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      user_data</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="474830fcfd38153c38b6080bb7700cc649fc1a45">
  <div class="header">
    <h3>app/channels/sub_agent_channel.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  65.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>42</b> relevant lines.
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>20</b> total branches, </span>
          <span class="green"><b>13</b> branches covered</span> and
          <span class="red"><b>7</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class SubAgentChannel &lt; ApplicationCable::Channel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def subscribed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="3">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    sub_agent = SubAgent.find_by(id: params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="5">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 13 times">
                  then: 13
                </span>
              
            

            <code class="ruby">    if sub_agent &amp;&amp; authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="6">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      stream_from &quot;sub_agent_#{sub_agent.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="8">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      reject</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def unsubscribed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="13">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    stop_all_streams</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def receive(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="17">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    sub_agent = SubAgent.find_by(id: params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="18">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless sub_agent &amp;&amp; authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="20">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if data[&quot;message&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="21">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      service = SubAgentService.new(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="22">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      message = service.send_message(current_user, data[&quot;message&quot;][&quot;content&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="24">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">      if message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="25">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        broadcast_message(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def update_status(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent = SubAgent.find_by(id: params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="32">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless sub_agent &amp;&amp; authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if sub_agent.update(status: data[&quot;status&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(&quot;sub_agent_#{sub_agent.id}&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        type: &quot;status_change&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        status: data[&quot;status&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def typing(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent = SubAgent.find_by(id: params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless sub_agent &amp;&amp; authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    ActionCable.server.broadcast(&quot;sub_agent_#{sub_agent.id}&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      type: &quot;typing&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      user_id: current_user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      user_name: current_user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      typing: data[&quot;typing&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def update_context(data)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent = SubAgent.find_by(id: params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless sub_agent &amp;&amp; authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if sub_agent.update(context: data[&quot;context&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(&quot;sub_agent_#{sub_agent.id}&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        type: &quot;context_update&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">        context: data[&quot;context&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def delete_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent = SubAgent.find_by(id: params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless sub_agent &amp;&amp; authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    ActionCable.server.broadcast(&quot;sub_agent_#{sub_agent.id}&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      type: &quot;agent_deleted&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      agent_id: sub_agent.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def authorized?(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="79">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">    sub_agent.user_id == current_user.id ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    sub_agent.document.user_id == current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def broadcast_message(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="84">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    ActionCable.server.broadcast(&quot;sub_agent_#{message.sub_agent_id}&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      message: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">        id: message.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">        role: message.role,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">        content: message.content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">        created_at: message.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">        user_name: message.user.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        html: render_message_html(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def render_message_html(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="97">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    ApplicationController.renderer.render(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      partial: &quot;sub_agent_messages/message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      locals: { message: message }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">  rescue</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    # Fallback if partial doesn&#39;t exist</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="103">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    &quot;&lt;div class=&#39;message #{message.role}-message&#39;&gt;#{message.content}&lt;/div&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="bc0574b5a4278eed5d8ca3e907ea59108013c01a">
  <div class="header">
    <h3>app/components/cloud_file_browser_component.rb</h3>
    <h4>
      <span class="green">
  94.96%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  71.43%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>119</b> relevant lines.
      <span class="green"><b>113</b> lines covered</span> and
      <span class="red"><b>6</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>35</b> total branches, </span>
          <span class="green"><b>25</b> branches covered</span> and
          <span class="red"><b>10</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudFileBrowserComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  include ActionView::Helpers::TagHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(integration:, files: [], view_mode: &quot;grid&quot;, pagination: nil, search_query: nil, filter: &quot;all&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="7">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @integration = integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="8">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @files = files</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="9">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @view_mode = view_mode</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="10">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @pagination = pagination</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="11">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @search_query = search_query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="12">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @filter = filter</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :integration, :files, :view_mode, :pagination, :search_query, :filter</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def controller_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="20">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      controller: &quot;cloud-file-browser&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      cloud_file_browser_integration_id_value: integration.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      cloud_file_browser_view_mode_value: view_mode,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      cloud_file_browser_filter_value: filter,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      cloud_file_browser_search_query_value: search_query</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def browser_css_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="30">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    classes = [ &quot;cloud-file-browser&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="31">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    classes &lt;&lt; &quot;cloud-file-browser--#{view_mode}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="32">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; &quot;cloud-file-browser--loading&quot; if files.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="33">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def view_toggle_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="38">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      { mode: &quot;grid&quot;, icon: &quot;grid&quot;, label: &quot;Grid View&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      { mode: &quot;list&quot;, icon: &quot;list&quot;, label: &quot;List View&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="43">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sort_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="45">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      { value: &quot;name:asc&quot;, label: &quot;Name A-Z&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      { value: &quot;name:desc&quot;, label: &quot;Name Z-A&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      { value: &quot;date:desc&quot;, label: &quot;Newest First&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      { value: &quot;date:asc&quot;, label: &quot;Oldest First&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      { value: &quot;size:desc&quot;, label: &quot;Largest First&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      { value: &quot;size:asc&quot;, label: &quot;Smallest First&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      { value: &quot;type:asc&quot;, label: &quot;Type A-Z&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="55">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def filter_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="57">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      { value: &quot;all&quot;, label: &quot;All Files&quot;, count: files.count },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      { value: &quot;importable&quot;, label: &quot;Importable&quot;, count: files.select(&amp;:importable?).count },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      { value: &quot;synced&quot;, label: &quot;Synced&quot;, count: files.select(&amp;:synced?).count },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      { value: &quot;unsynced&quot;, label: &quot;Needs Sync&quot;, count: files.reject(&amp;:synced?).count }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="64">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def has_files?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="65">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    files.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="68">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def empty_state_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="69">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if search_query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="70">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      &quot;No files found matching \&quot;#{search_query}\&quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="71">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    elsif filter != &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="72">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;No #{filter} files found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="74">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      &quot;No files found. Click \&quot;Sync\&quot; to load files from #{integration.provider_name}.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="78">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def empty_state_actions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="79">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    actions = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="81">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    if search_query.blank? &amp;&amp; filter == &quot;all&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="82">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">        text: &quot;Sync #{integration.provider_name}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        action: &quot;click-&gt;cloud-file-browser#syncFiles&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        class: &quot;btn btn--primary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="89">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">    if search_query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="90">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">        text: &quot;Clear Search&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">        action: &quot;click-&gt;cloud-file-browser#clearSearch&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        class: &quot;btn btn--secondary&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="97">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="100">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def selected_count_display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="101">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    &quot;0 selected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="106">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_pagination</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="107">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return &quot;&quot; unless pagination</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    # Simple pagination rendering - could be enhanced</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;pagination&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            

            
              
            

            <code class="ruby">      &quot;Page #{pagination[:current_page]} of #{pagination[:total_pages]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="115">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def batch_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="117">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">        action: &quot;batchImport&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        icon: &quot;import&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">        text: &quot;Import Selected&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">        class: &quot;btn btn--primary btn--sm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">        action: &quot;batchDownload&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">        icon: &quot;download&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">        text: &quot;Download Selected&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">        class: &quot;btn btn--secondary btn--sm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="132">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_list_container_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="133">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    case view_mode</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
                <span class="hits" title="when branch hit 10 times">
                  when: 10
                </span>
              
            

            <code class="ruby">    when &quot;grid&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="135">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      &quot;file-list file-list--grid&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;list&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;file-list file-list--table&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="138">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            

            
              
            

            <code class="ruby">      &quot;file-list&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="143">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_file_list</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="144">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if view_mode == &quot;list&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="145">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render_table_view</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="147">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      render_grid_view</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="151">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="153">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_grid_view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="154">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;file-grid&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="155">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">      files.map { |file| render(CloudFileItemComponent.new(file: file, view_mode: &quot;grid&quot;)) }.join.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="159">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_table_view</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="160">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :table, class: &quot;file-table&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="161">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(render_table_header)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(render_table_body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="166">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_table_header</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="167">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :thead do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="168">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      content_tag :tr do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="169">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:th, content_tag(:input, &quot;&quot;, type: &quot;checkbox&quot;, data: { action: &quot;change-&gt;cloud-file-browser#selectAll&quot; }), class: &quot;file-table__checkbox&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="170">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:th, &quot;Name&quot;, class: &quot;file-table__name&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="171">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:th, &quot;Size&quot;, class: &quot;file-table__size&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="172">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:th, &quot;Modified&quot;, class: &quot;file-table__date&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:th, &quot;Status&quot;, class: &quot;file-table__status&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="174">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:th, &quot;Actions&quot;, class: &quot;file-table__actions&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="179">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_table_body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="180">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :tbody do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="181">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      files.map { |file| render(CloudFileItemComponent.new(file: file, view_mode: &quot;list&quot;)) }.join.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="185">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def pagination_info</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="186">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless pagination</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            

            
              
            

            <code class="ruby">      current_page: pagination[:current_page],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">      total_pages: pagination[:total_pages],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">      total_count: pagination[:total_count],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">      per_page: pagination[:per_page]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="196">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_pagination</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="197">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
            

            <code class="ruby">    return unless pagination &amp;&amp; pagination[:total_pages] &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="199">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;pagination-container&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="200">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(pagination_info_text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="201">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(pagination_controls)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="205">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def pagination_info_text</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="206">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless pagination</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="208">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    start_item = ((pagination[:current_page] - 1) * pagination[:per_page]) + 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="209">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    end_item = [ start_item + pagination[:per_page] - 1, pagination[:total_count] ].min</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="211">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;pagination-info&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="212">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Showing #{start_item}-#{end_item} of #{pagination[:total_count]} files&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="216">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def pagination_controls</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="217">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;pagination-controls&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="218">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(prev_page_button)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="219">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(page_numbers)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="220">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      concat(next_page_button)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="224">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def prev_page_button</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="225">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless pagination &amp;&amp; pagination[:prev_page]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="227">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :button,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">                class: &quot;pagination__btn&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">                data: { action: &quot;click-&gt;cloud-file-browser#changePage&quot;, page: pagination[:prev_page] } do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="230">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;← Previous&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="234">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def next_page_button</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="235">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless pagination &amp;&amp; pagination[:next_page]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="237">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :button,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">                class: &quot;pagination__btn&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">                data: { action: &quot;click-&gt;cloud-file-browser#changePage&quot;, page: pagination[:next_page] } do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="240">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Next →&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="244">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def page_numbers</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="245">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless pagination</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="247">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_tag :span, class: &quot;pagination__info&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="248">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Page #{pagination[:current_page]} of #{pagination[:total_pages]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="252">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sync_status_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="253">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="then branch hit 23 times">
                  then: 23
                </span>
              
            

            <code class="ruby">    if integration.cloud_files.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="254">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">      last_sync = integration.cloud_files.maximum(:last_synced_at)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="255">
            
              <span class="hits">23</span>
            

            
              
                <span class="hits" title="then branch hit 15 times">
                  then: 15
                </span>
              
            

            <code class="ruby">      if last_sync</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="256">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">        &quot;Last synced #{time_ago_in_words(last_sync)} ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="258">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        &quot;Never synced&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="261">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;No files synced&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="265">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def total_file_size</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="11" data-linenumber="266">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return 0 unless files.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="268">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    files.sum { |file| file.size || 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="271">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def formatted_total_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="272">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    helpers.number_to_human_size(total_file_size)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6553a17182f72672beee3f9b8eece952599a92c5">
  <div class="header">
    <h3>app/components/cloud_file_item_component.rb</h3>
    <h4>
      <span class="green">
  94.7%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  78.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>132</b> relevant lines.
      <span class="green"><b>125</b> lines covered</span> and
      <span class="red"><b>7</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>60</b> total branches, </span>
          <span class="green"><b>47</b> branches covered</span> and
          <span class="red"><b>13</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudFileItemComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(file:, view_mode: &quot;grid&quot;, selectable: true, show_actions: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="5">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    @file = file</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="6">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    @view_mode = view_mode</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="7">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    @selectable = selectable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="8">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    @show_actions = show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="11">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :file, :view_mode, :selectable, :show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def item_css_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="16">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    classes = [ &quot;file-item&quot;, &quot;file-item--#{view_mode}&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="17">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 53 times">
                  then: 53
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; &quot;file-item--importable&quot; if file.importable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="18">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
                <span class="hits" title="else branch hit 35 times">
                  else: 35
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; &quot;file-item--synced&quot; if file.synced?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="19">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    classes &lt;&lt; &quot;file-item--#{file_type}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="20">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="23">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="108" data-linenumber="24">
            
              <span class="hits">108</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 106 times">
                  else: 106
                </span>
              
            

            <code class="ruby">    return &quot;document&quot; if file.google_doc?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="106" data-linenumber="25">
            
              <span class="hits">106</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 104 times">
                  else: 104
                </span>
              
            

            <code class="ruby">    return &quot;pdf&quot; if file.pdf?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="26">
            
              <span class="hits">104</span>
            

            
              
                <span class="hits" title="then branch hit 98 times">
                  then: 98
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    return &quot;text&quot; if file.text?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="27">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    return &quot;word&quot; if file.word_doc?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="28">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    return &quot;image&quot; if file.mime_type&amp;.start_with?(&quot;image/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="29">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    return &quot;video&quot; if file.mime_type&amp;.start_with?(&quot;video/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="30">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    return &quot;audio&quot; if file.mime_type&amp;.start_with?(&quot;audio/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="31">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    &quot;file&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="34">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_icon_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="35">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    &quot;file-icon file-icon--#{file_type}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="38">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_size_display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="39">
            
              <span class="hits">54</span>
            

            
              
            

            <code class="ruby">    file.human_size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="42">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_date_display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="43">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="else branch hit 52 times">
                  else: 52
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return &quot;Unknown&quot; unless file.updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="45">
            
              <span class="hits">52</span>
            

            
              
                <span class="hits" title="then branch hit 50 times">
                  then: 50
                </span>
              
            

            <code class="ruby">    if view_mode == &quot;grid&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="46">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">      time_ago_in_words(file.updated_at) + &quot; ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      file.updated_at.strftime(&quot;%b %d, %Y at %l:%M %p&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="52">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sync_status_badge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="53">
            
              <span class="hits">105</span>
            

            
              
                <span class="hits" title="then branch hit 36 times">
                  then: 36
                </span>
              
            

            <code class="ruby">    if file.synced?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="54">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      { class: &quot;badge badge--synced&quot;, text: &quot;Synced&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
                <span class="hits" title="else branch hit 69 times">
                  else: 69
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="56">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">      { class: &quot;badge badge--needs-sync&quot;, text: &quot;Needs Sync&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="60">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def importable_badge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="208" data-linenumber="61">
            
              <span class="hits">208</span>
            

            
              
                <span class="hits" title="else branch hit 206 times">
                  else: 206
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return nil unless file.importable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="206" data-linenumber="62">
            
              <span class="hits">206</span>
            

            
              
            

            <code class="ruby">    { class: &quot;badge badge--importable&quot;, text: &quot;Importable&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="65">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_badges</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="66">
            
              <span class="hits">105</span>
            

            
              
            

            <code class="ruby">    badges = []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="67">
            
              <span class="hits">105</span>
            

            
              
            

            <code class="ruby">    badges &lt;&lt; sync_status_badge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="68">
            
              <span class="hits">105</span>
            

            
              
                <span class="hits" title="then branch hit 103 times">
                  then: 103
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    badges &lt;&lt; importable_badge if importable_badge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="69">
            
              <span class="hits">105</span>
            

            
              
            

            <code class="ruby">    badges.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="72">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def item_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="74">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      &#39;file-id&#39;: file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="75">
            
              <span class="hits">51</span>
            

            
              
                <span class="hits" title="then branch hit 50 times">
                  then: 50
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      action: selectable ? &quot;click-&gt;cloud-file-browser#toggleFileSelection&quot; : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">    }.compact</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="79">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def checkbox_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="81">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">      &#39;file-id&#39;: file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      action: &quot;change-&gt;cloud-file-browser#toggleFileSelection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="86">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def preview_action_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="87">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      action: &quot;click-&gt;cloud-file-browser#previewFile&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      &#39;file-id&#39;: file.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="93">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def import_action_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="94">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      action: &quot;click-&gt;cloud-file-browser#importFile&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      &#39;file-id&#39;: file.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="100">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def download_action_data</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      action: &quot;click-&gt;cloud-file-browser#downloadFile&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      &#39;file-id&#39;: file.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="107">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_actions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="108">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">    actions = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="110">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="then branch hit 52 times">
                  then: 52
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if file.importable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="111">
            
              <span class="hits">52</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">        text: &quot;Import&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">        icon: &quot;import&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">        class: &quot;btn btn--primary btn--sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">        data: import_action_data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">        title: &quot;Import this file as a document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="120">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">    actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">      text: &quot;Preview&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      icon: &quot;eye&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      class: &quot;btn btn--secondary btn--sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">      data: preview_action_data,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      title: &quot;Preview file contents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="128">
            
              <span class="hits">53</span>
            

            
              
                <span class="hits" title="then branch hit 51 times">
                  then: 51
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    if file.provider_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="129">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      actions &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">        text: &quot;Open&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">        icon: &quot;external-link&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">        class: &quot;btn btn--secondary btn--sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">        href: file.provider_url,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">        target: &quot;_blank&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">        title: &quot;Open in #{file.cloud_integration.provider_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="53" data-linenumber="139">
            
              <span class="hits">53</span>
            

            
              
            

            <code class="ruby">    actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="142">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_grid_item</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="143">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: item_css_classes, data: item_data_attributes do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="144">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      concat(render_file_thumbnail)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="145">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      concat(render_file_info)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="146">
            
              <span class="hits">51</span>
            

            
              
                <span class="hits" title="then branch hit 50 times">
                  then: 50
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      concat(render_file_actions) if show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="150">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_list_item</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="151">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :tr, class: item_css_classes, data: { &#39;file-id&#39;: file.id } do</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="152">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      concat(render_checkbox_cell) if selectable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="153">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_name_cell)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="154">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_size_cell)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="155">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_date_cell)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="156">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_status_cell)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="157">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      concat(render_actions_cell) if show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="161">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_file_thumbnail</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="162">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;file-item__thumbnail&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="163">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      content_tag :i, &quot;&quot;, class: file_icon_class, data: { type: file.mime_type }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="167">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_file_info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="168">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;file-item__info&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="169">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:h3, file.name, class: &quot;file-item__name&quot;, title: file.name))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="170">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:p, &quot;#{file_size_display} • #{file_date_display}&quot;, class: &quot;file-item__meta&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="171">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      concat(render_file_badges)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="175">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_file_badges</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="51" data-linenumber="176">
            
              <span class="hits">51</span>
            

            
              
                <span class="hits" title="else branch hit 51 times">
                  else: 51
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless file_badges.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="178">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;file-item__badges&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="179">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      file_badges.map do |badge|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="101" data-linenumber="180">
            
              <span class="hits">101</span>
            

            
              
            

            <code class="ruby">        content_tag(:span, badge[:text], class: badge[:class])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">      end.join.html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="185">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_file_actions</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="50" data-linenumber="186">
            
              <span class="hits">50</span>
            

            
              
                <span class="hits" title="else branch hit 50 times">
                  else: 50
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="188">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;file-item__actions&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="189">
            
              <span class="hits">50</span>
            

            
              
                <span class="hits" title="then branch hit 49 times">
                  then: 49
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      if selectable</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="190">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:input, &quot;&quot;, type: &quot;checkbox&quot;, class: &quot;file-checkbox&quot;, data: checkbox_data_attributes))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="193">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">      file_actions.each do |action|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="148" data-linenumber="194">
            
              <span class="hits">148</span>
            

            
              
                <span class="hits" title="then branch hit 49 times">
                  then: 49
                </span>
              
            

            <code class="ruby">        if action[:href]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="195">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">          concat(link_to(action[:href], class: action[:class], target: action[:target], title: action[:title]) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="196">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">            content_tag(:i, &quot;&quot;, class: &quot;icon icon--#{action[:icon]}&quot;) + &quot; &quot; + action[:text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">          end)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
                <span class="hits" title="else branch hit 99 times">
                  else: 99
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="199">
            
              <span class="hits">99</span>
            

            
              
            

            <code class="ruby">          concat(content_tag(:button, class: action[:class], data: action[:data], title: action[:title]) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="99" data-linenumber="200">
            
              <span class="hits">99</span>
            

            
              
            

            <code class="ruby">            content_tag(:i, &quot;&quot;, class: &quot;icon icon--#{action[:icon]}&quot;) + &quot; &quot; + action[:text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">          end)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">  # Table view cells</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="208">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_checkbox_cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="209">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :td, class: &quot;file-item__checkbox&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="210">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      content_tag :input, &quot;&quot;, type: &quot;checkbox&quot;, class: &quot;file-checkbox&quot;, data: checkbox_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="214">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_name_cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="215">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :td, class: &quot;file-item__name&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="216">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      content_tag :div, class: &quot;file-name-wrapper&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="217">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:i, &quot;&quot;, class: file_icon_class, data: { type: file.mime_type }))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="218">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        concat(content_tag(:span, file.name, class: &quot;file-name&quot;, title: file.name))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="223">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_size_cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="224">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :td, file_size_display, class: &quot;file-item__size&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="227">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_date_cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="228">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :td, file_date_display, class: &quot;file-item__date&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="231">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_status_cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="232">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :td, class: &quot;file-item__status&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="233">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      file_badges.map do |badge|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="234">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        content_tag(:span, badge[:text], class: badge[:class])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">      end.join(&quot; &quot;).html_safe</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="239">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render_actions_cell</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="240">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :td, class: &quot;file-item__actions&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="241">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      file_actions.each do |action|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="242">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        if action[:href]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="243">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          concat(link_to(action[:href], class: action[:class], target: action[:target], title: action[:title]) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="244">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">            content_tag(:i, &quot;&quot;, class: &quot;icon icon--#{action[:icon]}&quot;) + &quot; &quot; + action[:text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">          end)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="247">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">          concat(content_tag(:button, class: action[:class], data: action[:data], title: action[:title]) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="248">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">            content_tag(:i, &quot;&quot;, class: &quot;icon icon--#{action[:icon]}&quot;) + &quot; &quot; + action[:text]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">          end)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="255">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_metadata</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="257">
            

            
              
            

            <code class="ruby">      id: file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">      name: file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">      size: file.size,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">      mime_type: file.mime_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">      importable: file.importable?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">      synced: file.synced?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">      provider: file.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">      created_at: file.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">      updated_at: file.updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="269">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def provider_icon</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="270">
            

            
              
            

            <code class="ruby">    case file.provider</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="271">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="272">
            

            
              
            

            <code class="ruby">      &quot;google-drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="273">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="274">
            

            
              
            

            <code class="ruby">      &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="275">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="276">
            

            
              
            

            <code class="ruby">      &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="277">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="278">
            

            
              
            

            <code class="ruby">      &quot;cloud&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9f6b0098c5fe22ff8b465a84bedfa3974de9f09c">
  <div class="header">
    <h3>app/components/cloud_provider_component.rb</h3>
    <h4>
      <span class="yellow">
  88.31%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  67.86%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>77</b> relevant lines.
      <span class="green"><b>68</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>56</b> total branches, </span>
          <span class="green"><b>38</b> branches covered</span> and
          <span class="red"><b>18</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudProviderComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(provider:, integration: nil, show_stats: true, show_actions: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="5">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    @provider = provider</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="6">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    @integration = integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="7">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    @show_stats = show_stats</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="8">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    @show_actions = show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="11">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :provider, :integration, :show_stats, :show_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def connected?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="218" data-linenumber="16">
            
              <span class="hits">218</span>
            

            
              
                <span class="hits" title="then branch hit 127 times">
                  then: 127
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    integration.present? &amp;&amp; integration&amp;.active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def provider_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="83" data-linenumber="20">
            
              <span class="hits">83</span>
            

            
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
                <span class="hits" title="when branch hit 51 times">
                  when: 51
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="22">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      &quot;Google Drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
                <span class="hits" title="when branch hit 15 times">
                  when: 15
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="24">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      &quot;Dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
                <span class="hits" title="when branch hit 17 times">
                  when: 17
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="26">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      &quot;Notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="27">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">      provider.humanize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="32">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def provider_icon_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="33">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    &quot;provider-icon provider-icon--#{provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def status_badge_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="37">
            
              <span class="hits">31</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    if connected?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="38">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      &quot;status-badge status-badge--connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="40">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      &quot;status-badge status-badge--disconnected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="44">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def status_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="45">
            
              <span class="hits">31</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    if connected?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if integration.expired?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">        &quot;Token Expired&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="48">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">      elsif integration.needs_refresh?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="49">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        &quot;Needs Refresh&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="51">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        &quot;Connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="54">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      &quot;Not Connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="58">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def file_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="16" data-linenumber="59">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 16 times">
                  then: 16
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 16 times">
                  then: 16
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    integration&amp;.cloud_files&amp;.count || 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="62">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def last_sync_text</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="16" data-linenumber="63">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 16 times">
                  then: 16
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 16 times">
                  then: 16
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
            

            <code class="ruby">    return &quot;Never&quot; unless integration&amp;.cloud_files&amp;.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="65">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    last_sync = integration.cloud_files.order(:last_synced_at).last&amp;.last_synced_at</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="66">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
            

            <code class="ruby">    return &quot;Never&quot; unless last_sync</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    time_ago_in_words(last_sync) + &quot; ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="71">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def connect_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="72">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    &quot;/cloud_integrations/new?provider=#{provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="75">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def files_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="12" data-linenumber="76">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="else branch hit 12 times">
                  else: 12
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless connected?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="77">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    &quot;/cloud_integrations/#{integration.id}/cloud_files&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="80">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def disconnect_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="81">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return nil unless connected?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            

            
              
            

            <code class="ruby">    &quot;/cloud_integrations/#{integration.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="85">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def provider_description</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="86">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="88">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      &quot;Import documents from Google Drive and export your work back to Drive.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="90">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      &quot;Sync files with Dropbox for seamless document management.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="92">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      &quot;Connect to Notion to import pages and export documents as Notion pages.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;Connect your #{provider_name} account to import and export documents.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="98">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def integration_data</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="99">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return {} unless integration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            

            
              
            

            <code class="ruby">      id: integration.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      provider: integration.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      active: integration.active?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      expires_at: integration.expires_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      file_count: file_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      last_sync: integration.cloud_files.maximum(:last_synced_at)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="111">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def oauth_controller_data</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="112">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    return {} if connected?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="114">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      controller: &quot;cloud-oauth&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      &#39;cloud-oauth-provider-value&#39;: provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      &#39;cloud-oauth-auth-url-value&#39;: connect_url,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      &#39;cloud-oauth-width-value&#39;: oauth_popup_width,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">      &#39;cloud-oauth-height-value&#39;: oauth_popup_height</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="123">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def oauth_popup_width</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="124">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="125">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot; then 500</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="126">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot; then 600</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="127">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot; then 700</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            

            
              
            

            <code class="ruby">    else 600</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="132">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def oauth_popup_height</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="133">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="134">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot; then 600</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="135">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot; then 700</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="136">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot; then 800</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            

            
              
            

            <code class="ruby">    else 700</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="141">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def card_css_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="142">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    classes = [ &quot;provider-card&quot;, &quot;provider-card--#{provider}&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="143">
            
              <span class="hits">31</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; (connected? ? &quot;provider-card--connected&quot; : &quot;provider-card--disconnected&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="144">
            
              <span class="hits">31</span>
            

            
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 30 times">
                  else: 30
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; &quot;provider-card--expired&quot; if integration&amp;.expired?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="145">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="148">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sync_status_data</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="17" data-linenumber="149">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return {} unless connected?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="152">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      &#39;integration-id&#39;: integration.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      target: &quot;cloud-integration-manager.syncStatus&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="81e992361caa0f2b2ff9aaac25882a2ed124ce3a">
  <div class="header">
    <h3>app/components/cloud_sync_status_component.rb</h3>
    <h4>
      <span class="red">
  79.43%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  52.17%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>141</b> relevant lines.
      <span class="green"><b>112</b> lines covered</span> and
      <span class="red"><b>29</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>69</b> total branches, </span>
          <span class="green"><b>36</b> branches covered</span> and
          <span class="red"><b>33</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="3">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">class CloudSyncStatusComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="4">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def initialize(integrations: [], current_user: nil, show_global: true, show_details: true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @integrations = integrations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="7">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @show_global = show_global</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="8">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @show_details = show_details</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="11">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="13">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  attr_reader :integrations, :current_user, :show_global, :show_details</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="15">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def component_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="16">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      controller: &quot;cloud-sync-status&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="18">
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      &#39;cloud-sync-status-user-id-value&#39;: current_user&amp;.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      &#39;cloud-sync-status-refresh-interval-value&#39;: 30000</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="23">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def component_css_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="24">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    classes = [ &quot;cloud-sync-status&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="25">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; &quot;cloud-sync-status--global&quot; if show_global</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="26">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
            

            <code class="ruby">    classes &lt;&lt; &quot;cloud-sync-status--detailed&quot; if show_details</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="27">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="30">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def has_integrations?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="31">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="34">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def connected_integrations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="35">
            
              <span class="hits">44</span>
            

            
              
            

            <code class="ruby">    @connected_integrations ||= integrations.select(&amp;:active?)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="38">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def syncing_integrations</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    # This would be determined by checking background job status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    # For now, we&#39;ll simulate based on recent sync activity</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="41">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">    @syncing_integrations ||= connected_integrations.select do |integration|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      # Check if sync was started recently (within last 5 minutes)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="43">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      integration.cloud_files.exists?([ &quot;last_synced_at &gt; ?&quot;, 5.minutes.ago ]) ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      has_active_sync_job?(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="48">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def has_active_sync_job?(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    # This would check for active CloudFileSyncJob instances</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    # For now, return false as we don&#39;t have job tracking implemented</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="51">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="54">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def global_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="16" data-linenumber="55">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return &quot;no_integrations&quot; unless has_integrations?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="16" data-linenumber="56">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 16 times">
                  else: 16
                </span>
              
            

            <code class="ruby">    return &quot;syncing&quot; if syncing_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="57">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    return &quot;connected&quot; if connected_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="58">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    &quot;disconnected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="61">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def global_status_text</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="62">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    case global_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="63">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;no_integrations&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">      &quot;No cloud integrations configured&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="65">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;syncing&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="66">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      &quot;Syncing #{syncing_integrations.count} integration#{syncing_integrations.count &gt; 1 ? &#39;s&#39; : &#39;&#39;}...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when &quot;connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="68">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      &quot;#{connected_integrations.count} integration#{connected_integrations.count &gt; 1 ? &#39;s&#39; : &#39;&#39;} connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;disconnected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;All integrations disconnected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="71">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">      &quot;Unknown status&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="76">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def global_status_icon</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="77">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    case global_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="78">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;no_integrations&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            

            
              
            

            <code class="ruby">      &quot;cloud-off&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="80">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;syncing&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">      &quot;sync&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when &quot;connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="83">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      &quot;cloud-check&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;disconnected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="85">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;cloud-off&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="86">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            

            
              
            

            <code class="ruby">      &quot;cloud&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="91">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def status_color_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="92">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    case global_status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;no_integrations&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;sync-status--neutral&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="95">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;syncing&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            

            
              
            

            <code class="ruby">      &quot;sync-status--syncing&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when &quot;connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="98">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      &quot;sync-status--success&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;disconnected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;sync-status--error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="101">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            

            
              
            

            <code class="ruby">      &quot;sync-status--neutral&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="106">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def total_files_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="107">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    @total_files_count ||= connected_integrations.sum { |i| i.cloud_files.count }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="110">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def last_sync_time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="111">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless connected_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="113">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @last_sync_time ||= begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="114">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      all_files = connected_integrations.flat_map(&amp;:cloud_files)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="115">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      return nil if all_files.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            

            
              
            

            <code class="ruby">      all_files.filter_map(&amp;:last_synced_at).max</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="121">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def last_sync_text</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="122">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">    return &quot;Never synced&quot; unless last_sync_time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            
              
            

            <code class="ruby">    &quot;Last synced #{time_ago_in_words(last_sync_time)} ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="127">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def sync_progress_data</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="128">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return {} unless syncing_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">    # This would be populated from actual job progress</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">    # For now, we&#39;ll return empty data</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            

            
              
            

            <code class="ruby">    {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="135">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def integration_status_list</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="136">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return [] unless show_details</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="138">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    integrations.map do |integration|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="140">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        id: integration.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">        name: integration.provider_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">        provider: integration.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">        active: integration.active?,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">        syncing: syncing_integrations.include?(integration),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">        file_count: integration.cloud_files.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">        last_sync: integration.cloud_files.maximum(:last_synced_at),</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="147">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">        error: integration.expired? ? &quot;Token expired&quot; : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="152">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_integration_status(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="153">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    css_class = [ &quot;integration-status&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="154">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    css_class &lt;&lt; &quot;integration-status--active&quot; if status[:active]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="155">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    css_class &lt;&lt; &quot;integration-status--syncing&quot; if status[:syncing]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="156">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    css_class &lt;&lt; &quot;integration-status--error&quot; if status[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="158">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: css_class.join(&quot; &quot;), data: { &#39;integration-id&#39;: status[:id] } do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="159">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_integration_icon(status))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="160">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_integration_info(status))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="161">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_integration_sync_indicator(status))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="165">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_integration_icon(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="166">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    icon_class = &quot;provider-icon provider-icon--#{status[:provider]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="168">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;integration-status__icon&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="169">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      content_tag :i, &quot;&quot;, class: icon_class</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="173">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_integration_info(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="174">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;integration-status__info&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="175">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:div, status[:name], class: &quot;integration-status__name&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="176">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(render_integration_meta(status))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="180">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_integration_meta(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="181">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    meta_parts = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="183">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    if status[:active]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="184">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      meta_parts &lt;&lt; pluralize(status[:file_count], &quot;file&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="186">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      if status[:last_sync]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="187">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        meta_parts &lt;&lt; &quot;synced #{time_ago_in_words(status[:last_sync])} ago&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="189">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        meta_parts &lt;&lt; &quot;never synced&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="191">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="192">
            

            
              
            

            <code class="ruby">      meta_parts &lt;&lt; &quot;not connected&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="195">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    if status[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            

            
              
            

            <code class="ruby">      meta_parts &lt;&lt; status[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="199">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, meta_parts.join(&quot; • &quot;), class: &quot;integration-status__meta&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="202">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_integration_sync_indicator(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="203">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    indicator_class = [ &quot;sync-indicator&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="204">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    indicator_text = &quot;Ready&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="206">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if status[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            

            
              
            

            <code class="ruby">      indicator_class &lt;&lt; &quot;sync-indicator--error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="208">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      indicator_text = &quot;Error&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="209">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    elsif status[:syncing]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            

            
              
            

            <code class="ruby">      indicator_class &lt;&lt; &quot;sync-indicator--syncing&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      indicator_text = &quot;Syncing...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="212">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    elsif status[:active]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="213">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      indicator_class &lt;&lt; &quot;sync-indicator--ready&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="214">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      indicator_text = &quot;Ready&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="215">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="216">
            

            
              
            

            <code class="ruby">      indicator_class &lt;&lt; &quot;sync-indicator--inactive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="217">
            

            
              
            

            <code class="ruby">      indicator_text = &quot;Inactive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="220">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;integration-status__sync&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="221">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:div, &quot;&quot;, class: indicator_class.join(&quot; &quot;)))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="222">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:span, indicator_text, class: &quot;sync-indicator__text&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="226">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_sync_progress</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="227">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless syncing_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="229">
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;sync-progress&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="230">
            

            
              
            

            <code class="ruby">      concat(content_tag(:div, &quot;Syncing in progress...&quot;, class: &quot;sync-progress__text&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="231">
            

            
              
            

            <code class="ruby">      concat(render_progress_bar)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="235">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_progress_bar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">    # This would show actual progress from background jobs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">    # For now, we&#39;ll show an indeterminate progress bar</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="239">
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;progress-bar progress-bar--indeterminate&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="240">
            

            
              
            

            <code class="ruby">      content_tag :div, &quot;&quot;, class: &quot;progress-bar__fill&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="244">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_global_actions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="245">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless show_global &amp;&amp; connected_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="247">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;sync-status__actions&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="248">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if syncing_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="249">
            

            
              
            

            <code class="ruby">        content_tag(:span, &quot;Sync in progress...&quot;, class: &quot;sync-status__note&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="251">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        content_tag(:button,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">                   class: &quot;btn btn--sm btn--secondary&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">                   data: { action: &quot;click-&gt;cloud-sync-status#syncAll&quot; }) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="254">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          content_tag(:i, &quot;&quot;, class: &quot;icon icon--sync&quot;) + &quot; Sync All&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="260">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def render_empty_state</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="261">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_tag :div, class: &quot;sync-status__empty&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="262">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:div, class: &quot;empty-state__icon&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="263">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        content_tag(:i, &quot;&quot;, class: &quot;icon icon--cloud-off&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">      end)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="265">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:h3, &quot;No Cloud Integrations&quot;, class: &quot;empty-state__title&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="266">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:p, &quot;Connect to cloud providers to sync your files.&quot;, class: &quot;empty-state__message&quot;))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="267">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      concat(content_tag(:div, class: &quot;empty-state__actions&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="268">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        link_to(&quot;Connect Provider&quot;, &quot;/cloud_integrations&quot;, class: &quot;btn btn--primary&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">      end)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="273">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def auto_refresh?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">    # Only auto-refresh if there are active syncs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="275">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    syncing_integrations.any?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="278">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def refresh_interval</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">    # Refresh every 5 seconds during sync, 30 seconds otherwise</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="280">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    syncing_integrations.any? ? 5000 : 30000</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2ba6c1c0063afea732d6f5fd19caa1f69dc693c4">
  <div class="header">
    <h3>app/components/context_item_preview_component.rb</h3>
    <h4>
      <span class="yellow">
  87.32%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  51.92%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>71</b> relevant lines.
      <span class="green"><b>62</b> lines covered</span> and
      <span class="red"><b>9</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>52</b> total branches, </span>
          <span class="green"><b>27</b> branches covered</span> and
          <span class="red"><b>25</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ContextItemPreviewComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  include ActionView::Helpers::SanitizeHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  include ActionView::Helpers::TextHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="7">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  renders_one :primary_action</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="10">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  renders_many :secondary_actions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="12">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(context_item:)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="13">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @context_item = context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="16">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def render?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    context_item.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="20">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def modal_id</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="21">
            
              <span class="hits">55</span>
            

            
              
            

            <code class="ruby">    &quot;context-item-preview-#{context_item.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="24">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def content_type_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="25">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    case detect_content_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :markdown</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;markdown-content&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
                <span class="hits" title="when branch hit 8 times">
                  when: 8
                </span>
              
            

            <code class="ruby">    when :code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="29">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      &quot;code-content&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="30">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">      &quot;plain-text-content&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="35">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def formatted_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="36">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    case detect_content_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :markdown</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      sanitize_markdown(context_item.content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
                <span class="hits" title="when branch hit 8 times">
                  when: 8
                </span>
              
            

            <code class="ruby">    when :code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="40">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      prepare_code_content(context_item.content)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="41">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">      simple_format(sanitize(context_item.content))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="46">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def code_language</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="47">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="else branch hit 33 times">
                  else: 33
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return nil unless detect_content_type == :code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="49">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">    detect_language_from_content ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    extract_language_from_metadata ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    &quot;plaintext&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="54">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def preview_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="55">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      controller: &quot;context-item-preview&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      context_item_preview_id_value: context_item.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      context_item_preview_type_value: context_item.item_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      context_item_preview_content_type_value: detect_content_type.to_s,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      context_item_preview_modal_id_value: modal_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="64">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def item_type_badge_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="65">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    case context_item.item_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
                <span class="hits" title="when branch hit 9 times">
                  when: 9
                </span>
              
            

            <code class="ruby">    when &quot;snippet&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="67">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      &quot;bg-blue-100 text-blue-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;draft&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="69">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;bg-yellow-100 text-yellow-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;version&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;bg-green-100 text-green-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">      &quot;bg-gray-100 text-gray-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="77">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="79">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def detect_content_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="80">
            
              <span class="hits">110</span>
            

            
              
                <span class="hits" title="then branch hit 99 times">
                  then: 99
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    return :code if code_content?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="81">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return :markdown if markdown_content?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    :plain_text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="85">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def markdown_content?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    # Check for common markdown patterns</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="87">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    content = context_item.content</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="11" data-linenumber="88">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 11 times">
                  then: 11
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    return true if context_item.metadata&amp;.dig(&quot;content_type&quot;) == &quot;markdown&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    # Look for markdown indicators (excluding code blocks which are handled separately)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="91">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    content.match?(/^\#{1,6}\s+/m) || # Headers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">    content.match?(/\*\*[^*]+\*\*/) || # Bold</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    content.match?(/\[[^\]]+\]\([^)]+\)/) || # Links</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    content.match?(/^[-*+]\s+/m) # Lists</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="97">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def code_content?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="110" data-linenumber="98">
            
              <span class="hits">110</span>
            

            
              
                <span class="hits" title="then branch hit 110 times">
                  then: 110
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 110 times">
                  else: 110
                </span>
              
            

            <code class="ruby">    return true if context_item.metadata&amp;.dig(&quot;content_type&quot;) == &quot;code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="110" data-linenumber="99">
            
              <span class="hits">110</span>
            

            
              
                <span class="hits" title="then branch hit 110 times">
                  then: 110
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 87 times">
                  then: 87
                </span>
              
                <span class="hits" title="else branch hit 23 times">
                  else: 23
                </span>
              
            

            <code class="ruby">    return true if context_item.metadata&amp;.dig(&quot;language&quot;).present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">    # Look for code indicators</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="102">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">    content = context_item.content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">    # Check for fenced code blocks first (strongest indicator)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="23" data-linenumber="105">
            
              <span class="hits">23</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 23 times">
                  else: 23
                </span>
              
            

            <code class="ruby">    return true if content.match?(/^```[\w]*\n.*\n```$/m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">    # Check for common programming language keywords</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="108">
            
              <span class="hits">23</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    return true if content.match?(/^\s*(def|class|module|function|const|let|var|import|require|from|export)\s+/m)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">    # Check for code-like patterns (with more specificity)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="11" data-linenumber="111">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    return true if content.match?(/[{};]\s*$/m) &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">                  content.length &gt; 10 &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">                  content.count(&quot;{&quot;) &gt; 0 &amp;&amp;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">                  content.count(&quot;}&quot;) &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="116">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="119">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sanitize_markdown(content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">    # For now, just treat markdown as plain text with basic formatting</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">    # In a real app, you&#39;d want to use a proper markdown processor like Redcarpet or Kramdown</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    # and then sanitize the output</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">    # Basic markdown-to-HTML conversion for testing</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html_content = content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      .gsub(/^# (.+)$/, &#39;&lt;h1&gt;\1&lt;/h1&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      .gsub(/^## (.+)$/, &#39;&lt;h2&gt;\1&lt;/h2&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      .gsub(/^### (.+)$/, &#39;&lt;h3&gt;\1&lt;/h3&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      .gsub(/\*\*([^*]+)\*\*/, &#39;&lt;strong&gt;\1&lt;/strong&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      .gsub(/\*([^*]+)\*/, &#39;&lt;em&gt;\1&lt;/em&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">      .gsub(/\n\n/, &quot;&lt;/p&gt;&lt;p&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      .prepend(&quot;&lt;p&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      .concat(&quot;&lt;/p&gt;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">    # Allow safe markdown-related HTML tags</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="136">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    allowed_tags = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      p br strong em u i b code pre blockquote</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      h1 h2 h3 h4 h5 h6 ul ol li a img hr</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      table thead tbody tr td th</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">    allowed_attributes = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;a&quot; =&gt; %w[href title target rel],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      &quot;img&quot; =&gt; %w[src alt title width height],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      &quot;code&quot; =&gt; %w[class],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      &quot;pre&quot; =&gt; %w[class data-language]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="149">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sanitize(html_content, tags: allowed_tags, attributes: allowed_attributes)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="152">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def prepare_code_content(content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">    # Remove any markdown code fence markers if present</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="154">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    clean_content = content.gsub(/^```[\w]*\n?/, &quot;&quot;).gsub(/\n?```$/, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">    # Escape HTML to prevent XSS but preserve for syntax highlighting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="157">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    escaped_content = ERB::Util.html_escape(clean_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="159">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    content_tag(:pre,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">      content_tag(:code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">        escaped_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">        class: &quot;language-#{code_language}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">        data: { language: code_language }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">      ),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">      class: &quot;code-block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">      data: { controller: &quot;syntax-highlight&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="170">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def detect_language_from_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="171">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">    content = context_item.content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">    # Check for fenced code block with language</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="174">
            
              <span class="hits">33</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 32 times">
                  else: 32
                </span>
              
            

            <code class="ruby">    if match = content.match(/^```(\w+)/)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="175">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return match[1]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">    # Detect by file extension patterns in content</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="32" data-linenumber="179">
            
              <span class="hits">32</span>
            

            
              
                <span class="hits" title="then branch hit 32 times">
                  then: 32
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;ruby&quot; if content.match?(/\.rb\b/) || content.match?(/^\s*(class|module|def|end)\s+/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="180">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;javascript&quot; if content.match?(/\.js\b/) || content.match?(/^\s*(function|const|let|var)\s+/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="181">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;css&quot; if content.match?(/\.css\b/) || content.match?(/^\s*[.#][\w-]+\s*\{/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="182">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;html&quot; if content.match?(/\.html?\b/) || content.match?(/^\s*&lt;[^&gt;]+&gt;/)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="183">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;sql&quot; if content.match?(/^\s*(SELECT|INSERT|UPDATE|DELETE|CREATE|ALTER|DROP)\s+/i)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            

            
              
            

            <code class="ruby">    nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="188">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def extract_language_from_metadata</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="189">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    context_item.metadata&amp;.dig(&quot;language&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="190">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    context_item.metadata&amp;.dig(&quot;file_type&quot;) ||</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="191">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    context_item.metadata&amp;.dig(&quot;syntax&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="dead27ca8943d78ebb74a74b94091caa9a0ae291">
  <div class="header">
    <h3>app/components/context_sidebar_component.rb</h3>
    <h4>
      <span class="red">
  75.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  41.94%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>76</b> relevant lines.
      <span class="green"><b>57</b> lines covered</span> and
      <span class="red"><b>19</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>31</b> total branches, </span>
          <span class="green"><b>13</b> branches covered</span> and
          <span class="red"><b>18</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ContextSidebarComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(document:, current_user:, active_tab: &quot;snippets&quot;, sort_by: &quot;recent&quot;, search_query: &quot;&quot;, filter_type: &quot;&quot;, date_from: nil, date_to: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="5">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @document = document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="6">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="7">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @active_tab = active_tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="8">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @sort_by = sort_by</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="9">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @search_query = search_query</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="10">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @filter_type = filter_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="11">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @date_from = date_from</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="12">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    @date_to = date_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :document, :current_user, :active_tab, :sort_by, :search_query, :filter_type, :date_from, :date_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def context_items</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="20">
            
              <span class="hits">72</span>
            

            
              
            

            <code class="ruby">    @context_items ||= document.context_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="23">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def filtered_items(type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="24">
            
              <span class="hits">72</span>
            

            
              
            

            <code class="ruby">    items = context_items.send(type.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    # Apply search and filters using the model&#39;s filtered_search scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="27">
            
              <span class="hits">72</span>
            

            
              
            

            <code class="ruby">    items = items.filtered_search(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      query: search_query,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      item_type: filter_type.presence,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      date_from: date_from,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      date_to: date_to</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    # Apply sorting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="35">
            
              <span class="hits">72</span>
            

            
              
            

            <code class="ruby">    case sort_by</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
                <span class="hits" title="when branch hit 66 times">
                  when: 66
                </span>
              
            

            <code class="ruby">    when &quot;recent&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="66" data-linenumber="37">
            
              <span class="hits">66</span>
            

            
              
            

            <code class="ruby">      items.order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">    when &quot;alphabetical&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="39">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      items.order(title: :asc)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="40">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;modified&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">      items.order(updated_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="42">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;manual&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            

            
              
            

            <code class="ruby">      items.ordered</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="44">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            

            
              
            

            <code class="ruby">      items.recent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="49">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def snippets</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="78" data-linenumber="50">
            
              <span class="hits">78</span>
            

            
              
            

            <code class="ruby">    @snippets ||= filtered_items(:snippets)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="53">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def drafts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="54">
            
              <span class="hits">63</span>
            

            
              
            

            <code class="ruby">    @drafts ||= filtered_items(:drafts)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="57">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def versions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="58">
            
              <span class="hits">60</span>
            

            
              
            

            <code class="ruby">    @versions ||= filtered_items(:versions)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="61">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def tab_classes(tab)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="62">
            
              <span class="hits">72</span>
            

            
              
            

            <code class="ruby">    base_classes = &quot;px-4 py-2 text-sm font-medium rounded-t-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="64">
            
              <span class="hits">72</span>
            

            
              
                <span class="hits" title="then branch hit 24 times">
                  then: 24
                </span>
              
            

            <code class="ruby">    if tab == active_tab</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="65">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-white text-blue-600 border-b-2 border-blue-600&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
                <span class="hits" title="else branch hit 48 times">
                  else: 48
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="48" data-linenumber="67">
            
              <span class="hits">48</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} text-gray-600 hover:text-gray-900 hover:bg-gray-50&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="71">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def item_icon(type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">    case type</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="73">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;snippet&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">      &quot;📋&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="75">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;draft&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">      &quot;📝&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="77">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;version&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            

            
              
            

            <code class="ruby">      &quot;📚&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="79">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            

            
              
            

            <code class="ruby">      &quot;📄&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="84">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def item_count(type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="72" data-linenumber="85">
            
              <span class="hits">72</span>
            

            
              
            

            <code class="ruby">    case type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
                <span class="hits" title="when branch hit 24 times">
                  when: 24
                </span>
              
            

            <code class="ruby">    when :snippets</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="87">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      snippets.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
                <span class="hits" title="when branch hit 24 times">
                  when: 24
                </span>
              
            

            <code class="ruby">    when :drafts</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="89">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      drafts.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
                <span class="hits" title="when branch hit 24 times">
                  when: 24
                </span>
              
            

            <code class="ruby">    when :versions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="91">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      versions.count</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="92">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            

            
              
            

            <code class="ruby">      0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="97">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def format_date(date)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="98">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if date.today?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="99">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      &quot;Today at #{date.strftime(&#39;%l:%M %p&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="100">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    elsif date.yesterday?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="101">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      &quot;Yesterday at #{date.strftime(&#39;%l:%M %p&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="102">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    elsif date &gt; 7.days.ago</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            

            
              
            

            <code class="ruby">      date.strftime(&quot;%A at %l:%M %p&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="104">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            

            
              
            

            <code class="ruby">      date.strftime(&quot;%B %d, %Y&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="109">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def truncate_content(content, length = 100)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="110">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return &quot;&quot; if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            

            
              
            

            <code class="ruby">    plain_text = ActionText::Content.new(content).to_plain_text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            

            
              
            

            <code class="ruby">    plain_text.truncate(length, separator: &quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="116">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def search_active?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="95" data-linenumber="117">
            
              <span class="hits">95</span>
            

            
              
            

            <code class="ruby">    search_query.present? || filter_type.present? || date_from.present? || date_to.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="120">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def search_results_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="121">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    @search_results_count ||= begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="122">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      count = 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="123">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      count += snippets.count if active_tab == &quot;snippets&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="124">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">      count += drafts.count if active_tab == &quot;drafts&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="125">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">      count += versions.count if active_tab == &quot;versions&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="126">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">      count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="130">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def date_range_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="132">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      [ &quot;All time&quot;, &quot;&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      [ &quot;Today&quot;, &quot;today&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      [ &quot;This week&quot;, &quot;week&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      [ &quot;This month&quot;, &quot;month&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      [ &quot;Last 3 months&quot;, &quot;quarter&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      [ &quot;This year&quot;, &quot;year&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="141">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def type_filter_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="143">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      [ &quot;All types&quot;, &quot;&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      [ &quot;Snippets only&quot;, &quot;snippet&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      [ &quot;Drafts only&quot;, &quot;draft&quot; ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      [ &quot;Versions only&quot;, &quot;version&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="150">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def highlighted_items(items)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="151">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return items unless search_query.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="153">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    items.map do |item|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="154">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      highlights = item.search_highlights(search_query)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="156">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">        item: item,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">        highlighted_title: highlights[:title] || item.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">        highlighted_content: highlights[:content] || truncate_content(item.content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="69078d0012a08dad4a026120e51bf8bad9a8d62e">
  <div class="header">
    <h3>app/components/document_layout_component.rb</h3>
    <h4>
      <span class="yellow">
  84.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  64.29%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>100</b> relevant lines.
      <span class="green"><b>84</b> lines covered</span> and
      <span class="red"><b>16</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>42</b> total branches, </span>
          <span class="green"><b>27</b> branches covered</span> and
          <span class="red"><b>15</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class DocumentLayoutComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(current_user:, current_document: nil, options: {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="5">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="6">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @current_document = current_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="7">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="8">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @layout_type = options.fetch(:layout_type, :default) # :default, :focused, :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="9">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @sidebar_collapsed = options.fetch(:sidebar_collapsed, false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="10">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @show_toolbar = options.fetch(:show_toolbar, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="11">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @enable_collaboration = options.fetch(:enable_collaboration, false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="12">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @show_onboarding = options.fetch(:show_onboarding, false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :current_user, :current_document, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def layout_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="20">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      &quot;document-layout&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      &quot;min-h-screen&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="29">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    case @layout_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when :focused</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="31">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;bg-white&quot;, &quot;dark:bg-creative-neutral-800&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="33">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;bg-creative-neutral-25&quot;, &quot;dark:bg-creative-neutral-950&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="36">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="39">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def container_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="40">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      &quot;h-screen&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      &quot;overflow-hidden&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="46">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    case @layout_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when :focused</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="48">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;max-w-none&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="50">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;max-w-4xl&quot;, &quot;mx-auto&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="52">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;max-w-none&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="55">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="58">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def main_content_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="59">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      &quot;flex-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      &quot;flex-col&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">      &quot;overflow-hidden&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      &quot;ease-creative&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    # Adjust margins based on sidebar state</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="70">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @sidebar_collapsed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;ml-16&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="73">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;ml-80&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">    # Layout type adjustments</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="77">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    case @layout_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when :focused</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="79">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;ml-0&quot; ] # Override sidebar margins for focused mode</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="81">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;mx-8&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="84">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="87">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def toolbar_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="88">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      &quot;justify-between&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      &quot;px-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;py-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;bg-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      &quot;border-b&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-sm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="103">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless @show_toolbar</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;hidden&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="107">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="110">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def content_area_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="111">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      &quot;flex-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      &quot;overflow-auto&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      &quot;p-6&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="117">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    case @layout_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when :focused</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="119">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;p-8&quot;, &quot;max-w-4xl&quot;, &quot;mx-auto&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="121">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;p-4&quot;, &quot;max-w-3xl&quot;, &quot;mx-auto&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="124">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="127">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def breadcrumb_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="128">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">      &quot;space-x-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      &quot;text-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-400&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="138">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def toolbar_actions_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="139">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">      &quot;space-x-3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="146">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def should_show_sidebar?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="147">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">    @layout_type != :focused &amp;&amp; @layout_type != :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="150">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def should_show_onboarding?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="151">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @show_onboarding &amp;&amp; current_user &amp;&amp; should_show_onboarding_for_user?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="154">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def should_show_onboarding_for_user?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">    # Check if user should see onboarding</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="156">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return false if current_user.attributes.key?(&quot;onboarding_completed_at&quot;) &amp;&amp; current_user.onboarding_completed_at.present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="157">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    return true if current_user.created_at &gt; 24.hours.ago</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="158">
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="161">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def breadcrumbs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">    crumbs = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="163">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      { label: &quot;Home&quot;, path: root_path }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="166">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if current_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="167">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      crumbs &lt;&lt; { label: &quot;Documents&quot;, path: documents_path }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="168">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      crumbs &lt;&lt; { label: current_document.title, path: document_path(current_document), active: true }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="170">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">      case controller_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="171">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;documents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="172">
            

            
              
            

            <code class="ruby">        crumbs &lt;&lt; { label: &quot;Documents&quot;, path: documents_path, active: true }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="173">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;context_items&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="174">
            

            
              
            

            <code class="ruby">        crumbs &lt;&lt; { label: &quot;Context Items&quot;, path: context_items_path, active: true }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="175">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;sub_agents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="176">
            

            
              
            

            <code class="ruby">        crumbs &lt;&lt; { label: &quot;Sub-Agents&quot;, path: sub_agents_path, active: true }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="180">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    crumbs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="183">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def toolbar_title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="184">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if current_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="185">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      current_document.title</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="186">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="187">
            

            
              
            

            <code class="ruby">      case controller_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="188">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;documents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="189">
            

            
              
            

            <code class="ruby">        case action_name</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="190">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;index&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="191">
            

            
              
            

            <code class="ruby">          &quot;All Documents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="192">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;new&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="193">
            

            
              
            

            <code class="ruby">          &quot;New Document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="194">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;edit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            

            
              
            

            <code class="ruby">          &quot;Edit Document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="196">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            

            
              
            

            <code class="ruby">          &quot;Documents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="199">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;context_items&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            

            
              
            

            <code class="ruby">        &quot;Context Items&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="201">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;sub_agents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            

            
              
            

            <code class="ruby">        &quot;Sub-Agents&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="203">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            

            
              
            

            <code class="ruby">        &quot;Claude Code Creators&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="209">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def layout_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="210">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">      controller: &quot;document-layout&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">      &quot;document-layout-sidebar-collapsed-value&quot; =&gt; @sidebar_collapsed,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">      &quot;document-layout-layout-type-value&quot; =&gt; @layout_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">      &quot;document-layout-enable-collaboration-value&quot; =&gt; @enable_collaboration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="218">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def floating_action_button_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="219">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">      &quot;fixed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">      &quot;bottom-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">      &quot;right-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">      &quot;w-14&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">      &quot;h-14&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-primary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      &quot;hover:bg-creative-primary-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">      &quot;text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">      &quot;rounded-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      &quot;hover:shadow-creative-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:shadow-creative-dark-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">      &quot;justify-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">      &quot;hover:scale-110&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">      &quot;z-40&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">    # Hide on minimal layout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="243">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    if @layout_type == :minimal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="244">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;hidden&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="247">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="250">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def mobile_menu_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="251">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">      &quot;fixed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">      &quot;inset-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">      &quot;z-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">      &quot;lg:hidden&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">      &quot;transition-transform&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">      &quot;transform&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">      &quot;translate-x-full&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="263">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def mobile_overlay_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="264">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">      &quot;fixed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">      &quot;inset-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-900/50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">      &quot;backdrop-blur-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">      &quot;z-40&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">      &quot;lg:hidden&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">      &quot;opacity-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">      &quot;invisible&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="278">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def status_indicator</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="279">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if current_document</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="280">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      if @enable_collaboration</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="281">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">          color: &quot;creative-secondary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">          text: &quot;Collaborative&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">          pulse: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="287">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">          color: &quot;creative-primary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">          text: &quot;Editing&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">          pulse: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="294">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">        color: &quot;creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">        text: &quot;Ready&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">        pulse: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="302">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def is_mobile_layout?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">    # This would need to be determined by JavaScript or CSS classes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">    # For now, we&#39;ll use CSS to handle mobile responsive behavior</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="305">
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="308">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def collaboration_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="309">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    @enable_collaboration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b917806e1ca293e6dc3d73405198258535507596">
  <div class="header">
    <h3>app/components/editor_component.rb</h3>
    <h4>
      <span class="green">
  95.45%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  83.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>44</b> relevant lines.
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>5</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="3">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">class EditorComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="4">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def initialize(document:, current_user:, options: {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="5">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @document = document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="7">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="8">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @show_presence_indicators = options.fetch(:show_presence, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="9">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @enable_collaboration = options.fetch(:enable_collaboration, false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="12">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="14">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  attr_reader :document, :current_user, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def editor_toolbar_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      # Text formatting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="19">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      { action: &quot;bold&quot;, icon: &quot;format-bold&quot;, tooltip: &quot;Bold (⌘B)&quot;, group: &quot;format&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">      { action: &quot;italic&quot;, icon: &quot;format-italic&quot;, tooltip: &quot;Italic (⌘I)&quot;, group: &quot;format&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      { action: &quot;strike&quot;, icon: &quot;format-strikethrough&quot;, tooltip: &quot;Strikethrough&quot;, group: &quot;format&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      { action: &quot;underline&quot;, icon: &quot;format-underline&quot;, tooltip: &quot;Underline (⌘U)&quot;, group: &quot;format&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      { divider: true },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      # Structure</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      { action: &quot;heading1&quot;, icon: &quot;format-header-1&quot;, tooltip: &quot;Heading 1&quot;, group: &quot;structure&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      { action: &quot;heading2&quot;, icon: &quot;format-header-2&quot;, tooltip: &quot;Heading 2&quot;, group: &quot;structure&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      { action: &quot;heading3&quot;, icon: &quot;format-header-3&quot;, tooltip: &quot;Heading 3&quot;, group: &quot;structure&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      { action: &quot;quote&quot;, icon: &quot;format-quote-close&quot;, tooltip: &quot;Quote&quot;, group: &quot;structure&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      { divider: true },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      # Lists and blocks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      { action: &quot;bullet&quot;, icon: &quot;format-list-bulleted&quot;, tooltip: &quot;Bullet List&quot;, group: &quot;lists&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      { action: &quot;number&quot;, icon: &quot;format-list-numbered&quot;, tooltip: &quot;Numbered List&quot;, group: &quot;lists&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      { action: &quot;code&quot;, icon: &quot;code-tags&quot;, tooltip: &quot;Code Block&quot;, group: &quot;lists&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      { divider: true },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      # Media and links</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      { action: &quot;link&quot;, icon: &quot;link&quot;, tooltip: &quot;Add Link (⌘K)&quot;, group: &quot;media&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      { action: &quot;attachFile&quot;, icon: &quot;paperclip&quot;, tooltip: &quot;Attach File&quot;, group: &quot;media&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      { action: &quot;table&quot;, icon: &quot;table&quot;, tooltip: &quot;Insert Table&quot;, group: &quot;media&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      { divider: true },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      # History</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      { action: &quot;undo&quot;, icon: &quot;undo&quot;, tooltip: &quot;Undo (⌘Z)&quot;, group: &quot;history&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      { action: &quot;redo&quot;, icon: &quot;redo&quot;, tooltip: &quot;Redo (⌘⇧Z)&quot;, group: &quot;history&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="50">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def editor_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="51">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      &quot;trix-editor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      &quot;min-h-[500px]&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      &quot;prose&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      &quot;prose-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      &quot;max-w-none&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      &quot;focus:outline-none&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      &quot;focus:ring-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      &quot;focus:ring-creative-primary-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      &quot;focus:ring-offset-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">      &quot;ease-creative&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    # Creative-focused prose styling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="67">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    prose_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      &quot;prose-headings:font-display&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      &quot;prose-headings:font-semibold&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      &quot;prose-headings:text-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      &quot;prose-h1:text-heading-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      &quot;prose-h2:text-heading-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      &quot;prose-h3:text-heading-md&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      &quot;prose-p:text-content-base&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      &quot;prose-p:leading-relaxed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      &quot;prose-a:text-creative-primary-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      &quot;prose-a:no-underline&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      &quot;prose-a:font-medium&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      &quot;hover:prose-a:text-creative-primary-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      &quot;prose-strong:text-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      &quot;prose-strong:font-semibold&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      &quot;prose-code:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      &quot;prose-code:text-creative-accent-purple&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      &quot;prose-code:px-1.5&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      &quot;prose-code:py-0.5&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      &quot;prose-code:rounded&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      &quot;prose-code:font-mono&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      &quot;prose-code:text-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      &quot;prose-pre:bg-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      &quot;prose-pre:text-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      &quot;prose-pre:border-l-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      &quot;prose-pre:border-creative-primary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;prose-blockquote:border-l-creative-secondary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;prose-blockquote:text-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      &quot;prose-blockquote:italic&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    # Dark mode variants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="99">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    dark_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-headings:text-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-p:text-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-a:text-creative-primary-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:prose-a:text-creative-primary-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-strong:text-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-code:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-code:text-creative-accent-amber&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      &quot;dark:prose-blockquote:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      &quot;dark:focus:ring-creative-primary-400&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="111">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    (base_classes + prose_classes + dark_classes).join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="114">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def toolbar_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="115">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      &quot;editor-toolbar&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      &quot;bg-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">      &quot;border&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      &quot;rounded-t-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      &quot;p-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      &quot;justify-between&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="134">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def editor_wrapper_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="135">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      &quot;editor-wrapper&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      &quot;card&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      &quot;!p-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      &quot;overflow-hidden&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-md&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-md&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">      &quot;transition-shadow&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      &quot;hover:shadow-creative-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:shadow-creative-dark-lg&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="149">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def editor_content_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="150">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">      &quot;border&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">      &quot;border-t-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      &quot;rounded-b-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      &quot;bg-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">      &quot;p-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="164">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def status_bar_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="165">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">      &quot;mt-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">      &quot;justify-between&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">      &quot;text-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">      &quot;px-1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="177">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def show_presence_indicators?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="178">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @show_presence_indicators &amp;&amp; @enable_collaboration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="181">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def collaboration_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="182">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @enable_collaboration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="185">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def word_count_display</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="186">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return &quot;0 words&quot; unless document.persisted?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="188">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    count = document.word_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="189">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    reading_time = document.reading_time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="191">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    &quot;#{count} words • #{reading_time} min read&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="194">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def editor_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="195">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    attrs = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">      controller: &quot;editor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">      &quot;editor-document-id-value&quot; =&gt; document.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">      &quot;editor-user-id-value&quot; =&gt; current_user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="201">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    if document.persisted?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="202">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      attrs[&quot;editor-autosave-url-value&quot;] = url_helpers.document_path(document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="205">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    if collaboration_enabled?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            

            
              
            

            <code class="ruby">      attrs[&quot;editor-collaboration-enabled-value&quot;] = true</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            

            
              
            

            <code class="ruby">      attrs[&quot;editor-presence-channel-value&quot;] = &quot;document_#{document.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="210">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    attrs</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="213">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="215">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def url_helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="216">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    Rails.application.routes.url_helpers</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8bc1e653222dd123de33e8892ebf772595d9bb86">
  <div class="header">
    <h3>app/components/onboarding_modal_component.rb</h3>
    <h4>
      <span class="green">
  98.61%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  84.21%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>72</b> relevant lines.
      <span class="green"><b>71</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>19</b> total branches, </span>
          <span class="green"><b>16</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class OnboardingModalComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(current_user:, options: {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="5">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="6">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="7">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @show_modal = options.fetch(:show_modal, should_show_onboarding?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="8">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @current_step = options.fetch(:current_step, 1)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="9">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    @total_steps = 4</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="12">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :current_user, :options, :show_modal, :current_step, :total_steps</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="16">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def should_show_onboarding?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    # Show onboarding if user is new (less than 24 hours old) or explicitly requested</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="19" data-linenumber="18">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return false unless current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="19">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    return true if options[:force_show]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    # Check if user has seen onboarding</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="22">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    return false if current_user.attributes.key?(&quot;onboarding_completed_at&quot;) &amp;&amp; current_user.onboarding_completed_at.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    # Show for new users</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="25">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    current_user.created_at &gt; 24.hours.ago</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="28">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def modal_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="29">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      &quot;fixed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      &quot;inset-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      &quot;z-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      &quot;justify-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      &quot;p-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      &quot;ease-creative&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="42">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="then branch hit 18 times">
                  then: 18
                </span>
              
            

            <code class="ruby">    if show_modal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="43">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;opacity-100&quot;, &quot;visible&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;opacity-0&quot;, &quot;invisible&quot;, &quot;pointer-events-none&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="48">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="51">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def backdrop_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="52">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      &quot;absolute&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      &quot;inset-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-900/75&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      &quot;backdrop-blur-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      &quot;transition-opacity&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="62">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def content_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="63">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      &quot;relative&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      &quot;w-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      &quot;max-w-2xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      &quot;max-h-[90vh]&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      &quot;bg-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      &quot;rounded-2xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-2xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      &quot;border&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">      &quot;overflow-hidden&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">      &quot;transform&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      &quot;ease-creative&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="84">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def header_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="85">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      &quot;px-8&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      &quot;py-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      &quot;border-b&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      &quot;bg-gradient-to-r&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">      &quot;from-creative-primary-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;to-creative-secondary-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;dark:from-creative-primary-900/20&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      &quot;dark:to-creative-secondary-900/20&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="99">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def body_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="100">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      &quot;px-8&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      &quot;py-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      &quot;overflow-y-auto&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      &quot;max-h-[60vh]&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      &quot;scrollbar-thin&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      &quot;scrollbar-track-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      &quot;scrollbar-thumb-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      &quot;dark:scrollbar-track-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">      &quot;dark:scrollbar-thumb-creative-neutral-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="113">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def footer_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="114">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      &quot;px-8&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      &quot;py-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      &quot;border-t&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800/50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">      &quot;justify-between&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="128">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def progress_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="129">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      &quot;space-x-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      &quot;mb-4&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="137">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def progress_step_class(step_number)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="76" data-linenumber="138">
            
              <span class="hits">76</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">      &quot;justify-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">      &quot;w-8&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">      &quot;h-8&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      &quot;rounded-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      &quot;text-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      &quot;font-medium&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="76" data-linenumber="151">
            
              <span class="hits">76</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    if step_number &lt; current_step</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="152">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-secondary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">        &quot;text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
                <span class="hits" title="else branch hit 59 times">
                  else: 59
                </span>
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="59" data-linenumber="156">
            
              <span class="hits">59</span>
            

            
              
                <span class="hits" title="then branch hit 19 times">
                  then: 19
                </span>
              
            

            <code class="ruby">    elsif step_number == current_step</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="157">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-primary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">        &quot;text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">        &quot;ring-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">        &quot;ring-creative-primary-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">        &quot;dark:ring-creative-primary-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
                <span class="hits" title="else branch hit 40 times">
                  else: 40
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="165">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">        &quot;dark:bg-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">        &quot;text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">        &quot;dark:text-creative-neutral-400&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="76" data-linenumber="173">
            
              <span class="hits">76</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="176">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def progress_line_class(step_number)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="57" data-linenumber="177">
            
              <span class="hits">57</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">      &quot;flex-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">      &quot;h-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">      &quot;mx-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">      &quot;rounded-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="57" data-linenumber="186">
            
              <span class="hits">57</span>
            

            
              
                <span class="hits" title="then branch hit 17 times">
                  then: 17
                </span>
              
            

            <code class="ruby">    if step_number &lt; current_step</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="187">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;bg-creative-secondary-500&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
                <span class="hits" title="else branch hit 40 times">
                  else: 40
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="189">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;bg-creative-neutral-200&quot;, &quot;dark:bg-creative-neutral-600&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="57" data-linenumber="192">
            
              <span class="hits">57</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="195">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def step_content</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="76" data-linenumber="196">
            
              <span class="hits">76</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case current_step</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
                <span class="hits" title="when branch hit 44 times">
                  when: 44
                </span>
              
            

            <code class="ruby">    when 1</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="198">
            
              <span class="hits">44</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">        title: &quot;Welcome to Claude Code Creators!&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">        subtitle: &quot;Your AI-powered creative writing platform&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">        content: welcome_step_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">        icon: &quot;sparkles&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
                <span class="hits" title="when branch hit 12 times">
                  when: 12
                </span>
              
            

            <code class="ruby">    when 2</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="205">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">        title: &quot;Document Editor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">        subtitle: &quot;Rich text editing with AI assistance&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">        content: editor_step_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">        icon: &quot;document-text&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="212">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">        title: &quot;Context &amp; Sub-Agents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">        subtitle: &quot;Organize your creative process&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">        content: context_step_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">        icon: &quot;collection&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
                <span class="hits" title="when branch hit 16 times">
                  when: 16
                </span>
              
            

            <code class="ruby">    when 4</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="219">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">        title: &quot;You&#39;re All Set!&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">        subtitle: &quot;Start creating amazing content&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">        content: completion_step_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">        icon: &quot;check-circle&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="228">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def welcome_step_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="229">
            
              <span class="hits">44</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">      description: &quot;Claude Code Creators is designed specifically for creative professionals like you. Whether you&#39;re writing marketing copy, stories, or any creative content, we&#39;re here to help you work faster and more efficiently.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      features: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">          icon: &quot;lightning-bolt&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">          title: &quot;AI-Powered Writing&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">          description: &quot;Get intelligent suggestions and assistance while you write&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">          icon: &quot;users&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">          title: &quot;Sub-Agents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">          description: &quot;Create specialized AI assistants for specific tasks&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">          icon: &quot;collection&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">          title: &quot;Context Management&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">          description: &quot;Keep your research and references organized and accessible&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="251">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def editor_step_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="252">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">      description: &quot;Our document editor is built for creative work. Rich text formatting, real-time collaboration, and AI assistance right where you need it.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">      features: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">          icon: &quot;pencil-alt&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">          title: &quot;Rich Text Editor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">          description: &quot;Full formatting options with creative-focused design&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="260">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="261">
            

            
              
            

            <code class="ruby">          icon: &quot;save&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">          title: &quot;Auto-save&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">          description: &quot;Never lose your work with automatic saving&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">          icon: &quot;eye&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">          title: &quot;Live Preview&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">          description: &quot;See your formatting changes in real-time&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">      ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">      tip: &quot;💡 Try using keyboard shortcuts like ⌘B for bold and ⌘I for italic!&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="275">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def context_step_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="276">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby">      description: &quot;Keep your creative process organized with context items and specialized sub-agents that help you focus on different aspects of your work.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby">      features: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">          icon: &quot;bookmark&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">          title: &quot;Context Items&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">          description: &quot;Save snippets, research, and references for easy access&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
            

            <code class="ruby">          icon: &quot;user-group&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">          title: &quot;Sub-Agents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">          description: &quot;Create AI assistants for specific tasks like editing or research&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">          icon: &quot;arrows-expand&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">          title: &quot;Drag &amp; Drop&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">          description: &quot;Easily move content between your sidebar and document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby">      ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">      tip: &quot;🎯 Pro tip: Use sub-agents for specialized tasks like &#39;Brand Voice Checker&#39; or &#39;Research Assistant&#39;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="299">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def completion_step_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="300">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">      description: &quot;You&#39;re ready to start creating! Your creative workspace is set up and ready to help you produce amazing content.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby">      next_steps: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">          icon: &quot;document-add&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">          title: &quot;Create Your First Document&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">          description: &quot;Start with a blank document or choose from our templates&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby">          action: &quot;Create Document&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">          url: new_document_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">          icon: &quot;book-open&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">          title: &quot;Explore Examples&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            
              
            

            <code class="ruby">          description: &quot;Check out sample documents to see what&#39;s possible&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">          action: &quot;View Examples&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">          url: &quot;#&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">          icon: &quot;question-mark-circle&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">          title: &quot;Get Help&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">          description: &quot;Visit our help center for tips and tutorials&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby">          action: &quot;Help Center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">          url: &quot;#&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="324">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="327">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="328">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def close_button_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="329">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="330">
            

            
              
            

            <code class="ruby">      &quot;absolute&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            
              
            

            <code class="ruby">      &quot;top-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby">      &quot;right-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="333">
            

            
              
            

            <code class="ruby">      &quot;p-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="334">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="335">
            

            
              
            

            <code class="ruby">      &quot;hover:text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="336">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:text-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="337">
            

            
              
            

            <code class="ruby">      &quot;hover:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="338">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:bg-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="339">
            

            
              
            

            <code class="ruby">      &quot;rounded-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="340">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="341">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="342">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="345">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def feature_card_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="45" data-linenumber="346">
            
              <span class="hits">45</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="347">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            

            
              
            

            <code class="ruby">      &quot;items-start&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="349">
            

            
              
            

            <code class="ruby">      &quot;space-x-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">      &quot;p-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="352">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-700/50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="353">
            

            
              
            

            <code class="ruby">      &quot;rounded-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="354">
            

            
              
            

            <code class="ruby">      &quot;border&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="355">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200/50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="356">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-600/50&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="357">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="358">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="359">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="360">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def action_card_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="361">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="362">
            

            
              
            

            <code class="ruby">      &quot;group&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="363">
            

            
              
            

            <code class="ruby">      &quot;block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="364">
            

            
              
            

            <code class="ruby">      &quot;p-6&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="365">
            

            
              
            

            <code class="ruby">      &quot;bg-gradient-to-br&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="366">
            

            
              
            

            <code class="ruby">      &quot;from-creative-primary-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="367">
            

            
              
            

            <code class="ruby">      &quot;to-creative-secondary-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="368">
            

            
              
            

            <code class="ruby">      &quot;dark:from-creative-primary-900/20&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="369">
            

            
              
            

            <code class="ruby">      &quot;dark:to-creative-secondary-900/20&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="370">
            

            
              
            

            <code class="ruby">      &quot;rounded-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="371">
            

            
              
            

            <code class="ruby">      &quot;border&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="372">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="373">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="374">
            

            
              
            

            <code class="ruby">      &quot;hover:shadow-creative-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="375">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:shadow-creative-dark-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="376">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="377">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="378">
            

            
              
            

            <code class="ruby">      &quot;hover:scale-105&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="379">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="380">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="381">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="382">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def is_final_step?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="383">
            

            
              
            

            <code class="ruby">    current_step &gt;= total_steps</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="384">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="385">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="386">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def can_go_next?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="387">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    current_step &lt; total_steps</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="388">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="389">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="390">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def can_go_previous?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="391">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    current_step &gt; 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="392">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="393">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="bc4b58719725b017623a42220ce1fd45e395f1ef">
  <div class="header">
    <h3>app/components/presence_indicator_component.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>135</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>135</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">class PresenceIndicatorComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="4">
            

            
              
            

            <code class="ruby">  def initialize(users:, current_user:, options: {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">    @users = users.reject { |user| user.id == current_user.id }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            
              
            

            <code class="ruby">    @show_names = options.fetch(:show_names, true)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">    @show_cursors = options.fetch(:show_cursors, false)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    @max_display = options.fetch(:max_display, 5)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">    @size = options.fetch(:size, :medium) # :small, :medium, :large</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">  attr_reader :users, :current_user, :show_names, :show_cursors, :max_display, :size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">  def displayed_users</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">    users.take(max_display)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">  def overflow_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">    [ users.count - max_display, 0 ].max</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">  def has_overflow?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">    overflow_count &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">  def avatar_size_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">    when :small</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">      &quot;w-7 h-7 text-xs&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">    when :large</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">      &quot;w-12 h-12 text-base&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="35">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">      &quot;w-8 h-8 text-sm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="37">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">  def avatar_colors</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="41">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-primary-500 text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="43">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-secondary-500 text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="44">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-accent-purple text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="45">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-accent-amber text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-accent-rose text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-accent-teal text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-accent-indigo text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-accent-orange text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">  def user_avatar_color(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    # Use a hash of the user ID to consistently assign colors</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">    color_index = user.id.hash.abs % avatar_colors.length</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">    avatar_colors[color_index]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="59">
            

            
              
            

            <code class="ruby">  def user_initials(user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">    name = user.name.presence || user.email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="61">
            

            
              
            

            <code class="ruby">    name.split.map(&amp;:first).join.upcase.first(2)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">  def presence_container_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="65">
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">      &quot;presence-indicators&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="67">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="69">
            

            
              
            

            <code class="ruby">      &quot;space-x-1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">    if show_cursors</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="73">
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;relative&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            

            
              
            

            <code class="ruby">  def avatar_base_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            

            
              
            

            <code class="ruby">      &quot;justify-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="84">
            

            
              
            

            <code class="ruby">      &quot;rounded-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">      &quot;font-medium&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">      &quot;ring-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            

            
              
            

            <code class="ruby">      &quot;ring-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="88">
            

            
              
            

            <code class="ruby">      &quot;dark:ring-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="89">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="90">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
            

            <code class="ruby">      &quot;hover:scale-110&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;cursor-pointer&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      avatar_size_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            

            
              
            

            <code class="ruby">  def overflow_avatar_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">      avatar_base_class,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="104">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="105">
            

            
              
            

            <code class="ruby">      &quot;hover:bg-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:bg-creative-neutral-600&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="107">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            

            
              
            

            <code class="ruby">  def tooltip_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="111">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="112">
            

            
              
            

            <code class="ruby">      &quot;absolute&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="113">
            

            
              
            

            <code class="ruby">      &quot;bottom-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            

            
              
            

            <code class="ruby">      &quot;left-1/2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="115">
            

            
              
            

            <code class="ruby">      &quot;transform&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            

            
              
            

            <code class="ruby">      &quot;-translate-x-1/2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            

            
              
            

            <code class="ruby">      &quot;mb-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="118">
            

            
              
            

            <code class="ruby">      &quot;px-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="119">
            

            
              
            

            <code class="ruby">      &quot;py-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            

            
              
            

            <code class="ruby">      &quot;text-xs&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            

            
              
            

            <code class="ruby">      &quot;font-medium&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="122">
            

            
              
            

            <code class="ruby">      &quot;text-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="123">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="124">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            

            
              
            

            <code class="ruby">      &quot;rounded&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="127">
            

            
              
            

            <code class="ruby">      &quot;opacity-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="128">
            

            
              
            

            <code class="ruby">      &quot;invisible&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="129">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="130">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="131">
            

            
              
            

            <code class="ruby">      &quot;group-hover:opacity-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            

            
              
            

            <code class="ruby">      &quot;group-hover:visible&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            

            
              
            

            <code class="ruby">      &quot;pointer-events-none&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            

            
              
            

            <code class="ruby">      &quot;whitespace-nowrap&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            

            
              
            

            <code class="ruby">      &quot;z-50&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="137">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            

            
              
            

            <code class="ruby">  def typing_indicator_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            

            
              
            

            <code class="ruby">      &quot;absolute&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            

            
              
            

            <code class="ruby">      &quot;-bottom-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="143">
            

            
              
            

            <code class="ruby">      &quot;-right-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            

            
              
            

            <code class="ruby">      &quot;w-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            

            
              
            

            <code class="ruby">      &quot;h-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-secondary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="147">
            

            
              
            

            <code class="ruby">      &quot;rounded-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            

            
              
            

            <code class="ruby">      &quot;border-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="149">
            

            
              
            

            <code class="ruby">      &quot;border-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            

            
              
            

            <code class="ruby">      &quot;animate-pulse-gentle&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="152">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="154">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="028c72ff24c7cfc72c1a18514708dc1504fc4403">
  <div class="header">
    <h3>app/components/sidebar_navigation_component.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  86.36%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>68</b> relevant lines.
      <span class="green"><b>68</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>22</b> total branches, </span>
          <span class="green"><b>19</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SidebarNavigationComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(current_user:, current_document: nil, options: {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="5">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="6">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @current_document = current_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="7">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="8">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @collapsed = options.fetch(:collapsed, false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="9">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @show_recent_documents = options.fetch(:show_recent_documents, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="10">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @show_context_items = options.fetch(:show_context_items, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="11">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @show_sub_agents = options.fetch(:show_sub_agents, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="12">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @show_presence = options.fetch(:show_presence, false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :current_user, :current_document, :options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sidebar_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="20">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">      &quot;sidebar-navigation&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      &quot;h-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      &quot;bg-white&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      &quot;border-r&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      &quot;ease-creative&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      &quot;flex-col&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="35">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 28 times">
                  else: 28
                </span>
              
            

            <code class="ruby">    width_classes = @collapsed ? [ &quot;w-16&quot; ] : [ &quot;w-80&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="37">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    (base_classes + width_classes).join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def header_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="41">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      &quot;justify-between&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      &quot;p-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      &quot;border-b&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="54">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def content_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="55">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      &quot;flex-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      &quot;overflow-y-auto&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      &quot;scrollbar-thin&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      &quot;scrollbar-track-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      &quot;scrollbar-thumb-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      &quot;dark:scrollbar-track-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">      &quot;dark:scrollbar-thumb-creative-neutral-600&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="66">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def section_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="67">
            
              <span class="hits">61</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      &quot;px-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      &quot;py-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      &quot;border-b&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="76">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def section_header_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="77">
            
              <span class="hits">60</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">      &quot;justify-between&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      &quot;mb-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      &quot;text-xs&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      &quot;font-semibold&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      &quot;uppercase&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      &quot;tracking-wider&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="91">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def nav_item_class(active: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="92">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      &quot;w-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">      &quot;px-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      &quot;py-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">      &quot;mb-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      &quot;text-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      &quot;font-medium&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      &quot;rounded-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      &quot;group&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="107">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 29 times">
                  then: 29
                </span>
              
            

            <code class="ruby">    if active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="108">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-primary-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">        &quot;dark:bg-creative-primary-900/30&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">        &quot;text-creative-primary-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">        &quot;dark:text-creative-primary-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">        &quot;shadow-creative-sm&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
                <span class="hits" title="else branch hit 33 times">
                  else: 33
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="33" data-linenumber="116">
            
              <span class="hits">33</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">        &quot;text-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">        &quot;dark:text-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        &quot;hover:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">        &quot;hover:text-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:text-creative-neutral-100&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="126">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="129">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def icon_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="130">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 60 times">
                  else: 60
                </span>
              
            

            <code class="ruby">    size_class = @collapsed ? &quot;w-5 h-5&quot; : &quot;w-4 h-4&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="131">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 60 times">
                  else: 60
                </span>
              
            

            <code class="ruby">    margin_class = @collapsed ? &quot;&quot; : &quot;mr-3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="134">
            
              <span class="hits">62</span>
            

            
              
            

            <code class="ruby">      size_class,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      margin_class,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      &quot;flex-shrink-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="142">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def badge_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="143">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      &quot;ml-auto&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      &quot;px-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      &quot;py-0.5&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">      &quot;text-xs&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">      &quot;font-medium&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">      &quot;rounded-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-primary-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-primary-900/30&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">      &quot;text-creative-primary-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-primary-300&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="157">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def recent_documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="110" data-linenumber="158">
            
              <span class="hits">110</span>
            

            
              
            

            <code class="ruby">    @recent_documents ||= current_user.documents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">                                      .order(updated_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">                                      .limit(10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">                                      .includes(:user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="164">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def recent_context_items</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="165">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return [] unless current_document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="167">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @recent_context_items ||= current_document.context_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">                                              .order(updated_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">                                              .limit(8)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="172">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def active_sub_agents</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="173">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return [] unless current_document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="175">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @active_sub_agents ||= current_document.sub_agents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">                                           .where.not(status: &quot;completed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">                                           .order(updated_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="180">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def navigation_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">    items = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="182">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">        label: &quot;Dashboard&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">        path: root_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">        icon: &quot;home&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">        active: current_page?(root_path)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">        label: &quot;Documents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">        path: documents_path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">        icon: &quot;document-text&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">        active: controller_name == &quot;documents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="193">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="then branch hit 27 times">
                  then: 27
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">        badge: recent_documents.count &gt; 0 ? recent_documents.count : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="197">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 27 times">
                  else: 27
                </span>
              
            

            <code class="ruby">    if current_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="198">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      items += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">          label: &quot;Context Items&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">          path: document_context_items_path(current_document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">          icon: &quot;collection&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">          active: controller_name == &quot;context_items&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">          badge: recent_context_items.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">          label: &quot;Sub-Agents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">          path: document_sub_agents_path(current_document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">          icon: &quot;users&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">          active: controller_name == &quot;sub_agents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="211">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">          badge: active_sub_agents.count &gt; 0 ? active_sub_agents.count : nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="216">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="219">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sidebar_footer_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="220">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">      &quot;p-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">      &quot;border-t&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">      &quot;border-creative-neutral-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="230">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def user_menu_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="231">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">      &quot;w-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">      &quot;p-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">      &quot;rounded-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">      &quot;hover:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="238">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:bg-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="240">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="241">
            

            
              
            

            <code class="ruby">      &quot;group&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="243">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="245">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def toggle_button_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="246">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby">      &quot;p-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="248">
            

            
              
            

            <code class="ruby">      &quot;rounded-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">      &quot;hover:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:bg-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">      &quot;hover:text-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:text-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="258">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="259">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="260">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def document_item_class(document)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="261">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
            

            <code class="ruby">    active = current_document&amp;.id == document.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="263">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">      &quot;w-full&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">      &quot;px-3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">      &quot;py-1.5&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">      &quot;mb-1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">      &quot;text-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby">      &quot;rounded-md&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby">      &quot;group&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="275">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="277">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="278">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="279">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-primary-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby">        &quot;dark:bg-creative-primary-900/20&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">        &quot;text-creative-primary-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby">        &quot;dark:text-creative-primary-300&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="283">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="285">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">      base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">        &quot;text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">        &quot;dark:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">        &quot;hover:bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:bg-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">        &quot;hover:text-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:text-creative-neutral-100&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="295">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="298">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def collapsed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="298" data-linenumber="299">
            
              <span class="hits">298</span>
            

            
              
            

            <code class="ruby">    @collapsed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="302">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show_labels?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="211" data-linenumber="303">
            
              <span class="hits">211</span>
            

            
              
            

            <code class="ruby">    !collapsed?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="59cb3317309d061a8bd8387a3489de96a0441d0f">
  <div class="header">
    <h3>app/components/sub_agent_conversation_component.rb</h3>
    <h4>
      <span class="red">
  80.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  44.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>70</b> relevant lines.
      <span class="green"><b>56</b> lines covered</span> and
      <span class="red"><b>14</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>25</b> total branches, </span>
          <span class="green"><b>11</b> branches covered</span> and
          <span class="red"><b>14</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="3">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">class SubAgentConversationComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="4">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def initialize(sub_agent:, current_user:, messages: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="5">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    @sub_agent = sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="6">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="7">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    @messages = messages || sub_agent.claude_messages.includes(:claude_session).recent.limit(50).reverse</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="10">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="12">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  attr_reader :sub_agent, :current_user, :messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="14">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="40" data-linenumber="15">
            
              <span class="hits">40</span>
            

            
              
            

            <code class="ruby">    @document ||= sub_agent.document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="18">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def conversation_container_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="19">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    &quot;flex flex-col h-full bg-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="22">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def message_list_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="23">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    &quot;flex-1 overflow-y-auto px-4 py-4 space-y-4&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="26">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def message_bubble_classes(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="27">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    base_classes = &quot;max-w-3xl rounded-lg px-4 py-3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="29">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    if message.user?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="30">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} ml-auto bg-blue-600 text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="32">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-gray-100 text-gray-900&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="36">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def message_wrapper_classes(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="37">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    if message.user?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="38">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      &quot;flex justify-end&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      &quot;flex justify-start&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="44">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def format_message_time(timestamp)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="45">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
            

            <code class="ruby">    if timestamp.today?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="46">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      timestamp.strftime(&quot;%l:%M %p&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="47">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    elsif timestamp.yesterday?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">      &quot;Yesterday at #{timestamp.strftime(&#39;%l:%M %p&#39;)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="49">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
            

            <code class="ruby">      timestamp.strftime(&quot;%B %d at %l:%M %p&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="54">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def input_form_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="55">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    &quot;border-t border-gray-200 px-4 py-3 bg-gray-50&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="58">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def input_field_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="59">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    &quot;w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="62">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def send_button_classes(disabled: false)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="63">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    base_classes = &quot;inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="65">
            
              <span class="hits">20</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">    if disabled</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="66">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-gray-300 text-gray-500 cursor-not-allowed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
                <span class="hits" title="else branch hit 17 times">
                  else: 17
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="68">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-blue-600 text-white hover:bg-blue-700&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="72">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def merge_button_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="73">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    &quot;inline-flex items-center px-3 py-1.5 text-sm font-medium bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="76">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def loading_indicator_visible?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="77">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    sub_agent.active? &amp;&amp; messages.any? &amp;&amp; messages.last.user?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="80">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def can_merge_content?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="81">
            
              <span class="hits">27</span>
            

            
              
            

            <code class="ruby">    messages.any? { |m| m.assistant? &amp;&amp; m.content.present? }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="84">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def agent_status_banner_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="85">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    base_classes = &quot;px-4 py-2 text-sm font-medium&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="87">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    case sub_agent.status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
                <span class="hits" title="when branch hit 17 times">
                  when: 17
                </span>
              
            

            <code class="ruby">    when &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="89">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-green-50 text-green-800 border-b border-green-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="90">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;completed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="91">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-blue-50 text-blue-800 border-b border-blue-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="92">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;failed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-red-50 text-red-800 border-b border-red-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="94">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;paused&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-yellow-50 text-yellow-800 border-b border-yellow-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="96">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="97">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-gray-50 text-gray-800 border-b border-gray-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="101">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def format_message_content(message)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="102">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    if message.assistant?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
                <span class="hits" title="then branch hit 4 times">
                  then: 4
                </span>
              
            

            <code class="ruby">      # Convert markdown to HTML for assistant messages</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="104">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      simple_format(message.content, class: &quot;whitespace-pre-wrap&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="106">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      simple_format(message.content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="110">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def agent_icon(agent_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="111">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    agent_types = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      &quot;ruby-rails-expert&quot; =&gt; &quot;🚂&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      &quot;javascript-package-expert&quot; =&gt; &quot;📦&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      &quot;tailwind-css-expert&quot; =&gt; &quot;🎨&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      &quot;test-runner-fixer&quot; =&gt; &quot;🧪&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      &quot;error-debugger&quot; =&gt; &quot;🐛&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      &quot;project-orchestrator&quot; =&gt; &quot;📋&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      &quot;git-auto-commit&quot; =&gt; &quot;🔀&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="120">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    agent_types[agent_type] || &quot;🤖&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="123">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def empty_conversation?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="124">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">    messages.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="127">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def agent_introduction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="128">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    case sub_agent.agent_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
                <span class="hits" title="when branch hit 14 times">
                  when: 14
                </span>
              
            

            <code class="ruby">    when &quot;ruby-rails-expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="130">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      &quot;Hello! I&#39;m your Rails/Ruby expert. I can help with backend development, models, controllers, and Rails best practices.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="131">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;javascript-package-expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="132">
            

            
              
            

            <code class="ruby">      &quot;Hi there! I&#39;m your JavaScript expert. I can assist with frontend code, npm packages, and JavaScript frameworks.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="133">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;tailwind-css-expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            

            
              
            

            <code class="ruby">      &quot;Hey! I&#39;m your Tailwind CSS expert. I&#39;ll help you with styling, responsive design, and UI components.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="135">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;test-runner-fixer&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            

            
              
            

            <code class="ruby">      &quot;Greetings! I&#39;m the test runner. I can help write tests, fix failing specs, and improve test coverage.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="137">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;error-debugger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="138">
            

            
              
            

            <code class="ruby">      &quot;Hello! I&#39;m the error debugger. I&#39;ll help you track down bugs and resolve issues in your code.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="139">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;project-orchestrator&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            

            
              
            

            <code class="ruby">      &quot;Welcome! I&#39;m the project orchestrator. I coordinate complex tasks and help plan your development workflow.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="141">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;git-auto-commit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="142">
            

            
              
            

            <code class="ruby">      &quot;Hi! I&#39;m the git auto-commit agent. I&#39;ll help manage your version control and create meaningful commits.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="143">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="144">
            

            
              
            

            <code class="ruby">      &quot;Hello! I&#39;m ready to assist you with your document.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8af5866dd5bda3c53d98d9e2f1be63fb349d7efe">
  <div class="header">
    <h3>app/components/sub_agent_merge_component.rb</h3>
    <h4>
      <span class="green">
  92.98%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  66.67%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>57</b> relevant lines.
      <span class="green"><b>53</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SubAgentMergeComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(sub_agent:, current_user:, merge_content: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="5">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @sub_agent = sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="6">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="7">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    @merge_content = merge_content || extract_mergeable_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="10">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="12">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :sub_agent, :current_user, :merge_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="15">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">    @document ||= sub_agent.document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="18">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def extract_mergeable_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    # Get all assistant messages that could be merged</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="20">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    assistant_messages = sub_agent.messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">                                  .where(role: &quot;assistant&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">                                  .order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">                                  .limit(10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    # Combine recent assistant responses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="26">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    assistant_messages.map(&amp;:content).join(&quot;\n\n---\n\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def dialog_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="30">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    &quot;fixed inset-0 z-50 overflow-y-auto&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="33">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def backdrop_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="34">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    &quot;fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="37">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def dialog_panel_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="38">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    &quot;relative bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:max-w-3xl sm:w-full&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="41">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def header_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="42">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    &quot;bg-gray-50 px-6 py-4 border-b border-gray-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="45">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def content_preview_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="46">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    &quot;bg-gray-50 border border-gray-200 rounded-lg p-4 max-h-96 overflow-y-auto&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="49">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def button_classes(variant = :primary)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="50">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">    base_classes = &quot;inline-flex items-center px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="36" data-linenumber="52">
            
              <span class="hits">36</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case variant</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
                <span class="hits" title="when branch hit 18 times">
                  when: 18
                </span>
              
            

            <code class="ruby">    when :primary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="54">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-green-600 text-white hover:bg-green-700 focus:ring-green-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="55">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when :secondary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:ring-blue-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
                <span class="hits" title="when branch hit 18 times">
                  when: 18
                </span>
              
            

            <code class="ruby">    when :cancel</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="58">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-white text-gray-700 border border-gray-300 hover:bg-gray-50 focus:ring-gray-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="62">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def merge_location_options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="64">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      { value: &quot;cursor&quot;, label: &quot;Insert at cursor&quot;, description: &quot;Insert at the current cursor location&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      { value: &quot;end&quot;, label: &quot;Append to end&quot;, description: &quot;Append to the end of the document&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      { value: &quot;beginning&quot;, label: &quot;Insert at beginning&quot;, description: &quot;Insert at the start of the document&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      { value: &quot;replace&quot;, label: &quot;Replace entire document&quot;, description: &quot;Replace all existing content&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="71">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def format_content_preview(content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">    # Truncate very long content for preview</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="73">
            
              <span class="hits">17</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 15 times">
                  else: 15
                </span>
              
            

            <code class="ruby">    truncated = content.length &gt; 1000 ? &quot;#{content[0..1000]}...&quot; : content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="74">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    simple_format(truncated, class: &quot;whitespace-pre-wrap text-sm text-gray-700&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="77">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def merge_summary</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="78">
            

            
              
            

            <code class="ruby">    message_count = sub_agent.messages.where(role: &quot;assistant&quot;).count</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="79">
            

            
              
            

            <code class="ruby">    word_count_value = word_count(merge_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">    &quot;Merging #{message_count} assistant #{&#39;response&#39;.pluralize(message_count)} (#{word_count_value} words)&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="84">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def word_count(content)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="85">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    content.to_s.split.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="88">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def assistant_message_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="89">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">    sub_agent.messages.where(role: &quot;assistant&quot;).count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="92">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def has_content_to_merge?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="93">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">    assistant_message_count &gt; 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="96">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def content_is_long?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="97">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    merge_content.length &gt; 1000</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="100">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def is_large_merge?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="101">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">    assistant_message_count &gt; 10 || word_count(merge_content) &gt; 1000</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="104">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def success_message_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="105">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    &quot;rounded-md bg-green-50 p-4 mb-4&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="108">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def error_message_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="109">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    &quot;rounded-md bg-red-50 p-4 mb-4&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="112">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def checkbox_input_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="113">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    &quot;h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="116">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def label_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="117">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    &quot;ml-2 block text-sm text-gray-900&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="120">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def description_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="126" data-linenumber="121">
            
              <span class="hits">126</span>
            

            
              
            

            <code class="ruby">    &quot;ml-6 text-xs text-gray-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="90dea76b9ac0901befa27c98f81ad9edfe3c7a18">
  <div class="header">
    <h3>app/components/sub_agent_sidebar_component.rb</h3>
    <h4>
      <span class="yellow">
  82.61%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  47.37%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>46</b> relevant lines.
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>8</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>19</b> total branches, </span>
          <span class="green"><b>9</b> branches covered</span> and
          <span class="red"><b>10</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="3">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">class SubAgentSidebarComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="4">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def initialize(document:, current_user:, active_agent: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="5">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    @document = document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="6">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    @current_user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="7">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    @active_agent = active_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="10">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="12">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  attr_reader :document, :current_user, :active_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="14">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def sub_agents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="50" data-linenumber="15">
            
              <span class="hits">50</span>
            

            
              
            

            <code class="ruby">    @sub_agents ||= document.sub_agents.includes(:claude_messages).recent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="18">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def active_agents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="19">
            
              <span class="hits">47</span>
            

            
              
            

            <code class="ruby">    @active_agents ||= sub_agents.active</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="22">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def completed_agents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="23">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">    @completed_agents ||= sub_agents.completed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="26">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def agent_types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="63" data-linenumber="28">
            
              <span class="hits">63</span>
            

            
              
            

            <code class="ruby">      { value: &quot;ruby-rails-expert&quot;, label: &quot;Rails/Ruby Expert&quot;, icon: &quot;🚂&quot;, description: &quot;Backend development&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      { value: &quot;javascript-package-expert&quot;, label: &quot;JavaScript Expert&quot;, icon: &quot;📦&quot;, description: &quot;Frontend &amp; packages&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      { value: &quot;tailwind-css-expert&quot;, label: &quot;Tailwind CSS Expert&quot;, icon: &quot;🎨&quot;, description: &quot;Styling &amp; UI&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      { value: &quot;test-runner-fixer&quot;, label: &quot;Test Runner&quot;, icon: &quot;🧪&quot;, description: &quot;Testing &amp; QA&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      { value: &quot;error-debugger&quot;, label: &quot;Error Debugger&quot;, icon: &quot;🐛&quot;, description: &quot;Bug fixing&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      { value: &quot;project-orchestrator&quot;, label: &quot;Project Orchestrator&quot;, icon: &quot;📋&quot;, description: &quot;Planning &amp; coordination&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      { value: &quot;git-auto-commit&quot;, label: &quot;Git Auto-Commit&quot;, icon: &quot;🔀&quot;, description: &quot;Version control&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="38">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def agent_icon(agent_type)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="160" data-linenumber="39">
            
              <span class="hits">160</span>
            

            
              
                <span class="hits" title="then branch hit 49 times">
                  then: 49
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    agent_types.find { |type| type[:value] == agent_type }&amp;.dig(:icon) || &quot;🤖&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="42">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def status_badge_classes(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="43">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    base_classes = &quot;inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium badge&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="45">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    case status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
                <span class="hits" title="when branch hit 37 times">
                  when: 37
                </span>
              
            

            <code class="ruby">    when &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="47">
            
              <span class="hits">37</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-green-500 text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;completed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-gray-500 text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="50">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;failed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-red-500 text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
                <span class="hits" title="when branch hit 11 times">
                  when: 11
                </span>
              
            

            <code class="ruby">    when &quot;idle&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="53">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-yellow-500 text-white&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="54">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;pending&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-gray-100 text-gray-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="56">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">      &quot;#{base_classes} bg-gray-100 text-gray-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="61">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def status_icon(status)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="62">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    case status</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
                <span class="hits" title="when branch hit 37 times">
                  when: 37
                </span>
              
            

            <code class="ruby">    when &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="64">
            
              <span class="hits">37</span>
            

            
              
            

            <code class="ruby">      &#39;&lt;svg class=&quot;w-3 h-3 mr-1&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">        &lt;path d=&quot;M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z&quot; clip-rule=&quot;evenodd&quot; fill-rule=&quot;evenodd&quot;&gt;&lt;/path&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      &lt;/svg&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;completed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &#39;&lt;svg class=&quot;w-3 h-3 mr-1&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z&quot; clip-rule=&quot;evenodd&quot;&gt;&lt;/path&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      &lt;/svg&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="71">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;failed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">      &#39;&lt;svg class=&quot;w-3 h-3 mr-1&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">        &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z&quot; clip-rule=&quot;evenodd&quot;&gt;&lt;/path&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      &lt;/svg&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="75">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;paused&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="76">
            

            
              
            

            <code class="ruby">      &#39;&lt;svg class=&quot;w-3 h-3 mr-1&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M18 10a8 8 0 11-16 0 8 8 0 0116 0zM7 8a1 1 0 012 0v4a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1z&quot; clip-rule=&quot;evenodd&quot;&gt;&lt;/path&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      &lt;/svg&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="80">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      &#39;&lt;svg class=&quot;w-3 h-3 mr-1&quot; fill=&quot;currentColor&quot; viewBox=&quot;0 0 20 20&quot;&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        &lt;path fill-rule=&quot;evenodd&quot; d=&quot;M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z&quot; clip-rule=&quot;evenodd&quot;&gt;&lt;/path&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      &lt;/svg&gt;&#39;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="86">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def format_timestamp(timestamp)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="49" data-linenumber="87">
            
              <span class="hits">49</span>
            

            
              
                <span class="hits" title="else branch hit 49 times">
                  else: 49
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return &quot;&quot; unless timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="89">
            
              <span class="hits">49</span>
            

            
              
                <span class="hits" title="then branch hit 49 times">
                  then: 49
                </span>
              
            

            <code class="ruby">    if timestamp.today?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="49" data-linenumber="90">
            
              <span class="hits">49</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      timestamp.strftime(&quot;%l:%M %p&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="91">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    elsif timestamp.yesterday?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
            

            <code class="ruby">      &quot;Yesterday&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      timestamp.strftime(&quot;%b %d&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="98">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def agent_selected?(agent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="99">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    active_agent &amp;&amp; active_agent.id == agent.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="102">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def new_agent_button_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="103">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    &quot;w-full inline-flex items-center justify-center px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="106">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def empty_state_visible?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="107">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    sub_agents.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="509a5126627d08b461277fa7c3f57ad3dbf16155">
  <div class="header">
    <h3>app/components/theme_toggle_component.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  80.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>15</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ThemeToggleComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  include ActionView::Helpers::TagHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(variant: :default, size: :md, position: :inline, classes: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="7">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @variant = variant</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="8">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @size = size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="9">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @position = position</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="10">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    @classes = classes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :variant, :size, :position, :classes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def wrapper_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="18">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    base_classes = [ &quot;theme-toggle-wrapper&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="29" data-linenumber="20">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case position</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when :fixed_top_right</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;fixed top-4 right-4 z-50&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :fixed_bottom_right</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;fixed bottom-4 right-4 z-50&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
                <span class="hits" title="when branch hit 26 times">
                  when: 26
                </span>
              
            

            <code class="ruby">    when :inline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="26">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;inline-flex&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="29">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="32">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def toggle_classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="33">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      &quot;relative inline-flex items-center justify-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      &quot;transition-all duration-300 ease-creative&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">      &quot;rounded-full border-2 border-transparent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">      &quot;focus:outline-none focus:ring-2 focus:ring-offset-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      &quot;focus:ring-creative-primary-500&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    # Size variations</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="29" data-linenumber="42">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :sm</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;w-8 h-8 p-1.5&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
                <span class="hits" title="when branch hit 26 times">
                  when: 26
                </span>
              
            

            <code class="ruby">    when :md</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="46">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;w-10 h-10 p-2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when :lg</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; &quot;w-12 h-12 p-2.5&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    # Variant styles</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="29" data-linenumber="52">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case variant</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
                <span class="hits" title="when branch hit 25 times">
                  when: 25
                </span>
              
            

            <code class="ruby">    when :default</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="54">
            
              <span class="hits">25</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-neutral-200 text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">        &quot;hover:bg-creative-neutral-300 hover:text-creative-neutral-800&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">        &quot;dark:bg-creative-neutral-700 dark:text-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:bg-creative-neutral-600 dark:hover:text-creative-neutral-100&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when :primary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="61">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        &quot;bg-creative-primary-100 text-creative-primary-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        &quot;hover:bg-creative-primary-200 hover:text-creative-primary-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        &quot;dark:bg-creative-primary-900/30 dark:text-creative-primary-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:bg-creative-primary-800/30 dark:hover:text-creative-primary-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :outline</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="68">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        &quot;border-creative-neutral-300 text-creative-neutral-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">        &quot;hover:border-creative-neutral-400 hover:bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">        &quot;dark:border-creative-neutral-600 dark:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">        &quot;dark:hover:border-creative-neutral-500 dark:hover:bg-creative-neutral-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :ghost</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes &lt;&lt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        &quot;text-creative-neutral-600 hover:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        &quot;dark:text-creative-neutral-400 dark:hover:bg-creative-neutral-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">      ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">    # Add custom classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="82">
            
              <span class="hits">29</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 27 times">
                  else: 27
                </span>
              
            

            <code class="ruby">    base_classes &lt;&lt; classes if classes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="84">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    base_classes.flatten.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="87">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def controller_data</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="88">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      controller: &quot;theme&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      theme_storage_key_value: &quot;creative-theme&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="fd43c3c57b68a64d92a2e94ea3de05dc174064fb">
  <div class="header">
    <h3>app/components/widget_drop_zone_component.rb</h3>
    <h4>
      <span class="green">
  95.77%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  95.83%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>71</b> relevant lines.
      <span class="green"><b>68</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>24</b> total branches, </span>
          <span class="green"><b>23</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="3">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">class WidgetDropZoneComponent &lt; ViewComponent::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="4">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  include ActionView::Helpers::TagHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def initialize(target_element:, accepted_types: [], options: {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="7">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @target_element = target_element</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="8">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @accepted_types = accepted_types.presence || %w[context_item widget snippet]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="9">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @options = options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="10">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @show_instructions = options.fetch(:show_instructions, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="11">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @allow_multiple = options.fetch(:allow_multiple, true)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="12">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @position = options.fetch(:position, :center) # :top, :center, :bottom</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="13">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    @size = options.fetch(:size, :medium) # :small, :medium, :large</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="18">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  attr_reader :target_element, :accepted_types, :options, :show_instructions, :allow_multiple, :position, :size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="20">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def drop_zone_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="21">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      &quot;widget-drop-zone&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      &quot;relative&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      &quot;ease-creative&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      &quot;border-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      &quot;border-dashed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      &quot;border-transparent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      &quot;rounded-xl&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    # Size variants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="34">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :small</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;p-4&quot;, &quot;min-h-[100px]&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :large</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;p-8&quot;, &quot;min-h-[300px]&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="40">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;p-6&quot;, &quot;min-h-[200px]&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    # Position variants</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="44">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    case position</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :top</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;items-start&quot;, &quot;justify-center&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when :bottom</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;items-end&quot;, &quot;justify-center&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="50">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;items-center&quot;, &quot;justify-center&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="53">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    base_classes += [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      &quot;flex-col&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      &quot;text-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      # Default state</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-neutral-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-neutral-900&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      &quot;hover:bg-creative-neutral-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">      &quot;dark:hover:bg-creative-neutral-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="64">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="67">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def drop_zone_active_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      &quot;border-creative-primary-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-primary-600&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-primary-50&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-primary-900/20&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-lg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">      &quot;scale-102&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="79">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def drop_zone_hover_class</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      &quot;border-creative-primary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-primary-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-primary-100&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-primary-800/30&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      &quot;shadow-creative-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      &quot;dark:shadow-creative-dark-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      &quot;scale-105&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="91">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def instructions_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="92">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      &quot;transition-opacity&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      &quot;space-y-3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="98">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :small</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-sm&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :large</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-lg&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="104">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-base&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="107">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="110">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def icon_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="111">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      &quot;mx-auto&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="119">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :small</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="121">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;w-8&quot;, &quot;h-8&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :large</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="123">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;w-16&quot;, &quot;h-16&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="125">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;w-12&quot;, &quot;h-12&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="128">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="131">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def title_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="132">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">      &quot;font-semibold&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-700&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="140">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :small</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-sm&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :large</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-xl&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="146">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-lg&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="149">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="152">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def description_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="153">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes = [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">      &quot;text-creative-neutral-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">      &quot;dark:text-creative-neutral-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">      &quot;transition-colors&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">      &quot;duration-200&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="160">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    case size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :small</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="162">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-xs&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :large</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="164">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-base&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="166">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      base_classes += [ &quot;text-sm&quot; ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="169">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    base_classes.join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="172">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def accepted_types_list</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="173">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    accepted_types.map do |type|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="44" data-linenumber="174">
            
              <span class="hits">44</span>
            

            
              
            

            <code class="ruby">      case type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
                <span class="hits" title="when branch hit 14 times">
                  when: 14
                </span>
              
            

            <code class="ruby">      when &quot;context_item&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="176">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        &quot;Context Items&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
                <span class="hits" title="when branch hit 14 times">
                  when: 14
                </span>
              
            

            <code class="ruby">      when &quot;widget&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="178">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        &quot;Widgets&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
                <span class="hits" title="when branch hit 14 times">
                  when: 14
                </span>
              
            

            <code class="ruby">      when &quot;snippet&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="180">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        &quot;Code Snippets&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when &quot;image&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="182">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        &quot;Images&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when &quot;file&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="184">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        &quot;Files&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="185">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            

            
              
            

            <code class="ruby">        type.humanize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">    end.join(&quot;, &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="191">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def drop_zone_data_attributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="192">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">      controller: &quot;widget-drop-zone&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">      &quot;widget_drop_zone_target_value&quot;: target_element,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">      &quot;widget_drop_zone_accepted_types_value&quot;: accepted_types.to_json,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">      &quot;widget_drop_zone_allow_multiple_value&quot;: allow_multiple,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">      &quot;widget_drop_zone_position_value&quot;: position,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">      action: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">        &quot;dragover-&gt;widget-drop-zone#handleDragOver&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">        &quot;dragenter-&gt;widget-drop-zone#handleDragEnter&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">        &quot;dragleave-&gt;widget-drop-zone#handleDragLeave&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">        &quot;drop-&gt;widget-drop-zone#handleDrop&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">      ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="207">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def overlay_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="208">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">      &quot;absolute&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">      &quot;inset-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">      &quot;bg-creative-primary-500/10&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">      &quot;dark:bg-creative-primary-400/10&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby">      &quot;backdrop-blur-sm&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="214">
            

            
              
            

            <code class="ruby">      &quot;rounded-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby">      &quot;opacity-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">      &quot;invisible&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">      &quot;transition-all&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="218">
            

            
              
            

            <code class="ruby">      &quot;duration-300&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">      &quot;flex&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">      &quot;items-center&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">      &quot;justify-center&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="225">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def pulse_animation_class</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="226">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">      &quot;absolute&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">      &quot;inset-0&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">      &quot;border-2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">      &quot;border-creative-primary-400&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby">      &quot;dark:border-creative-primary-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">      &quot;rounded-xl&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="233">
            

            
              
            

            <code class="ruby">      &quot;animate-ping&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="234">
            

            
              
            

            <code class="ruby">      &quot;opacity-75&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby">    ].join(&quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="236">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a1a0e0279edb377f02af71fff78395d5dfb05002">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>11</b> relevant lines.
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  include Authentication</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  include Pundit::Authorization</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Only allow modern browsers supporting webp images, web push, badges, import maps, CSS nesting, and CSS :has.</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # Temporarily disabled for test compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # allow_browser versions: :modern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Pundit error handling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  rescue_from Pundit::NotAuthorizedError, with: :user_not_authorized</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  helper_method :current_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="136" data-linenumber="17">
            
              <span class="hits">136</span>
            

            
              
            

            <code class="ruby">    Current.user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def user_not_authorized</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="21">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    flash[:alert] = &quot;You are not authorized to access this document.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="22">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    redirect_to documents_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="02bcdf60229f29a8a1e8d8614a00a6f623837551">
  <div class="header">
    <h3>app/controllers/cloud_files_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  83.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>47</b> relevant lines.
      <span class="green"><b>47</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>10</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudFilesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Authentication is already handled by ApplicationController via Authentication concern</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_cloud_integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_cloud_file, only: [ :import, :show ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    @cloud_files = @cloud_integration.cloud_files</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">                                     .includes(:document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">                                     .limit(20)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    # Filter by importable status if requested</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="12">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    if params[:importable] == &quot;true&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="13">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @cloud_files = @cloud_files.importable</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    # Load the files into memory to avoid extra queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    files_array = @cloud_files.to_a</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    # Sync files if requested or if last sync was over an hour ago</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    # Use the already loaded files to check sync status</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="21">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 10 times">
                  then: 10
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if params[:sync] == &quot;true&quot; || files_array.empty? || sync_needed_for_files?(files_array)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="23">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">        CloudFileSyncJob.perform_later(@cloud_integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="24">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        flash.now[:notice] = &quot;Syncing files in the background...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        Rails.logger.error &quot;Failed to enqueue sync job: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        flash.now[:alert] = &quot;Unable to sync files at this time. Please try again later.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="32">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    # Show file details and import options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def import</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="37">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless @cloud_file.importable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integration_cloud_files_path(@cloud_integration),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">                  alert: &quot;This file type cannot be imported&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    # Queue import job</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    CloudFileImportJob.perform_later(@cloud_file, current_user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="46">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    redirect_to cloud_integration_cloud_files_path(@cloud_integration),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">                notice: &quot;File import queued. You&#39;ll be notified when it&#39;s ready.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="50">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def export</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="51">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @document = current_user.documents.find(params[:document_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="54">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      service = cloud_service_for(@cloud_integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="55">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      cloud_file = service.export_document(@document, export_options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      redirect_to document_path(@document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">                  notice: &quot;Document exported to #{@cloud_integration.provider_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Export error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to document_path(@document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">                  alert: &quot;Failed to export: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="66">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="68">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_cloud_integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="69">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">    @cloud_integration = current_user.cloud_integrations.find(params[:cloud_integration_id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="72">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_cloud_file</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="73">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    @cloud_file = @cloud_integration.cloud_files.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="76">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sync_needed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="77">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    last_file = @cloud_integration.cloud_files.order(:last_synced_at).last</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="78">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    last_file.nil? || last_file.last_synced_at.nil? || last_file.last_synced_at &lt; 1.hour.ago</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="81">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sync_needed_for_files?(files)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="82">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
            

            <code class="ruby">    return true if files.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">    # Find the most recently synced file from the already loaded array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="39" data-linenumber="85">
            
              <span class="hits">39</span>
            

            
              
            

            <code class="ruby">    last_synced = files.max_by { |f| f.last_synced_at || Time.at(0) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="86">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    last_synced.last_synced_at.nil? || last_synced.last_synced_at &lt; 1.hour.ago</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="89">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def cloud_service_for(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="90">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    case integration.provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::GoogleDriveService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::DropboxService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="96">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::NotionService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise &quot;Unknown provider: #{integration.provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="102">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def export_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="103">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    params.permit(:folder_id, :folder_path, :parent_page_id).to_h.symbolize_keys</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a5b0690d8fd08a7b69bd7f4b0ae41638fbe7858e">
  <div class="header">
    <h3>app/controllers/cloud_integrations_controller.rb</h3>
    <h4>
      <span class="green">
  98.39%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  95.45%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>62</b> relevant lines.
      <span class="green"><b>61</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>22</b> total branches, </span>
          <span class="green"><b>21</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudIntegrationsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Authentication is already handled by ApplicationController via Authentication concern</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_cloud_integration, only: [ :destroy ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="6">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @cloud_integrations = current_user.cloud_integrations.includes(:cloud_files)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="7">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @available_providers = CloudIntegration::PROVIDERS.map do |provider|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="9">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">        name: provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">        display_name: provider.humanize,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        connected: @cloud_integrations.exists?(provider: provider),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        integration: @cloud_integrations.find_by(provider: provider)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="18">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @provider = params[:provider]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless CloudIntegration::PROVIDERS.include?(@provider)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integrations_path, alert: &quot;Invalid provider&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    # Check if already connected</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="26">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if current_user.cloud_integrations.exists?(provider: @provider)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integrations_path, notice: &quot;Already connected to #{@provider.humanize}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    # Redirect to OAuth authorization</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to authorization_url_for(@provider), allow_other_host: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="35">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    provider_name = @cloud_integration.provider_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @cloud_integration.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to cloud_integrations_path, notice: &quot;Disconnected from #{provider_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  # OAuth callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="42">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def google_callback</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="43">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    handle_oauth_callback(&quot;google_drive&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="46">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def dropbox_callback</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    handle_oauth_callback(&quot;dropbox&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="50">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def notion_callback</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    handle_oauth_callback(&quot;notion&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="54">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="56">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_cloud_integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @cloud_integration = current_user.cloud_integrations.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="60">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def authorization_url_for(provider)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="61">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="63">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      CloudServices::GoogleDriveService.authorization_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="65">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::DropboxService.authorization_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::NotionService.authorization_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise &quot;Unknown provider: #{provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="73">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def handle_oauth_callback(provider)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="74">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    if params[:error]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integrations_path, alert: &quot;Authorization failed: #{params[:error_description] || params[:error]}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="79">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    code = params[:code]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="81">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    unless code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integrations_path, alert: &quot;Authorization code not received&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      # Exchange code for tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="88">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      token_data = case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
                <span class="hits" title="when branch hit 6 times">
                  when: 6
                </span>
              
            

            <code class="ruby">      when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="90">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">        CloudServices::GoogleDriveService.exchange_code(code)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        CloudServices::DropboxService.exchange_code(code)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="94">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        CloudServices::NotionService.exchange_code(code)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="95">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            

            
              
            

            <code class="ruby">        raise &quot;Unknown provider: #{provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">      # Create or update integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="100">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      integration = current_user.cloud_integrations.find_or_initialize_by(provider: provider)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="102">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      integration.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        access_token: token_data[&quot;access_token&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">        refresh_token: token_data[&quot;refresh_token&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        expires_at: calculate_expiry(token_data[&quot;expires_in&quot;]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">        settings: extract_additional_data(token_data, provider)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">      # Queue initial sync</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="110">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      CloudFileSyncJob.perform_later(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="112">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integrations_path, notice: &quot;Successfully connected to #{provider.humanize}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="114">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;OAuth callback error for #{provider}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="115">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      redirect_to cloud_integrations_path, alert: &quot;Failed to connect: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="119">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def calculate_expiry(expires_in)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="120">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    return nil if expires_in.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="121">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    Time.current + expires_in.seconds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="124">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def extract_additional_data(token_data, provider)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="125">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="128">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        scope: token_data[&quot;scope&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">        token_type: token_data[&quot;token_type&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="133">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        account_id: token_data[&quot;account_id&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">        uid: token_data[&quot;uid&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="138">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        bot_id: token_data[&quot;bot_id&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">        workspace_name: token_data[&quot;workspace_name&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">        workspace_icon: token_data[&quot;workspace_icon&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">        workspace_id: token_data[&quot;workspace_id&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="08af0401a099b034b4fe32e0e6e57c01a31380d8">
  <div class="header">
    <h3>app/controllers/concerns/authentication.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  83.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>5</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module Authentication</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  extend ActiveSupport::Concern</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  included do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    before_action :require_authentication</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    helper_method :authenticated?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class_methods do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def allow_unauthenticated_access(**options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="11">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      skip_before_action :require_authentication, **options</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def authenticated?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="17">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">      resume_session</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="20">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def require_authentication</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="159" data-linenumber="21">
            
              <span class="hits">159</span>
            

            
              
            

            <code class="ruby">      resume_session || request_authentication</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def resume_session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="210" data-linenumber="25">
            
              <span class="hits">210</span>
            

            
              
            

            <code class="ruby">      Current.session ||= find_session_by_cookie</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="210" data-linenumber="26">
            
              <span class="hits">210</span>
            

            
              
                <span class="hits" title="then branch hit 189 times">
                  then: 189
                </span>
              
                <span class="hits" title="else branch hit 21 times">
                  else: 21
                </span>
              
                <span class="hits" title="then branch hit 189 times">
                  then: 189
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      Current.user = Current.session&amp;.user if Current.session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="210" data-linenumber="27">
            
              <span class="hits">210</span>
            

            
              
            

            <code class="ruby">      Current.session</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def find_session_by_cookie</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="162" data-linenumber="31">
            
              <span class="hits">162</span>
            

            
              
                <span class="hits" title="then branch hit 142 times">
                  then: 142
                </span>
              
                <span class="hits" title="else branch hit 20 times">
                  else: 20
                </span>
              
            

            <code class="ruby">      Session.find_by(id: cookies.signed[:session_id]) if cookies.signed[:session_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def request_authentication</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="35">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      session[:return_to_after_authenticating] = request.url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="36">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      redirect_to new_session_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def after_authentication_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="40">
            
              <span class="hits">151</span>
            

            
              
            

            <code class="ruby">      session.delete(:return_to_after_authenticating) || root_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def start_new_session_for(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="44">
            
              <span class="hits">151</span>
            

            
              
            

            <code class="ruby">      user.sessions.create!(user_agent: request.user_agent, ip_address: request.remote_ip).tap do |session|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="45">
            
              <span class="hits">151</span>
            

            
              
            

            <code class="ruby">        Current.session = session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="46">
            
              <span class="hits">151</span>
            

            
              
            

            <code class="ruby">        cookies.signed.permanent[:session_id] = { value: session.id, httponly: true, same_site: :lax }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def terminate_session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="51">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      Current.session.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="52">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      cookies.delete(:session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2195c3eeb15905c94d002efbb38ca925de2a9d2d">
  <div class="header">
    <h3>app/controllers/context_items_controller.rb</h3>
    <h4>
      <span class="red">
  63.74%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  20.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>91</b> relevant lines.
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>33</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>20</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>16</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ContextItemsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_context_item, only: [ :show, :edit, :update, :destroy ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="7">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="8">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="10">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    @context_items = policy_scope(@document.context_items).includes(:user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    # Apply search and filters</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="13">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if params[:q].present? || params[:item_type].present? || params[:date_from].present? || params[:date_to].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">      @context_items = @context_items.filtered_search(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">        query: params[:q],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">        item_type: params[:item_type],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        date_from: params[:date_from],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        date_to: params[:date_to]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="21">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      @context_items = @context_items.recent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="24">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="25">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      format.html # index.html.erb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="26">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      format.json {</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="27">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        if params[:q].present? &amp;&amp; params[:include_highlights] == &quot;true&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="28">
            

            
              
            

            <code class="ruby">          render json: @context_items.map { |item|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">            {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">              id: item.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">              title: item.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">              content: item.content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">              item_type: item.item_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">              created_at: item.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">              user: { id: item.user.id, name: item.user.name },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">              highlights: item.search_highlights(params[:q])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="39">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="40">
            

            
              
            

            <code class="ruby">          render json: @context_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="48">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.html # show.html.erb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.json { render json: @context_item }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items/new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="58">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="59">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @context_item = @document.context_items.build</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @context_item.user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items/1/edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="65">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/context_items</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/context_items.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="71">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="72">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @context_item = @document.context_items.build(context_item_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="73">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @context_item.user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="74">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    authorize @context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="76">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="77">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">      if @context_item.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="78">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        format.html { redirect_to document_context_item_path(@document, @context_item),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">                      notice: &quot;Context item was successfully created.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="80">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        format.json { render json: @context_item, status: :created }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="81">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render turbo_stream: turbo_stream.prepend(&quot;context_items&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">                              partial: &quot;context_items/context_item&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">                              locals: { context_item: @context_item }) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="85">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :new, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="86">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: @context_item.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render turbo_stream: turbo_stream.replace(&quot;new_context_item&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">                              partial: &quot;context_items/form&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">                              locals: { context_item: @context_item }) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">  # PATCH/PUT /documents/:document_id/context_items/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  # PATCH/PUT /documents/:document_id/context_items/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="96">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="97">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="100">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      if @context_item.update(context_item_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="101">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        format.html { redirect_to document_context_item_path(@document, @context_item),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">                      notice: &quot;Context item was successfully updated.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="103">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        format.json { render json: @context_item }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="104">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render turbo_stream: turbo_stream.replace(@context_item,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">                              partial: &quot;context_items/context_item&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">                              locals: { context_item: @context_item }) }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="107">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            

            
              
            

            <code class="ruby">        format.json { render json: @context_item.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            

            
              
            

            <code class="ruby">        format.turbo_stream { render turbo_stream: turbo_stream.replace(&quot;edit_context_item_#{@context_item.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">                              partial: &quot;context_items/form&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">                              locals: { context_item: @context_item }) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  # DELETE /documents/:document_id/context_items/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">  # DELETE /documents/:document_id/context_items/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="119">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="120">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @context_item</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="121">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @context_item.destroy!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="123">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="124">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      format.html { redirect_to document_context_items_path(@document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">                    notice: &quot;Context item was successfully destroyed.&quot;, status: :see_other }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="126">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      format.json { head :no_content }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="127">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream { render turbo_stream: turbo_stream.remove(@context_item) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/context_items/reorder</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="132">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def reorder</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="133">
            

            
              
            

            <code class="ruby">    authorize @document, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            

            
              
            

            <code class="ruby">    params[:item_ids].each_with_index do |id, index|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="136">
            

            
              
            

            <code class="ruby">      @document.context_items.find(id).update_column(:position, index + 1)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            

            
              
            

            <code class="ruby">    head :ok</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items/search</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/context_items/search.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="144">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def search</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            

            
              
            

            <code class="ruby">    authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    # Use ranked search for better relevance</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="148">
            

            
              
            

            <code class="ruby">    @context_items = policy_scope(@document.context_items)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="150">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if params[:q].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="151">
            

            
              
            

            <code class="ruby">      @context_items = @context_items.ranked_search(params[:q])</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="152">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="153">
            

            
              
            

            <code class="ruby">      @context_items = @context_items.includes(:user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">    # Apply additional filters</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="157">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    @context_items = @context_items.by_type(params[:item_type]) if params[:item_type].present?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="158">
            

            
              
            

            <code class="ruby">    @context_items = @context_items.by_date_range(params[:date_from], params[:date_to])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">    # Paginate results if needed</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="161">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    @context_items = @context_items.page(params[:page]).per(params[:per_page] || 25) if defined?(Kaminari)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="164">
            

            
              
            

            <code class="ruby">      format.html { render :index }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            

            
              
            

            <code class="ruby">      format.json {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            

            
              
            

            <code class="ruby">        results = @context_items.map do |item|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">          item_json = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="168">
            

            
              
            

            <code class="ruby">            id: item.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">            title: item.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">            content: item.content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">            item_type: item.item_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">            created_at: item.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">            user: { id: item.user.id, name: item.user.name },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">            document: { id: item.document.id, title: item.document.title }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">          # Add search rank if available</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="178">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          item_json[:rank] = item.rank if item.respond_to?(:rank)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">          # Add highlights if requested</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="181">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          if params[:q].present? &amp;&amp; params[:include_highlights] == &quot;true&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            

            
              
            

            <code class="ruby">            item_json[:highlights] = item.search_highlights(params[:q])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="185">
            

            
              
            

            <code class="ruby">          item_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="188">
            

            
              
            

            <code class="ruby">        render json: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">          results: results,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">          meta: {</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="191">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            total: @context_items.respond_to?(:total_count) ? @context_items.total_count : @context_items.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">            page: params[:page] || 1,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">            per_page: params[:per_page] || 25,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby">            query: params[:q],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby">            filters: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">              item_type: params[:item_type],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">              date_from: params[:date_from],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">              date_to: params[:date_to]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="203">
            

            
              
            

            <code class="ruby">      format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            

            
              
            

            <code class="ruby">        render turbo_stream: turbo_stream.replace(&quot;context_items&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">                            partial: &quot;context_items/search_results&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">                            locals: { context_items: @context_items, query: params[:q] })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="211">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">    # Use callbacks to share common setup or constraints between actions.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="213">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def set_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="214">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      @document = Document.find(params[:document_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="20" data-linenumber="215">
            
              <span class="hits">20</span>
            

            
              
            

            <code class="ruby">      authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="218">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def set_context_item</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="219">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      @context_item = @document.context_items.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">    # Only allow a list of trusted parameters through.</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="223">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def context_item_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="224">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      params.require(:context_item).permit(:content, :item_type, :title, :metadata)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d51bb8329b08172d69a22c0b7e98f2bb37bf852a">
  <div class="header">
    <h3>app/controllers/documents_controller.rb</h3>
    <h4>
      <span class="green">
  94.55%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>55</b> relevant lines.
      <span class="green"><b>52</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>7</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class DocumentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_document, only: [ :show, :edit, :update, :destroy, :duplicate, :autosave ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">  # Authorization is handled per action using Pundit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="6">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @documents = policy_scope(Document).recent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="10">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @document = Current.user.documents.build</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="15">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @document = Current.user.documents.build(document_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="16">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @document.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="19">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to @document, notice: &quot;Document was successfully created.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="25">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="26">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="30">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="33">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="34">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    authorize @document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="35">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @document.update(document_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="37">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { redirect_to @document, notice: &quot;Document was successfully updated.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="38">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render turbo_stream: turbo_stream_update_response }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: { status: &quot;success&quot;, updated_at: @document.updated_at } }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="43">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { render turbo_stream: turbo_stream_error_response, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="45">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: { status: &quot;error&quot;, errors: @document.errors.full_messages }, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="50">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="51">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @document.destroy!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="53">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to documents_url, notice: &quot;Document was successfully deleted.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="56">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def duplicate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @new_document = @document.duplicate_for(Current.user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="60">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @new_document.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_document_url(@new_document), notice: &quot;Document was successfully duplicated.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="62">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="63">
            

            
              
            

            <code class="ruby">      redirect_to @document, alert: &quot;Failed to duplicate document.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="67">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def autosave</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @document, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="69">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @document.update(autosave_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="70">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render json: { status: &quot;saved&quot;, updated_at: @document.updated_at }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render json: { status: &quot;error&quot;, errors: @document.errors.full_messages }, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="76">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="78">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="79">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    @document = Document.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  rescue ActiveRecord::RecordNotFound</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    redirect_to documents_url, alert: &quot;Document not found.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="84">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def document_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="85">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    params.require(:document).permit(:title, :content, :description, :tag_list)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="88">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def autosave_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="89">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    params.require(:document).permit(:content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="92">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def turbo_stream_update_response</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">    [</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="94">
            

            
              
            

            <code class="ruby">      turbo_stream.replace(&quot;document_status&quot;, partial: &quot;documents/status&quot;, locals: { document: @document, status: &quot;saved&quot; }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      turbo_stream.replace(&quot;document_last_saved&quot;, partial: &quot;documents/last_saved&quot;, locals: { document: @document })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="99">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def turbo_stream_error_response</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">    turbo_stream.replace(&quot;document_status&quot;, partial: &quot;documents/status&quot;, locals: { document: @document, status: &quot;error&quot; })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ca7c3f0f61fd64ed1092ce6cb9a06f11d9bcaa04">
  <div class="header">
    <h3>app/controllers/passwords_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>18</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>4</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">class PasswordsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="2">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  allow_unauthenticated_access</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="3">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  layout &quot;authentication&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="4">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  before_action :set_user_by_token, only: %i[ edit update ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="6">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="9">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="10">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    if user = User.find_by(email_address: params[:email_address])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      PasswordsMailer.reset(user).deliver_later</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="14">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    redirect_to new_session_path, notice: &quot;Password reset instructions sent (if user with that email address exists).&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="17">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="20">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="21">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @user.update(params.permit(:password, :password_confirmation))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to new_session_path, notice: &quot;Password has been reset.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to edit_password_path(params[:token]), alert: &quot;Passwords did not match.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="28">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="29">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    def set_user_by_token</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="30">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      @user = User.find_by_password_reset_token!(params[:token])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    rescue ActiveSupport::MessageVerifier::InvalidSignature</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="32">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      redirect_to new_password_path, alert: &quot;Password reset link is invalid or has expired.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="21eea85fc05e25472814743b8717e5a6539e13de">
  <div class="header">
    <h3>app/controllers/profiles_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>23</b> relevant lines.
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ProfilesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="7">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="10">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if @user.update(profile_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      redirect_to profile_path, notice: &quot;Your profile has been updated.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="14">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :edit, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="18">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def password</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="21">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="22">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    if @user.authenticate(params[:current_password])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="23">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      if @user.update(password_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to profile_path, notice: &quot;Your password has been changed successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        render :password, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @user.errors.add(:current_password, &quot;is incorrect&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render :password, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="34">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="37">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    @user = Current.user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def profile_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="41">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    params.require(:user).permit(:name, :email_address)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="44">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def password_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="45">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    params.require(:user).permit(:password, :password_confirmation)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="3ffe10daf7f398fb7c45ec9318a650b6518e3b0c">
  <div class="header">
    <h3>app/controllers/sessions_controller.rb</h3>
    <h4>
      <span class="red">
  39.13%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  31.25%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>46</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>28</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>5</b> branches covered</span> and
          <span class="red"><b>11</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SessionsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  allow_unauthenticated_access only: %i[ new create omniauth omniauth_failure ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  layout &quot;authentication&quot;, only: %i[ new create ]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="4">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  rate_limit to: 10, within: 3.minutes, only: :create, with: -&gt; { redirect_to new_session_url, alert: &quot;Try again later.&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="165" data-linenumber="10">
            
              <span class="hits">165</span>
            

            
              
                <span class="hits" title="then branch hit 152 times">
                  then: 152
                </span>
              
            

            <code class="ruby">    if user = User.authenticate_by(params.permit(:email_address, :password))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="152" data-linenumber="11">
            
              <span class="hits">152</span>
            

            
              
                <span class="hits" title="then branch hit 151 times">
                  then: 151
                </span>
              
            

            <code class="ruby">      if user.email_confirmed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="12">
            
              <span class="hits">151</span>
            

            
              
            

            <code class="ruby">        start_new_session_for user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">        # Check if there&#39;s a pending OAuth identity to link</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="151" data-linenumber="15">
            
              <span class="hits">151</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 151 times">
                  else: 151
                </span>
              
            

            <code class="ruby">        if session[:pending_identity]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">          identity = Identity.find_or_initialize_by(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">            provider: session[:pending_identity][&quot;provider&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">            uid: session[:pending_identity][&quot;uid&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">          identity.user = user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">          identity.email = session[:pending_identity][&quot;email&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">          identity.name = session[:pending_identity][&quot;name&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="24">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          if identity.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">            session.delete(:pending_identity)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">            redirect_to profile_path, notice: &quot;Successfully linked your #{identity.provider.titleize} account!&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">            return</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="151" data-linenumber="31">
            
              <span class="hits">151</span>
            

            
              
            

            <code class="ruby">        redirect_to after_authentication_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to new_session_path, alert: &quot;Please confirm your email address before signing in. Check your inbox for the confirmation email.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="36">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">      redirect_to new_session_path, alert: &quot;Try another email address or password.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="41">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    terminate_session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="42">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    redirect_to new_session_path</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="45">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def omniauth</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="46">
            

            
              
            

            <code class="ruby">    auth = request.env[&quot;omniauth.auth&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">    identity = Identity.find_or_create_from_auth(auth)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="49">
            

            
              
            

            <code class="ruby">    if identity.user</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="50">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Existing user with this OAuth account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">      start_new_session_for identity.user</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="52">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      redirect_to after_authentication_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">    elsif authenticated?</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="54">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      # Logged in user linking new OAuth account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">      identity.user = Current.user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">      identity.save!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="57">
            

            
              
            

            <code class="ruby">      redirect_to profile_path, notice: &quot;#{auth.provider.titleize} account linked successfully!&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="59">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      # New user or need to link to existing account</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="60">
            

            
              
            

            <code class="ruby">      if existing_user = User.find_by(email_address: auth.info.email)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="61">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        # Email matches existing user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">        session[:pending_identity] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">          provider: auth.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">          uid: auth.uid,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">          email: auth.info.email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">          name: auth.info.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">        redirect_to new_session_path, notice: &quot;An account with this email already exists. Please sign in to link your #{auth.provider.titleize} account.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="70">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        # Create new user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="71">
            

            
              
            

            <code class="ruby">        user = User.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">          email_address: auth.info.email,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">          name: auth.info.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">          password: SecureRandom.base58(16),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          email_confirmed: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">          email_confirmed_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="79">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        if user.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="80">
            

            
              
            

            <code class="ruby">          identity.user = user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">          identity.save!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            

            
              
            

            <code class="ruby">          start_new_session_for user</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="83">
            

            
              
            

            <code class="ruby">          redirect_to root_path, notice: &quot;Welcome! Your account has been created.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="84">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="85">
            

            
              
            

            <code class="ruby">          redirect_to new_user_path, alert: &quot;There was an error creating your account. Please try again.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="91">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def omniauth_failure</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="92">
            

            
              
            

            <code class="ruby">    redirect_to new_session_path, alert: &quot;Authentication failed. Please try again.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="6a8e8aeb6a859d71d3dc4e475f6aed4105502dc5">
  <div class="header">
    <h3>app/controllers/sub_agent_messages_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SubAgentMessagesController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_document_and_sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="5">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="7">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    message_content = params[:message]&amp;.strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="9">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
            

            <code class="ruby">    if message_content.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="10">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      service = SubAgentService.new(@sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="11">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      @message = service.send_message(current_user, message_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="13">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
            

            <code class="ruby">      if @message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="14">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="15">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">          format.json { render json: { success: true, message: message_json(@message) } }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="16">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">            render turbo_stream: turbo_stream.append(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">              &quot;sub_agent_messages_#{@sub_agent.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">              partial: &quot;sub_agent_messages/message&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">              locals: { message: @message }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">            )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="25">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="26">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          format.json { render json: { error: &quot;Failed to send message&quot; }, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="27">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          format.turbo_stream { head :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="31">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="32">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        format.json { render json: { error: &quot;Message cannot be blank&quot; }, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="33">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream { head :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="38">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_document_and_sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="41">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @document = Document.find(params[:document_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="42">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    @sub_agent = @document.sub_agents.find(params[:sub_agent_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="43">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="46">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def message_json(message)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      id: message.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      role: message.role,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      content: message.content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      user: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">        id: message.user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">        name: message.user.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">      created_at: message.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      formatted_time: message.created_at.strftime(&quot;%l:%M %p&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="71cec14f6ad7722b00d7102cd69bdb0c6db4461c">
  <div class="header">
    <h3>app/controllers/sub_agents_controller.rb</h3>
    <h4>
      <span class="red">
  77.1%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>131</b> relevant lines.
      <span class="green"><b>101</b> lines covered</span> and
      <span class="red"><b>30</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SubAgentsController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  before_action :set_sub_agent, only: [ :show, :edit, :update, :destroy, :activate, :complete, :pause, :merge ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/sub_agents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/sub_agents.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="7">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="8">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="10">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @sub_agents = policy_scope(@document.sub_agents).includes(:user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">    # Apply filters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="13">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    @sub_agents = @sub_agents.by_agent_type(params[:agent_type]) if params[:agent_type].present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="14">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    @sub_agents = @sub_agents.where(status: params[:status]) if params[:status].present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    # Default ordering</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="17">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    @sub_agents = @sub_agents.recent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="19">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="20">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      format.html # index.html.erb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="21">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      format.json { render json: @sub_agents.map { |agent| agent_json(agent) } }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="22">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/sub_agents/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/sub_agents/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="28">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="29">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @recent_messages = @sub_agent.recent_messages(limit: 20)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      format.html # show.html.erb</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="35">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      format.json { render json: agent_json(@sub_agent, include_messages: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/sub_agents/new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @sub_agent = @document.sub_agents.build</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @sub_agent.user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  # GET /documents/:document_id/sub_agents/1/edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="47">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def edit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/sub_agents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/sub_agents.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="53">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="54">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @sub_agent = @document.sub_agents.build(sub_agent_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="55">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    @sub_agent.user = current_user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="56">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="58">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="59">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      if @sub_agent.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        # Initialize sub-agent through service</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="61">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        SubAgentService.new(@sub_agent).initialize_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="63">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">          notice: &quot;Sub-agent was successfully created and initialized.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="67">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.json { render json: agent_json(@sub_agent), status: :created }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          render turbo_stream: turbo_stream.prepend(&quot;sub_agents&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">                              partial: &quot;sub_agents/sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">                              locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="74">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :new, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: @sub_agent.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="76">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="77">
            

            
              
            

            <code class="ruby">          render turbo_stream: turbo_stream.replace(&quot;new_sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">                              partial: &quot;sub_agents/form&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">                              locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  # PATCH/PUT /documents/:document_id/sub_agents/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">  # PATCH/PUT /documents/:document_id/sub_agents/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="87">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="88">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="90">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="91">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">      if @sub_agent.update(sub_agent_params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="92">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">          notice: &quot;Sub-agent was successfully updated.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="96">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.json { render json: agent_json(@sub_agent) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="97">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          render turbo_stream: turbo_stream.replace(@sub_agent,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">                              partial: &quot;sub_agents/sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">                              locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="103">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        format.html { render :edit, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: @sub_agent.errors, status: :unprocessable_entity }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="106">
            

            
              
            

            <code class="ruby">          render turbo_stream: turbo_stream.replace(&quot;edit_sub_agent_#{@sub_agent.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">                              partial: &quot;sub_agents/form&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">                              locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">  # DELETE /documents/:document_id/sub_agents/1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">  # DELETE /documents/:document_id/sub_agents/1.json</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="116">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="117">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="118">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    @sub_agent.destroy!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="120">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="121">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="122">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to document_sub_agents_path(@document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">        notice: &quot;Sub-agent was successfully destroyed.&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">        status: :see_other</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="126">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      format.json { head :no_content }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="127">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream { render turbo_stream: turbo_stream.remove(@sub_agent) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/sub_agents/1/activate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="132">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def activate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="133">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="135">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    service = SubAgentService.new(@sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if service.activate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="138">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="140">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">          notice: &quot;Sub-agent activated successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="143">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: agent_json(@sub_agent) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="145">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(@sub_agent,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">                                partial: &quot;sub_agents/sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">                                locals: { sub_agent: @sub_agent }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;sub_agent_status_#{@sub_agent.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">                                partial: &quot;sub_agents/status_badge&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">                                locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="155">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="157">
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="158">
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">          alert: &quot;Failed to activate sub-agent.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="161">
            

            
              
            

            <code class="ruby">        format.json {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="162">
            

            
              
            

            <code class="ruby">          render json: { error: &quot;Failed to activate sub-agent&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">          status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/sub_agents/1/complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="170">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="171">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    service = SubAgentService.new(@sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="175">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if service.complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="176">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="177">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="178">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">          notice: &quot;Sub-agent completed successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="181">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.json { render json: agent_json(@sub_agent) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="182">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="183">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(@sub_agent,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">                                partial: &quot;sub_agents/sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">                                locals: { sub_agent: @sub_agent }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(&quot;sub_agent_status_#{@sub_agent.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">                                partial: &quot;sub_agents/status_badge&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">                                locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="193">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="194">
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">          alert: &quot;Failed to complete sub-agent.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="199">
            

            
              
            

            <code class="ruby">        format.json {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            

            
              
            

            <code class="ruby">          render json: { error: &quot;Failed to complete sub-agent&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">          status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/sub_agents/1/pause</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="208">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def pause</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="209">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    authorize @sub_agent, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="211">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @sub_agent.pause!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="213">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="215">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">        notice: &quot;Sub-agent paused.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="217">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="218">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.json { render json: agent_json(@sub_agent) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="219">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="220">
            

            
              
            

            <code class="ruby">        render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="221">
            

            
              
            

            <code class="ruby">          turbo_stream.replace(@sub_agent,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="222">
            

            
              
            

            <code class="ruby">                              partial: &quot;sub_agents/sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="223">
            

            
              
            

            <code class="ruby">                              locals: { sub_agent: @sub_agent }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="224">
            

            
              
            

            <code class="ruby">          turbo_stream.replace(&quot;sub_agent_status_#{@sub_agent.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">                              partial: &quot;sub_agents/status_badge&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">                              locals: { sub_agent: @sub_agent })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">        ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="229">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="230">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="231">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="232">
            

            
              
            

            <code class="ruby">  # POST /documents/:document_id/sub_agents/1/merge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="233">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def merge</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="234">
            

            
              
            

            <code class="ruby">    authorize @sub_agent, :update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="235">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="236">
            

            
              
            

            <code class="ruby">    merge_params = params.permit(:merge_type, :position, :separator)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="237">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="238">
            

            
              
            

            <code class="ruby">    service = SubAgentService.new(@sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="239">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="240">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    if service.merge_to_document(merge_params)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="241">
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="242">
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="243">
            

            
              
            

            <code class="ruby">          redirect_to document_path(@document),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="244">
            

            
              
            

            <code class="ruby">          notice: &quot;Sub-agent content merged successfully.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="246">
            

            
              
            

            <code class="ruby">        format.json { render json: { success: true } }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="247">
            

            
              
            

            <code class="ruby">        format.turbo_stream {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="248">
            

            
              
            

            <code class="ruby">          render turbo_stream: [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">            turbo_stream.replace(@sub_agent,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby">                                partial: &quot;sub_agents/sub_agent&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="251">
            

            
              
            

            <code class="ruby">                                locals: { sub_agent: @sub_agent }),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="252">
            

            
              
            

            <code class="ruby">            turbo_stream.update(&quot;document_content&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby">                               partial: &quot;documents/content&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="254">
            

            
              
            

            <code class="ruby">                               locals: { document: @document })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="255">
            

            
              
            

            <code class="ruby">          ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="258">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="259">
            

            
              
            

            <code class="ruby">      respond_to do |format|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="260">
            

            
              
            

            <code class="ruby">        format.html {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="261">
            

            
              
            

            <code class="ruby">          redirect_to document_sub_agent_path(@document, @sub_agent),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="262">
            

            
              
            

            <code class="ruby">          alert: &quot;Failed to merge sub-agent content.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="263">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="264">
            

            
              
            

            <code class="ruby">        format.json {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="265">
            

            
              
            

            <code class="ruby">          render json: { error: &quot;Failed to merge content&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">          status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="267">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="268">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="271">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="272">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="274">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="275">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    @document = Document.find(params[:document_id])</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="276">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    authorize @document, :show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="278">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="279">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def set_sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="280">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    @sub_agent = @document.sub_agents.find(params[:id])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="281">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="282">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="283">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sub_agent_params</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="284">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    params.require(:sub_agent).permit(:agent_type, :name, :metadata)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="285">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="287">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def agent_json(agent, include_messages: false)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">    json = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="289">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      id: agent.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">      name: agent.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="291">
            

            
              
            

            <code class="ruby">      agent_type: agent.agent_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">      agent_type_label: agent.agent_type_label,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="293">
            

            
              
            

            <code class="ruby">      status: agent.status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby">      status_badge_color: agent.status_badge_color,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">      external_id: agent.external_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">      metadata: agent.metadata,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">      user: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby">        id: agent.user.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="299">
            

            
              
            

            <code class="ruby">        name: agent.user.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="301">
            

            
              
            

            <code class="ruby">      document: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby">        id: agent.document.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">        title: agent.document.title</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">      },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">      message_count: agent.message_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">      created_at: agent.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="307">
            

            
              
            

            <code class="ruby">      updated_at: agent.updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="309">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="310">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    if include_messages</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="311">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      json[:recent_messages] = agent.recent_messages.map do |message|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="313">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          id: message.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">          role: message.role,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="315">
            

            
              
            

            <code class="ruby">          content: message.content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">          created_at: message.created_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="317">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="321">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="323">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="cf8c00c065354e7edaf4304862decb9de847b6ad">
  <div class="header">
    <h3>app/controllers/users_controller.rb</h3>
    <h4>
      <span class="red">
  0.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>28</b> relevant lines.
      <span class="green"><b>0</b> lines covered</span> and
      <span class="red"><b>28</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="1">
            

            
              
            

            <code class="ruby">class UsersController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="2">
            

            
              
            

            <code class="ruby">  allow_unauthenticated_access only: %i[ new create confirm_email ]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="3">
            

            
              
            

            <code class="ruby">  layout &quot;authentication&quot;, only: %i[ new create ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="5">
            

            
              
            

            <code class="ruby">  def new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="6">
            

            
              
            

            <code class="ruby">    @user = User.new</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">  def create</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">    @user = User.new(user_params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="12">
            

            
              
            

            <code class="ruby">    if @user.save</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="13">
            

            
              
            

            <code class="ruby">      @user.send_confirmation_email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="14">
            

            
              
            

            <code class="ruby">      redirect_to new_session_path, notice: &quot;Welcome! Please check your email to confirm your account.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">      render :new, status: :unprocessable_entity</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="17">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="20">
            

            
              
            

            <code class="ruby">  def confirm_email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="21">
            

            
              
            

            <code class="ruby">    if user = User.find_by_email_confirmation_token(params[:token])</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="22">
            

            
              
            

            <code class="ruby">      user.confirm_email!</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="23">
            

            
              
            

            <code class="ruby">      redirect_to new_session_path, notice: &quot;Your email has been confirmed! You can now sign in.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="24">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">      redirect_to new_session_path, alert: &quot;Invalid or expired confirmation link.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="26">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="29">
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">  def user_params</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="32">
            

            
              
            

            <code class="ruby">    params.require(:user).permit(:name, :email_address, :password, :password_confirmation, :role)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="34">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="46f40025f2d1a3d953973a74f0b57230cf0ef9db">
  <div class="header">
    <h3>app/controllers/welcome_controller.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>3</b> relevant lines.
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">class WelcomeController &lt; ApplicationController</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  allow_unauthenticated_access only: [ :index ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="4">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def index</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="298241307ed5132a76fd4bf970864ba298d08175">
  <div class="header">
    <h3>app/helpers/application_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>16</b> relevant lines.
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>12</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module ApplicationHelper</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def format_date(date)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="61" data-linenumber="3">
            
              <span class="hits">61</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 60 times">
                  else: 60
                </span>
              
            

            <code class="ruby">    return &quot;&quot; if date.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="60" data-linenumber="5">
            
              <span class="hits">60</span>
            

            
              
                <span class="hits" title="then branch hit 55 times">
                  then: 55
                </span>
              
            

            <code class="ruby">    if date.today?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="6">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">      &quot;Today at #{date.strftime(&#39;%l:%M %p&#39;).strip}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="7">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    elsif date.yesterday?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="8">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">      &quot;Yesterday at #{date.strftime(&#39;%l:%M %p&#39;).strip}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="9">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    elsif date &gt;= 7.days.ago</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="10">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      date.strftime(&quot;%A at %l:%M %p&quot;).strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="12">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      date.strftime(&quot;%B %d, %Y&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def truncate_content(content, length = 100)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="52" data-linenumber="17">
            
              <span class="hits">52</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 49 times">
                  else: 49
                </span>
              
            

            <code class="ruby">    return &quot;&quot; if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    # Handle both plain text and rich text content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="20">
            
              <span class="hits">49</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    plain_text = if content.respond_to?(:to_plain_text)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="21">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">                   content.to_plain_text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
                <span class="hits" title="else branch hit 48 times">
                  else: 48
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="48" data-linenumber="23">
            
              <span class="hits">48</span>
            

            
              
            

            <code class="ruby">                   content.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="26">
            
              <span class="hits">49</span>
            

            
              
            

            <code class="ruby">    plain_text.truncate(length, separator: &quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="148c2fad3751cf16725df6b6f3a484309449ae90">
  <div class="header">
    <h3>app/helpers/context_items_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>41</b> relevant lines.
      <span class="green"><b>41</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>23</b> total branches, </span>
          <span class="green"><b>23</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module ContextItemsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">  # Renders a context item preview modal component</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # @param context_item [ContextItem] the context item to preview</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # @param options [Hash] additional options for customization</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # @return [String] rendered HTML for the preview modal</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="9">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def context_item_preview_modal(context_item, options = {}, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="10">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="12">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    component = ContextItemPreviewComponent.new(context_item: context_item)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="14">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if block_given?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="15">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render(component, &amp;block)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="17">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      render(component)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  # Creates a button that opens a context item preview modal</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  # @param context_item [ContextItem] the context item to preview</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  # @param text [String] button text (optional)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  # @param options [Hash] additional HTML options for the button</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  # @return [String] rendered HTML for the trigger button</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="27">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def context_item_preview_button(context_item, text: nil, **options)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="28">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="else branch hit 8 times">
                  else: 8
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="30">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    text ||= &quot;Preview #{context_item.title.truncate(30)}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="32">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    default_options = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      type: &quot;button&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      class: &quot;inline-flex items-center px-3 py-2 border border-gray-300 shadow-sm text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      data: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        action: &quot;click-&gt;context-sidebar#showPreview&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        context_item_id: context_item.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="41">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    button_tag(text, **default_options.merge(options))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  # Renders a compact context item card with preview capability</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  # @param context_item [ContextItem] the context item to display</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  # @param options [Hash] additional options for customization</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  # @return [String] rendered HTML for the context item card</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def context_item_card(context_item, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="50">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="52">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    content_tag :div,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      class: &quot;bg-white overflow-hidden shadow rounded-lg border border-gray-200 hover:shadow-md transition-shadow duration-200 #{options[:class]}&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="54">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      content_tag :div, class: &quot;px-4 py-5 sm:p-6&quot; do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="55">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        content_tag(:div, class: &quot;flex items-start justify-between&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="56">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">          content_tag(:div, class: &quot;flex-1 min-w-0&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">            # Title and type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="58">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">            content_tag(:div, class: &quot;flex items-center space-x-2 mb-2&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="59">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">              content_tag(:h3, context_item.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">                class: &quot;text-sm font-medium text-gray-900 truncate&quot;) +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">              content_tag(:span, context_item.item_type.capitalize,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">                class: &quot;inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium #{item_type_badge_classes(context_item.item_type)}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">            end +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">            # Content preview</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">            content_tag(:p, truncate(strip_tags(context_item.content), length: 100),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">              class: &quot;text-sm text-gray-500 mb-3&quot;) +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">            # Timestamp</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">            content_tag(:p, &quot;#{time_ago_in_words(context_item.created_at)} ago&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">              class: &quot;text-xs text-gray-400&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">          end +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          # Preview button</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">          content_tag(:div, class: &quot;ml-4 flex-shrink-0&quot;) do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="77">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">            context_item_preview_button(context_item,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">              text: content_tag(:svg,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">                content_tag(:path, &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">                  d: &quot;M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">                  stroke: &quot;currentColor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">                  fill: &quot;none&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">                  &quot;stroke-width&quot;: &quot;1.5&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">                ) +</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">                content_tag(:path, &quot;&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">                  d: &quot;M15 12a3 3 0 11-6 0 3 3 0 016 0z&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">                  stroke: &quot;currentColor&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">                  fill: &quot;none&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">                  &quot;stroke-width&quot;: &quot;1.5&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">                ),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">                xmlns: &quot;http://www.w3.org/2000/svg&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">                class: &quot;h-4 w-4&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">                fill: &quot;none&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">                viewBox: &quot;0 0 24 24&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">              ),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">              class: &quot;text-gray-400 hover:text-gray-600 p-1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">            )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  # Returns the appropriate CSS classes for item type badges</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  # @param item_type [String] the type of context item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  # @return [String] CSS classes for the badge</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def item_type_badge_classes(item_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="109">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    case item_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
                <span class="hits" title="when branch hit 5 times">
                  when: 5
                </span>
              
            

            <code class="ruby">    when &quot;snippet&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="111">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      &quot;bg-blue-100 text-blue-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;draft&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="113">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;bg-yellow-100 text-yellow-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;version&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="115">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;bg-green-100 text-green-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="117">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;bg-gray-100 text-gray-800&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">  # Detects and returns a user-friendly content type description</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">  # @param context_item [ContextItem] the context item to analyze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">  # @return [String] human-readable content type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def context_item_content_type(context_item)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="126">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return &quot;Unknown&quot; unless context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="128">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    component = ContextItemPreviewComponent.new(context_item: context_item)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="130">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    case component.send(:detect_content_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when :markdown</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="132">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Markdown&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when :code</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="134">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      language = component.code_language</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="135">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      language ? &quot;#{language.capitalize} Code&quot; : &quot;Code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="137">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;Text&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">  # Renders syntax highlighting indicator for code content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">  #</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">  # @param context_item [ContextItem] the context item to check</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">  # @return [String] HTML for language indicator or empty string</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="145">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  def syntax_language_indicator(context_item)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="146">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return &quot;&quot; unless context_item</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="148">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    component = ContextItemPreviewComponent.new(context_item: context_item)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="150">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if component.send(:detect_content_type) == :code &amp;&amp; component.code_language</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="151">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      content_tag(:span, component.code_language.upcase,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">        class: &quot;inline-flex items-center px-2 py-1 rounded text-xs font-mono font-medium bg-gray-100 text-gray-800&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="154">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="ce9a466bae444d81c433d3ccbd420ebd203665ba">
  <div class="header">
    <h3>app/helpers/documents_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module DocumentsHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c1c0f0687a2737a2cd8ea3ce563c041d3dd54630">
  <div class="header">
    <h3>app/helpers/users_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module UsersHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="17dd9072bc5a60001be68d54c77859e78c75f4ca">
  <div class="header">
    <h3>app/helpers/welcome_helper.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>1</b> relevant lines.
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module WelcomeHelper</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="11802d3c53048302530fec92f70140e9d9ed5adc">
  <div class="header">
    <h3>app/jobs/claude_interaction_job.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>58</b> relevant lines.
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>9</b> total branches, </span>
          <span class="green"><b>9</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Background job for async Claude AI interactions</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="2">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">class ClaudeInteractionJob &lt; ApplicationJob</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="3">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Retry configuration for API failures</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  retry_on Anthropic::Error, wait: :polynomially_longer, attempts: 3</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="7">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  retry_on ClaudeService::ApiError, wait: :polynomially_longer, attempts: 3</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Rate limiting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="10">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  MAX_REQUESTS_PER_MINUTE = 50</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="12">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def perform(session_id, action, params = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="13">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    Rails.logger.info &quot;ClaudeInteractionJob: Processing #{action} for session #{session_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # Rate limiting check</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="16">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    check_rate_limit!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="18">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    case action</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
                <span class="hits" title="when branch hit 3 times">
                  when: 3
                </span>
              
            

            <code class="ruby">    when &quot;send_message&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      process_message(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;create_sub_agent&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="22">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      create_sub_agent(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;compress_context&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      compress_context(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;generate_completion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      generate_completion(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="28">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Unknown action: #{action}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise ArgumentError, &quot;Unknown action: #{action}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="32">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    handle_error(session_id, action, e)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="33">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    raise</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="36">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="38">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def process_message(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="39">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    service = ClaudeService.new(session_id: session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="41">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    result = service.send_message(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      params[:content],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      context: params[:context] || {},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      system_prompt: params[:system_prompt]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    # Notify any listeners (e.g., ActionCable channels)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    notify_completion(session_id, &quot;message_processed&quot;, result)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="50">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="53">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def create_sub_agent(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    service = ClaudeService.new(session_id: session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="56">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent = service.create_sub_agent(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      params[:name],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">      initial_context: params[:initial_context] || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">    # Store sub-agent info</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    session = ClaudeSession.find_or_create_by(session_id: session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    session.metadata[&quot;sub_agents&quot;] ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="64">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    session.metadata[&quot;sub_agents&quot;] &lt;&lt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      name: params[:name],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      created_at: Time.current,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      session_id: sub_agent.instance_variable_get(:@session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="69">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    session.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    notify_completion(session_id, &quot;sub_agent_created&quot;, { name: params[:name] })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="74">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def compress_context(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    max_tokens = params[:max_tokens] || 50_000</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    # Compress context for the session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    ClaudeContext.compress_context(session_id, max_tokens: max_tokens)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    # Get updated token count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="81">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    total_tokens = ClaudeContext.total_tokens_for_session(session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    notify_completion(session_id, &quot;context_compressed&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      total_tokens: total_tokens,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      max_tokens: max_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="89">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def generate_completion(session_id, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    service = ClaudeService.new(session_id: session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">    # Build context from recent messages</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="93">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    recent_messages = ClaudeMessage.by_session(session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">                                  .recent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">                                  .limit(params[:context_size] || 10)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="96">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">                                  .map { |msg| { role: msg.role, content: msg.content } }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">                                  .reverse</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    result = service.send_message(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      params[:prompt],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      context: { previous_messages: recent_messages },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      system_prompt: params[:system_prompt]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="105">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    notify_completion(session_id, &quot;completion_generated&quot;, result)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="107">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="110">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def check_rate_limit!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">    # Simple rate limiting using Rails cache</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="112">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    cache_key = &quot;claude_rate_limit:#{Time.current.to_i / 60}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="113">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    count = Rails.cache.increment(cache_key, 1, expires_in: 1.minute)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="115">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 7 times">
                  else: 7
                </span>
              
            

            <code class="ruby">    if count &amp;&amp; count &gt; MAX_REQUESTS_PER_MINUTE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise StandardError, &quot;Rate limit exceeded. Please try again later.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="120">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def notify_completion(session_id, event, data)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">    # This would integrate with ActionCable or other notification system</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    # For now, just log the completion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="123">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    Rails.logger.info &quot;ClaudeInteractionJob completed: #{event} for session #{session_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">    # Example ActionCable broadcast (uncomment when ActionCable is set up):</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">    # ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">    #   &quot;claude_session_#{session_id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">    #   { event: event, data: data }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">    # )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="132">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  def handle_error(session_id, action, error)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="133">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    Rails.logger.error &quot;ClaudeInteractionJob error: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="134">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    Rails.logger.error error.backtrace.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">    # Store error in session metadata</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="137">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    session = ClaudeSession.find_by(session_id: session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="138">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    if session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="139">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      session.metadata[&quot;last_error&quot;] = {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">        action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">        error: error.message,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">        occurred_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      session.save</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    # Notify about the error</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="148">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    notify_completion(session_id, &quot;error_occurred&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">      action: action,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">      error: error.message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2d682f6c98c08a07fe7846522e021f1700000c90">
  <div class="header">
    <h3>app/jobs/cloud_file_import_job.rb</h3>
    <h4>
      <span class="green">
  94.59%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  63.64%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>74</b> relevant lines.
      <span class="green"><b>70</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>22</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>8</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">require_relative &quot;../services/cloud_services/base_service&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudFileImportJob &lt; ApplicationJob</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  discard_on CloudServices::AuthenticationError, CloudServices::AuthorizationError</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="7">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def self.discard_on</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="8">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    [ CloudServices::AuthenticationError, CloudServices::AuthorizationError ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="11">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def perform(cloud_file, user)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="19" data-linenumber="12">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="else branch hit 19 times">
                  else: 19
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    return unless cloud_file.importable?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      # Broadcast import started</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="16">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        &quot;cloud_import_#{user.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">          type: &quot;import_started&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">          file_id: cloud_file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">          file_name: cloud_file.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="25">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      service = cloud_service_for(cloud_file.cloud_integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      # Import file content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="28">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">      file_data = service.import_file(cloud_file.file_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      # Create document from imported content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="31">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      title = file_data[:title] || file_data[:name] || cloud_file.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      # Ensure unique title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="34">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      sanitized_title = sanitize_title(title)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="35">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">      if user.documents.exists?(title: sanitized_title)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        timestamp = Time.current.strftime(&quot;%Y%m%d_%H%M%S&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        sanitized_title = &quot;#{sanitized_title} (#{timestamp})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="40">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      document = user.documents.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        title: sanitized_title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">        description: &quot;Imported from #{cloud_file.cloud_integration.provider_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      # Set content based on file type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="46">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      content_type = file_data[:content_type] || file_data[:mime_type] || &quot;text/plain&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="47">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      content = process_content(file_data[:content], content_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">      # Ensure content is not blank</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="50">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 13 times">
                  else: 13
                </span>
              
            

            <code class="ruby">      if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        content = &quot;&lt;p&gt;Document imported from #{cloud_file.name}&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="54">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      document.content = content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      # Add import tag if method exists</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="57">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if document.respond_to?(:add_tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="58">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        document.add_tag(&quot;imported-#{cloud_file.cloud_integration.provider}&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="59">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        document.add_tag(&quot;cloud-import&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="62">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      ActiveRecord::Base.transaction do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="63">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">        document.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        # Link cloud file to document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="65">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        cloud_file.update!(document: document)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">        # Broadcast import completed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="68">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">          &quot;cloud_import_#{user.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">            type: &quot;import_completed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">            file_id: cloud_file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">            file_name: cloud_file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">            document_id: document.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="78">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">        Rails.logger.info &quot;Successfully imported #{cloud_file.name} as document #{document.id} for user #{user.id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">    rescue CloudServices::AuthenticationError, CloudServices::AuthorizationError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      # Broadcast auth failure</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="83">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        &quot;cloud_import_#{user.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">          type: &quot;import_failed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">          file_id: cloud_file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">          file_name: cloud_file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">          error: e.message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Import error for cloud file #{cloud_file.id}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      # Don&#39;t retry auth errors - they&#39;re discarded</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    rescue CloudServices::ApiError, CloudServices::NotFoundError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">      # Handle service errors without re-raising</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="96">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">        &quot;cloud_import_#{user.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">          type: &quot;import_failed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">          file_id: cloud_file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">          file_name: cloud_file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">          error: e.message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="105">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Import error for cloud file #{cloud_file.id}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">      # Don&#39;t re-raise service errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">    rescue ActiveRecord::RecordInvalid =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">      # Handle database validation errors</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="109">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">        &quot;cloud_import_#{user.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">          type: &quot;import_failed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">          file_id: cloud_file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">          file_name: cloud_file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">          error: e.message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="118">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Import error for cloud file #{cloud_file.id}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">      # Broadcast generic failure and re-raise for retry</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="121">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      ActionCable.server.broadcast(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">        &quot;cloud_import_#{user.id}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">          type: &quot;import_failed&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">          file_id: cloud_file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">          file_name: cloud_file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">          error: e.message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="130">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Import error for cloud file #{cloud_file.id}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="131">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      raise e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="135">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="137">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def cloud_service_for(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="138">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    case integration.provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
                <span class="hits" title="when branch hit 17 times">
                  when: 17
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="140">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      CloudServices::GoogleDriveService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="142">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::DropboxService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="144">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::NotionService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="145">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="146">
            

            
              
            

            <code class="ruby">      raise &quot;Unknown provider: #{integration.provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="150">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def sanitize_title(title)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">    # Handle nil or empty title</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="152">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    return &quot;Imported Document&quot; if title.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">    # Remove file extension and clean up title</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="155">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    title = File.basename(title, File.extname(title))</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="156">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    title = title.gsub(/[^\w\s\-_]/, &quot;&quot;).strip</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="14" data-linenumber="157">
            
              <span class="hits">14</span>
            

            
              
                <span class="hits" title="then branch hit 14 times">
                  then: 14
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    title.present? ? title : &quot;Imported Document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="160">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def process_content(raw_content, mime_type)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="161">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    case mime_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">    when &quot;text/plain&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
                <span class="hits" title="when branch hit 12 times">
                  when: 12
                </span>
              
            

            <code class="ruby">      # Convert plain text to basic HTML paragraphs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="164">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">      paragraphs = raw_content.split(/\n\s*\n/).map(&amp;:strip).reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="165">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">      paragraphs.map { |p| &quot;&lt;p&gt;#{CGI.escapeHTML(p)}&lt;/p&gt;&quot; }.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">    when &quot;text/html&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      # Clean up HTML content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="169">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      clean_html(raw_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">    when &quot;text/markdown&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      # Convert Markdown to HTML (basic implementation)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="173">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      markdown_to_html(raw_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">    when &quot;application/pdf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">      # For PDF, we&#39;d need a gem like pdf-reader</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="177">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      # For now, just indicate it&#39;s a PDF</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="178">
            

            
              
            

            <code class="ruby">      &quot;&lt;p&gt;&lt;strong&gt;PDF Import:&lt;/strong&gt; #{CGI.escapeHTML(raw_content.truncate(500))}&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">    when &quot;application/vnd.google-apps.document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="181">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      # Google Docs are exported as HTML</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="182">
            

            
              
            

            <code class="ruby">      clean_html(raw_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="185">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      # Default: treat as plain text</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            

            
              
            

            <code class="ruby">      &quot;&lt;p&gt;#{CGI.escapeHTML(raw_content.truncate(5000))}&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="190">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def clean_html(html_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">    # Remove script tags and clean up HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">    # In a real app, you&#39;d want to use a proper HTML sanitizer like Sanitize</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="193">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    cleaned = html_content.gsub(/&lt;script[^&gt;]*&gt;.*?&lt;\/script&gt;/mi, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="194">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    cleaned = cleaned.gsub(/&lt;style[^&gt;]*&gt;.*?&lt;\/style&gt;/mi, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">    # Remove Google Docs specific styling that might break our layout</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="197">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    cleaned = cleaned.gsub(/style\s*=\s*[&quot;&#39;][^&quot;&#39;]*[&quot;&#39;]/i, &quot;&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="199">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    cleaned</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="202">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def markdown_to_html(markdown_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">    # Basic Markdown to HTML conversion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">    # In a real app, you&#39;d use a gem like redcarpet or kramdown</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="205">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html = markdown_content.dup</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">    # Headers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="208">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html.gsub!(/^### (.+)$/, &#39;&lt;h3&gt;\1&lt;/h3&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="209">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html.gsub!(/^## (.+)$/, &#39;&lt;h2&gt;\1&lt;/h2&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="210">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html.gsub!(/^# (.+)$/, &#39;&lt;h1&gt;\1&lt;/h1&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">    # Bold and italic</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="213">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html.gsub!(/\*\*(.+?)\*\*/, &#39;&lt;strong&gt;\1&lt;/strong&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="214">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    html.gsub!(/\*(.+?)\*/, &#39;&lt;em&gt;\1&lt;/em&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="215">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby">    # Paragraphs</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="217">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    paragraphs = html.split(/\n\s*\n/).map(&amp;:strip).reject(&amp;:blank?)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="218">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    paragraphs.map { |p| &quot;&lt;p&gt;#{p}&lt;/p&gt;&quot; }.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="219">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="220">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="9f4dd05c24e4000df241d01d9b7eacccc61013da">
  <div class="header">
    <h3>app/jobs/cloud_file_sync_job.rb</h3>
    <h4>
      <span class="green">
  94.74%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  83.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>19</b> relevant lines.
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>5</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class CloudFileSyncJob &lt; ApplicationJob</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  queue_as :default</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def perform(cloud_integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="5">
            
              <span class="hits">19</span>
            

            
              
                <span class="hits" title="else branch hit 18 times">
                  else: 18
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless cloud_integration.active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="8">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      service = cloud_service_for(cloud_integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="17" data-linenumber="9">
            
              <span class="hits">17</span>
            

            
              
            

            <code class="ruby">      synced_count = service.sync_files</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="11">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      Rails.logger.info &quot;Synced #{synced_count} files for #{cloud_integration.provider} integration (User: #{cloud_integration.user.email_address})&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      # Update integration settings with last sync time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="14">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      cloud_integration.set_setting(&quot;last_sync_at&quot;, Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="15">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      cloud_integration.save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    rescue CloudServices::AuthenticationError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Authentication error during sync for #{cloud_integration.provider}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      # Could notify user that re-authentication is needed</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="22">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      Rails.logger.error &quot;Sync error for #{cloud_integration.provider}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="23">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      raise e</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="27">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def cloud_service_for(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="30">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">    case integration.provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
                <span class="hits" title="when branch hit 16 times">
                  when: 16
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="32">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">      CloudServices::GoogleDriveService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::DropboxService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      CloudServices::NotionService.new(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="37">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="38">
            

            
              
            

            <code class="ruby">      raise &quot;Unknown provider: #{integration.provider}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="1f796e4b5f54d54763ad50fba18b565a66482909">
  <div class="header">
    <h3>app/mailers/passwords_mailer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="1">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">class PasswordsMailer &lt; ApplicationMailer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="2">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">  def reset(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="3">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="4">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    mail subject: &quot;Reset your password&quot;, to: user.email_address</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="146d601a09491ded86b6aaad770eb1400b8e0fee">
  <div class="header">
    <h3>app/mailers/user_mailer.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="1">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">class UserMailer &lt; ApplicationMailer</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="2">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">  def confirmation(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="3">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="4">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    mail(to: @user.email_address, subject: &quot;Please confirm your email address&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="034a5aa80fb18b74f39bb6c0025409f7fc5eb571">
  <div class="header">
    <h3>app/models/claude_context.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>46</b> relevant lines.
      <span class="green"><b>46</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class ClaudeContext &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Associations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :claude_session, foreign_key: :session_id, primary_key: :session_id, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :session_id, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :context_type, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="8">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :token_count, numericality: { greater_than_or_equal_to: 0 }, allow_nil: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="11">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  after_initialize :set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="12">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_save :calculate_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  # Context types</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  CONTEXT_TYPES = %w[</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="16">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">    code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">    reference</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">    system_prompt</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    user_preference</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    file_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    sub_agent_context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="25">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :context_type, inclusion: { in: CONTEXT_TYPES }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="28">
            
              <span class="hits">26</span>
            

            
              
            

            <code class="ruby">  scope :by_session, -&gt;(session_id) { where(session_id: session_id) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="29">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">  scope :by_type, -&gt;(type) { where(context_type: type) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="30">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :documents, -&gt; { by_type(&quot;document&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="31">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :code_contexts, -&gt; { by_type(&quot;code&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="32">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(updated_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  # Class methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="35">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.total_tokens_for_session(session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="36">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    by_session(session_id).sum(:token_count)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="39">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.compress_context(session_id, max_tokens: 50_000)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    total = total_tokens_for_session(session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="41">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    return unless total &gt; max_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    # Remove oldest contexts until under limit</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="44">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    contexts = by_session(session_id).order(updated_at: :asc)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    removed_tokens = 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="47">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    contexts.find_each do |context|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="48">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">      break if total - removed_tokens &lt;= max_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="50">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      removed_tokens += context.token_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="51">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      context.destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="56">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def document?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    context_type == &quot;document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="60">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def code?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="61">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    context_type == &quot;code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="64">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def add_content(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="65">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.content ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="66">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.content[key] = value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="67">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="70">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def remove_content(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="71">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    self.content ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="72">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    self.content.delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="73">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="76">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def estimated_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="46" data-linenumber="77">
            
              <span class="hits">46</span>
            

            
              
                <span class="hits" title="then branch hit 22 times">
                  then: 22
                </span>
              
                <span class="hits" title="else branch hit 24 times">
                  else: 24
                </span>
              
            

            <code class="ruby">    return 0 if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">    # Simple estimation based on content size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="80">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">    content.to_json.length / 4</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="83">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="85">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="106" data-linenumber="86">
            
              <span class="hits">106</span>
            

            
              
            

            <code class="ruby">    self.content ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="106" data-linenumber="87">
            
              <span class="hits">106</span>
            

            
              
            

            <code class="ruby">    self.token_count ||= 0</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="90">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def calculate_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="91">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    self.token_count = estimated_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0141795328646f5a66fb9fa4c3bc7e9f9b0343e9">
  <div class="header">
    <h3>app/models/claude_message.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>34</b> relevant lines.
      <span class="green"><b>34</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>4</b> total branches, </span>
          <span class="green"><b>3</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class ClaudeMessage &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Associations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :claude_session, foreign_key: :session_id, primary_key: :session_id, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :session_id, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :role, presence: true, inclusion: { in: %w[user assistant system] }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="8">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :content, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="11">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  after_initialize :set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="12">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_save :calculate_token_estimate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="15">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :user_messages, -&gt; { where(role: &quot;user&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="16">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :assistant_messages, -&gt; { where(role: &quot;assistant&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="17">
            
              <span class="hits">16</span>
            

            
              
            

            <code class="ruby">  scope :by_session, -&gt;(session_id) { where(session_id: session_id) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="18">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :by_sub_agent, -&gt;(name) { where(sub_agent_name: name) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="19">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  # Class methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="22">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.conversation_pairs(session_id, limit: 10)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="23">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    messages = by_session(session_id).recent.limit(limit * 2)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="24">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    messages.each_slice(2).select { |pair| pair.size == 2 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="28">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def user?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="29">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">    role == &quot;user&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="32">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def assistant?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="27" data-linenumber="33">
            
              <span class="hits">27</span>
            

            
              
            

            <code class="ruby">    role == &quot;assistant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="36">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def system?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="37">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    role == &quot;system&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="40">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def token_count</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="41">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    message_metadata&amp;.dig(&quot;token_count&quot;) || estimate_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="44">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def formatted_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">    return content unless assistant?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    # Add any formatting logic here for assistant responses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="48">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="51">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="53">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="197" data-linenumber="54">
            
              <span class="hits">197</span>
            

            
              
            

            <code class="ruby">    self.context ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="197" data-linenumber="55">
            
              <span class="hits">197</span>
            

            
              
            

            <code class="ruby">    self.message_metadata ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="58">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def calculate_token_estimate</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">    # Simple token estimation (actual implementation would use tiktoken or similar)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="89" data-linenumber="60">
            
              <span class="hits">89</span>
            

            
              
            

            <code class="ruby">    self.message_metadata[&quot;token_count&quot;] = estimate_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="63">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def estimate_tokens</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">    # Rough estimation: ~4 characters per token</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="91" data-linenumber="65">
            
              <span class="hits">91</span>
            

            
              
            

            <code class="ruby">    (content.length / 4.0).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d6a1a7c90d96046925ea96e792709af8e156b195">
  <div class="header">
    <h3>app/models/claude_session.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  50.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>25</b> relevant lines.
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>1</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class ClaudeSession &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Associations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :claude_messages, foreign_key: :session_id, primary_key: :session_id, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="4">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :claude_contexts, foreign_key: :session_id, primary_key: :session_id, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :session_id, presence: true, uniqueness: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="10">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  after_initialize :set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="13">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :active, -&gt; { where(&quot;updated_at &gt; ?&quot;, 24.hours.ago) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="14">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :with_messages, -&gt; { joins(:claude_messages).distinct }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="17">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def add_context(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="18">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.context ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="19">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.context[key] = value</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="20">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="23">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def remove_context(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    self.context ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    self.context.delete(key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    save!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="29">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def message_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="30">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    claude_messages.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="33">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def last_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    claude_messages.order(created_at: :desc).first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="37">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def total_tokens_used</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="7" data-linenumber="38">
            
              <span class="hits">7</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    claude_messages.sum { |msg| msg.message_metadata&amp;.dig(&quot;usage&quot;, &quot;total_tokens&quot;) || 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="41">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="43">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="44">
            
              <span class="hits">87</span>
            

            
              
            

            <code class="ruby">    self.context ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="87" data-linenumber="45">
            
              <span class="hits">87</span>
            

            
              
            

            <code class="ruby">    self.metadata ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="f247494b799178d822e6f4b54c00f6e041ad6d71">
  <div class="header">
    <h3>app/models/cloud_file.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>46</b> relevant lines.
      <span class="green"><b>46</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class CloudFile &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :cloud_integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_one :user, through: :cloud_integration</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Optional association to Document if imported</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :document, optional: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # Serialize metadata as JSON for SQLite compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="9">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  serialize :metadata, coder: JSON, type: Hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="11">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :provider, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="12">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :file_id, presence: true, uniqueness: { scope: :cloud_integration_id }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="13">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :name, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="16">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="17">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">  scope :synced, -&gt; { where.not(last_synced_at: nil) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="18">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :by_provider, -&gt;(provider) { where(provider: provider) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="19">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :importable, -&gt; { where(mime_type: IMPORTABLE_MIME_TYPES) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  # Supported file types for import</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  IMPORTABLE_MIME_TYPES = [</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="23">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    &quot;text/plain&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">    &quot;text/html&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    &quot;text/markdown&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    &quot;application/pdf&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    &quot;application/vnd.google-apps.document&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">    &quot;application/msword&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  # Check if file can be imported as a document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="33">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def importable?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="370" data-linenumber="34">
            
              <span class="hits">370</span>
            

            
              
            

            <code class="ruby">    IMPORTABLE_MIME_TYPES.include?(mime_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  # Human-readable file size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="38">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def human_size</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="62" data-linenumber="39">
            
              <span class="hits">62</span>
            

            
              
                <span class="hits" title="then branch hit 7 times">
                  then: 7
                </span>
              
                <span class="hits" title="else branch hit 55 times">
                  else: 55
                </span>
              
            

            <code class="ruby">    return &quot;Unknown&quot; if size.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="55" data-linenumber="41">
            
              <span class="hits">55</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    if size &lt; 1024</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 54 times">
                  else: 54
                </span>
              
            

            <code class="ruby">      &quot;#{size} B&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="54" data-linenumber="43">
            
              <span class="hits">54</span>
            

            
              
                <span class="hits" title="then branch hit 51 times">
                  then: 51
                </span>
              
            

            <code class="ruby">    elsif size &lt; 1_048_576</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="44">
            
              <span class="hits">51</span>
            

            
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      &quot;#{(size / 1024.0).round(1)} KB&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="45">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    elsif size &lt; 1_073_741_824</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;#{(size / 1_048_576.0).round(1)} MB&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;#{(size / 1_073_741_824.0).round(1)} GB&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  # File type helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="53">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def google_doc?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="106" data-linenumber="54">
            
              <span class="hits">106</span>
            

            
              
            

            <code class="ruby">    mime_type == &quot;application/vnd.google-apps.document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="57">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def pdf?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="104" data-linenumber="58">
            
              <span class="hits">104</span>
            

            
              
            

            <code class="ruby">    mime_type == &quot;application/pdf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="61">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def text?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="105" data-linenumber="62">
            
              <span class="hits">105</span>
            

            
              
                <span class="hits" title="then branch hit 104 times">
                  then: 104
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    mime_type&amp;.start_with?(&quot;text/&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="65">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def word_doc?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="66">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    mime_type.in?([</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      &quot;application/msword&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    ])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  # Metadata helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="73">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def get_metadata(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="74">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    metadata&amp;.dig(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="77">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_metadata(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="78">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.metadata ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="79">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.metadata[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">  # Sync status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="83">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def synced?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="228" data-linenumber="84">
            
              <span class="hits">228</span>
            

            
              
            

            <code class="ruby">    last_synced_at.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="87">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def sync_needed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="88">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    !synced? || last_synced_at &lt; 1.hour.ago</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  # Provider-specific file URL (for display purposes)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="92">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def provider_url</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="105" data-linenumber="93">
            
              <span class="hits">105</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
                <span class="hits" title="when branch hit 102 times">
                  when: 102
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="102" data-linenumber="95">
            
              <span class="hits">102</span>
            

            
              
            

            <code class="ruby">      &quot;https://drive.google.com/file/d/#{file_id}/view&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;https://www.dropbox.com/home?preview=#{file_id}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">      # Notion URLs are stored in metadata</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="100">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      get_metadata(&quot;url&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d3a7c68d63f0ce32c4d5a35fd88e7e69e9be8eeb">
  <div class="header">
    <h3>app/models/cloud_integration.rb</h3>
    <h4>
      <span class="green">
  97.3%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  75.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>37</b> relevant lines.
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>8</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class CloudIntegration &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :cloud_files, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Serialize settings as JSON for SQLite compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  serialize :settings, coder: JSON, type: Hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # Encryption for tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="9">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  encrypts :access_token</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="10">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  encrypts :refresh_token</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  # Supported providers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="13">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  PROVIDERS = %w[google_drive dropbox notion].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="15">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :provider, presence: true, inclusion: { in: PROVIDERS }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="16">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :access_token, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="17">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :user_id, uniqueness: { scope: :provider, message: &quot;already has an integration for this provider&quot; }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="20">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :active, -&gt; { where(&quot;expires_at IS NULL OR expires_at &gt; ?&quot;, Time.current) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="21">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :expired, -&gt; { where(&quot;expires_at &lt;= ?&quot;, Time.current) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="22">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :for_provider, -&gt;(provider) { where(provider: provider) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">  # Check if the integration is active</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="25">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def active?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="231" data-linenumber="26">
            
              <span class="hits">231</span>
            

            
              
            

            <code class="ruby">    expires_at.nil? || expires_at &gt; Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="29">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def expired?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="69" data-linenumber="30">
            
              <span class="hits">69</span>
            

            
              
            

            <code class="ruby">    !active?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  # Token refresh logic will be handled by service objects</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="34">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def needs_refresh?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="47" data-linenumber="35">
            
              <span class="hits">47</span>
            

            
              
                <span class="hits" title="then branch hit 24 times">
                  then: 24
                </span>
              
                <span class="hits" title="else branch hit 23 times">
                  else: 23
                </span>
              
            

            <code class="ruby">    return false if expires_at.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="23" data-linenumber="36">
            
              <span class="hits">23</span>
            

            
              
            

            <code class="ruby">    expires_at &lt;= 1.hour.from_now</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  # Settings helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="40">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def get_setting(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="9" data-linenumber="41">
            
              <span class="hits">9</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    settings&amp;.dig(key.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="44">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_setting(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="45">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    self.settings ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="46">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    self.settings[key.to_s] = value</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  # Provider-specific helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="50">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def google_drive?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="51">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    provider == &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="54">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def dropbox?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="55">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    provider == &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="58">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def notion?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="59">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    provider == &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  # Display name for the provider</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="63">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def provider_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="194" data-linenumber="64">
            
              <span class="hits">194</span>
            

            
              
            

            <code class="ruby">    case provider</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
                <span class="hits" title="when branch hit 190 times">
                  when: 190
                </span>
              
            

            <code class="ruby">    when &quot;google_drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="190" data-linenumber="66">
            
              <span class="hits">190</span>
            

            
              
            

            <code class="ruby">      &quot;Google Drive&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="68">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;Dropbox&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="70">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      &quot;Notion&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="71">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="72">
            

            
              
            

            <code class="ruby">      provider.humanize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="e2b0015ebb717c359bcd97bd1a7e64196cc44205">
  <div class="header">
    <h3>app/models/context_item.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  94.44%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>54</b> relevant lines.
      <span class="green"><b>54</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>18</b> total branches, </span>
          <span class="green"><b>17</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class ContextItem &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="5">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :content, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :item_type, presence: true, inclusion: { in: %w[snippet draft version] }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :title, presence: true, length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Callbacks to maintain search content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="10">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_save :update_search_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="12">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">  scope :snippets, -&gt; { where(item_type: &quot;snippet&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="13">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">  scope :drafts, -&gt; { where(item_type: &quot;draft&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="14">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">  scope :versions, -&gt; { where(item_type: &quot;version&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="15">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="16">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :ordered, -&gt; { order(position: :asc, created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  # Search scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="19">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  scope :search, -&gt;(query) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="81" data-linenumber="20">
            
              <span class="hits">81</span>
            

            
              
                <span class="hits" title="then branch hit 50 times">
                  then: 50
                </span>
              
                <span class="hits" title="else branch hit 31 times">
                  else: 31
                </span>
              
            

            <code class="ruby">    return all if query.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    # SQLite-compatible search using LIKE</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="23">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    sanitized_query = &quot;%#{sanitize_sql_like(query.downcase)}%&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="24">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    where(&quot;LOWER(search_content) LIKE ?&quot;, sanitized_query)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="27">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  scope :by_type, -&gt;(type) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="79" data-linenumber="28">
            
              <span class="hits">79</span>
            

            
              
                <span class="hits" title="then branch hit 68 times">
                  then: 68
                </span>
              
                <span class="hits" title="else branch hit 11 times">
                  else: 11
                </span>
              
            

            <code class="ruby">    return all if type.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="29">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    where(item_type: type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="32">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  scope :by_date_range, -&gt;(start_date, end_date) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="77" data-linenumber="33">
            
              <span class="hits">77</span>
            

            
              
                <span class="hits" title="then branch hit 67 times">
                  then: 67
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    return all if start_date.blank? &amp;&amp; end_date.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="35">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    scope = all</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 9 times">
                  then: 9
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    scope = scope.where(&quot;created_at &gt;= ?&quot;, start_date) if start_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="37">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    scope = scope.where(&quot;created_at &lt;= ?&quot;, end_date) if end_date.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="38">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  # Combined search with filters</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="42">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  scope :filtered_search, -&gt;(query: nil, item_type: nil, date_from: nil, date_to: nil) {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="73" data-linenumber="43">
            
              <span class="hits">73</span>
            

            
              
            

            <code class="ruby">    search(query)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      .by_type(item_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      .by_date_range(date_from, date_to)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">  # Search result methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="49">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.search_with_highlights(query)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="50">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return [] if query.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="52">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    results = search(query).includes(:document, :user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    # Add highlights to results</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="55">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    results.map do |item|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="57">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        item: item,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">        highlights: item.search_highlights(query)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="63">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def search_highlights(query)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="16" data-linenumber="64">
            
              <span class="hits">16</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 14 times">
                  else: 14
                </span>
              
            

            <code class="ruby">    return {} if query.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">    # Simple highlighting for SQLite</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="67">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    highlighted_title = highlight_text(title, query)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="68">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">    highlighted_content = highlight_text(content, query, max_length: 200)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="14" data-linenumber="71">
            
              <span class="hits">14</span>
            

            
              
            

            <code class="ruby">      title: highlighted_title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">      content: highlighted_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  # Simple text highlighting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="77">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def highlight_text(text, query, max_length: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="34" data-linenumber="78">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 34 times">
                  else: 34
                </span>
              
            

            <code class="ruby">    return text if query.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    # Truncate if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="81">
            
              <span class="hits">34</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 33 times">
                  else: 33
                </span>
              
            

            <code class="ruby">    text = text.truncate(max_length) if max_length &amp;&amp; text.length &gt; max_length</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">    # Case-insensitive highlighting</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="34" data-linenumber="84">
            
              <span class="hits">34</span>
            

            
              
            

            <code class="ruby">    text.gsub(/(#{Regexp.escape(query)})/i, &#39;&lt;mark&gt;\1&lt;/mark&gt;&#39;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="87">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_create :set_position</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="89">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def snippet?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="90">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    item_type == &quot;snippet&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="93">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def draft?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="94">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    item_type == &quot;draft&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="97">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def version?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="98">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    item_type == &quot;version&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="101">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="103">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_position</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="141" data-linenumber="104">
            
              <span class="hits">141</span>
            

            
              
            

            <code class="ruby">    max_position = document.context_items.where(item_type: item_type).maximum(:position) || 0</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="141" data-linenumber="105">
            
              <span class="hits">141</span>
            

            
              
            

            <code class="ruby">    self.position = max_position + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="108">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def update_search_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="187" data-linenumber="109">
            
              <span class="hits">187</span>
            

            
              
            

            <code class="ruby">    self.search_content = &quot;#{title} #{content} #{item_type}&quot;.downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="55fac10793d5593b05efd25be44023da23f0496b">
  <div class="header">
    <h3>app/models/current.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>4</b> relevant lines.
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class Current &lt; ActiveSupport::CurrentAttributes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attribute :session, :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="262" data-linenumber="5">
            
              <span class="hits">262</span>
            

            
              
                <span class="hits" title="then branch hit 257 times">
                  then: 257
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    session&amp;.user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="a1eb5483be4b4001589984bc5a3f19dbb93515aa">
  <div class="header">
    <h3>app/models/document.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  81.25%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>60</b> relevant lines.
      <span class="green"><b>60</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>13</b> branches covered</span> and
          <span class="red"><b>3</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class Document &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :context_items, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="4">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :document_versions, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="5">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :sub_agents, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  # Rich text association for content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="8">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_rich_text :content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">  # Serialize tags as JSON for SQLite compatibility</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="11">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  serialize :tags, coder: JSON, type: Array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="13">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :title, presence: true, length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="14">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :content, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="15">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :description, length: { maximum: 1000 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  # Scopes for common queries</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="18">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="19">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :by_user, -&gt;(user) { where(user: user) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="20">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :with_tag, -&gt;(tag) { where(&quot;tags LIKE ?&quot;, &quot;%#{tag}%&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  # Ensure tags is always an array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="23">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_save :ensure_tags_array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  # Helper methods for tags</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="26">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def add_tag(tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="27">
            
              <span class="hits">31</span>
            

            
              
            

            <code class="ruby">    self.tags ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="31" data-linenumber="28">
            
              <span class="hits">31</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 30 times">
                  then: 30
                </span>
              
            

            <code class="ruby">    self.tags &lt;&lt; tag unless self.tags.include?(tag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="31">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def remove_tag(tag)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="32">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.tags ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="33">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    self.tags.delete(tag)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="36">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def tag_list</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="5" data-linenumber="37">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 5 times">
                  then: 5
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    tags&amp;.join(&quot;, &quot;) || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="40">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def tag_list=(tag_string)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="41">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">    return self.tags = [] if tag_string.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="42">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    self.tags = tag_string.split(&quot;,&quot;).map(&amp;:strip).reject(&amp;:blank?).uniq</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  # Content manipulation methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="46">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def word_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    # Count words in rich text content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="28" data-linenumber="48">
            
              <span class="hits">28</span>
            

            
              
            

            <code class="ruby">    content.to_plain_text.split(/\s+/).size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="51">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def reading_time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    # Average reading speed is 200-250 words per minute</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="53">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    (word_count / 200.0).ceil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="56">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def excerpt(length = 150)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="57">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return &quot;&quot; if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="58">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    content.to_plain_text.truncate(length, separator: &quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  # Duplicate document for a user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="62">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def duplicate_for(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="63">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_document = user.documents.build(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">      title: &quot;#{title} (Copy)&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">      description: description,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">      tags: tags</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">    # Duplicate the rich text content</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="70">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if content.present?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="71">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      new_document.content = content.to_plain_text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="74">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">  # Version management methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="78">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def next_version_number</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="79">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    current_version_number.to_i + 1</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="82">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def latest_version</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="19" data-linenumber="83">
            
              <span class="hits">19</span>
            

            
              
            

            <code class="ruby">    document_versions.order(:version_number).last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="86">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def version_at(version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="87">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    document_versions.find_by(version_number: version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="90">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def create_version(user, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="91">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    DocumentVersion.create_from_document(self, user, options)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="94">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def create_auto_version(user)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="95">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    create_version(user, is_auto_version: true)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="98">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def create_manual_version(user, version_name: nil, version_notes: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="99">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    create_version(user, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">      is_auto_version: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      version_name: version_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      version_notes: version_notes</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">    })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  # Check if document content has changed since last version</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="107">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def content_changed_since_last_version?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="108">
            
              <span class="hits">12</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    return true if document_versions.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="110">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    latest = latest_version</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="10" data-linenumber="111">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">    return true if latest.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="113">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    content.to_plain_text != latest.content_snapshot ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      title != latest.title ||</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      description != latest.description_snapshot ||</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="116">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      (tags || []).sort != (latest.tags_snapshot || []).sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  # Track version metadata</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="120">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def version_info</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="122">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      current_version: current_version_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">      total_versions: document_versions.count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      latest_version_created: latest_version&amp;.created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      created: created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      updated: updated_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      word_count: word_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="131">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="133">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def ensure_tags_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="109" data-linenumber="134">
            
              <span class="hits">109</span>
            

            
              
            

            <code class="ruby">    self.tags ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="0f2edfdd6864454a1e6f442482823bd5bd0659c0">
  <div class="header">
    <h3>app/models/document_version.rb</h3>
    <h4>
      <span class="green">
  93.02%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  83.33%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>43</b> relevant lines.
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>12</b> total branches, </span>
          <span class="green"><b>10</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class DocumentVersion &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :created_by_user, class_name: &quot;User&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # JSON column handles serialization automatically in Rails 8</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :version_number, presence: true, uniqueness: { scope: :document_id }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="8">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :title, presence: true, length: { maximum: 255 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="9">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :content_snapshot, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="10">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :word_count, presence: true, numericality: { greater_than_or_equal_to: 0 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  # Scopes for filtering</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="13">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :auto_versions, -&gt; { where(is_auto_version: true) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="14">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :manual_versions, -&gt; { where(is_auto_version: false) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="15">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="16">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :by_document, -&gt;(document) { where(document: document) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="17">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  scope :by_version_number, -&gt; { order(:version_number) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # Ensure tags_snapshot is always an array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="20">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_save :ensure_tags_snapshot_array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  # Class method to create version from document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="23">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.create_from_document(document, user, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="24">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    version = new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">      document: document,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">      version_number: document.next_version_number,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">      title: document.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      content_snapshot: document.content.to_plain_text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      description_snapshot: document.description,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      tags_snapshot: document.tags || [],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">      version_name: options[:version_name],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      version_notes: options[:version_notes],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      created_by_user: user,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      is_auto_version: options[:is_auto_version] || false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">      word_count: document.word_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="8" data-linenumber="38">
            
              <span class="hits">8</span>
            

            
              
                <span class="hits" title="then branch hit 8 times">
                  then: 8
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if version.save</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="39">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">      document.update(current_version_number: version.version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="42">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    version</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  # Content comparison methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="46">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def content_changed_from_previous?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    previous_version = document.document_versions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">                              .where(&quot;version_number &lt; ?&quot;, version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">                              .order(:version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">                              .last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="52">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return true if previous_version.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="54">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    content_snapshot != previous_version.content_snapshot</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="57">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def content_diff_from_previous</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="58">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    previous_version = document.document_versions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">                              .where(&quot;version_number &lt; ?&quot;, version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">                              .order(:version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">                              .last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="63">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return nil if previous_version.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="66">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      previous_content: previous_version.content_snapshot,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">      current_content: content_snapshot,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">      previous_word_count: previous_version.word_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">      current_word_count: word_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      word_count_diff: word_count - previous_version.word_count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="74">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def tags_changed_from_previous?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="75">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    previous_version = document.document_versions</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">                              .where(&quot;version_number &lt; ?&quot;, version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">                              .order(:version_number)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">                              .last</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="80">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return true if previous_version.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="82">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    tags_snapshot.sort != previous_version.tags_snapshot.sort</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  # Helper methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="86">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def version_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="87">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    is_auto_version? ? &quot;Auto&quot; : &quot;Manual&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="90">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def display_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="91">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    version_name.present? ? version_name : &quot;Version #{version_number}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="94">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def short_content_preview(length = 100)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            

            
              
            

            <code class="ruby">    content_snapshot.truncate(length, separator: &quot; &quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  # JSON serialization for API responses</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="99">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def as_json(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">    super(options.merge(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      methods: [ :version_type, :display_name ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">      except: [ :content_snapshot ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">      include: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">        created_by_user: { only: [ :id, :name, :email_address ] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">    ))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="109">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def to_json_with_content(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            

            
              
            

            <code class="ruby">    as_json(options.merge(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">      methods: [ :version_type, :display_name, :short_content_preview ],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      include: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">        created_by_user: { only: [ :id, :name, :email_address ] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">    ))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="118">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="120">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def ensure_tags_snapshot_array</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="121">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">    self.tags_snapshot ||= []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="046d7a50e945f59c90c42c0b485356f369da096b">
  <div class="header">
    <h3>app/models/identity.rb</h3>
    <h4>
      <span class="red">
  55.56%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>9</b> relevant lines.
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>4</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class Identity &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="4">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :provider, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="5">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :uid, presence: true, uniqueness: { scope: :provider }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.find_or_create_from_auth(auth)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="8">
            

            
              
            

            <code class="ruby">    identity = find_or_initialize_by(provider: auth.provider, uid: auth.uid)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">    identity.email = auth.info.email</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">    identity.name = auth.info.name</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">    identity</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="74f115f9844b516ec62d50719d135eedc1cadbcf">
  <div class="header">
    <h3>app/models/session.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>2</b> relevant lines.
      <span class="green"><b>2</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class Session &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="494b0aceb82b6972ebd60455c121582ccfa02279">
  <div class="header">
    <h3>app/models/sub_agent.rb</h3>
    <h4>
      <span class="yellow">
  88.89%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  80.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>90</b> relevant lines.
      <span class="green"><b>80</b> lines covered</span> and
      <span class="red"><b>10</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>20</b> total branches, </span>
          <span class="green"><b>16</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class SubAgent &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby">  # Associations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="4">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="5">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :messages, class_name: &quot;SubAgentMessage&quot;, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :claude_messages, foreign_key: :sub_agent_name, primary_key: :name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="9">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :name, presence: true, length: { maximum: 100 }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="10">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :agent_type, presence: true, inclusion: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    in: %w[ruby-rails-expert javascript-package-expert tailwind-css-expert</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">           test-runner-fixer error-debugger project-orchestrator git-auto-commit custom]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="14">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :status, presence: true, inclusion: { in: %w[active idle completed] }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="17">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">  scope :active, -&gt; { where(status: &quot;active&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="18">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :idle, -&gt; { where(status: &quot;idle&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="24" data-linenumber="19">
            
              <span class="hits">24</span>
            

            
              
            

            <code class="ruby">  scope :completed, -&gt; { where(status: &quot;completed&quot;) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="30" data-linenumber="20">
            
              <span class="hits">30</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="21">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :by_user, -&gt;(user) { where(user: user) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="22">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">  scope :by_document, -&gt;(document) { where(document: document) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="13" data-linenumber="23">
            
              <span class="hits">13</span>
            

            
              
            

            <code class="ruby">  scope :by_agent_type, -&gt;(type) { where(agent_type: type) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="26">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  after_initialize :set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="27">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_save :ensure_context_hash</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  # Status state machine methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="30">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="31">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    update!(status: &quot;active&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="34">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def deactivate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="35">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update!(status: &quot;idle&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="38">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def complete!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="39">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    update!(status: &quot;completed&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="42">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def pause!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    # Since we don&#39;t have a &#39;paused&#39; status, we&#39;ll set it to idle</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="44">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    update!(status: &quot;idle&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">  # Status checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="48">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def active?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="109" data-linenumber="49">
            
              <span class="hits">109</span>
            

            
              
            

            <code class="ruby">    status == &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="52">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def idle?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="53">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    status == &quot;idle&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="56">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def completed?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="57">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    status == &quot;completed&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  # Agent type checks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="61">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def backend_agent?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="62">
            

            
              
            

            <code class="ruby">    agent_type == &quot;ruby-rails-expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="65">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def frontend_agent?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">    %w[javascript-package-expert tailwind-css-expert].include?(agent_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="69">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def quality_agent?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="70">
            

            
              
            

            <code class="ruby">    %w[test-runner-fixer error-debugger].include?(agent_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="73">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def coordination_agent?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="74">
            

            
              
            

            <code class="ruby">    %w[project-orchestrator git-auto-commit].include?(agent_type)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">  # Message management</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="78">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def message_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="79">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">    messages.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="82">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def last_message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="83">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    messages.recent.first</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="86">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def has_conversation?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="87">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return true if messages.empty? # No messages means ready for conversation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="88">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    messages.by_role(&quot;user&quot;).exists? &amp;&amp; messages.by_role(&quot;assistant&quot;).exists?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="91">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def recent_messages(limit: 10)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="92">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    messages.recent.limit(limit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">  # Context management</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="96">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def update_context(new_context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="97">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    update!(context: new_context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="100">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def merge_context(additional_context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="101">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    update!(context: (context || {}).merge(additional_context))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="104">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def clear_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="105">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update!(context: {})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">  # Summary and export</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="109">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="111">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      id: id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">      name: name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      agent_type: agent_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby">      status: status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      message_count: message_count,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      last_message: last_message&amp;.content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">      created_at: created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">      updated_at: updated_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="120">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="122">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def export_conversation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="124">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      agent_name: name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      agent_type: agent_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">      status: status,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      context: context,</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="128">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      messages: messages.map { |m| { role: m.role, content: m.content, timestamp: m.created_at } },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">      exported_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">  # Metadata helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="134">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def add_metadata(key, value)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="135">
            

            
              
            

            <code class="ruby">    update!(metadata: metadata.merge(key =&gt; value))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="138">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def get_metadata(key)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            

            
              
            

            <code class="ruby">    metadata[key]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">  # Display helpers</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="143">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def display_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="12" data-linenumber="144">
            
              <span class="hits">12</span>
            

            
              
            

            <code class="ruby">    &quot;#{agent_type_label} - #{name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="147">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def agent_type_label</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="162" data-linenumber="148">
            
              <span class="hits">162</span>
            

            
              
                <span class="hits" title="when branch hit 103 times">
                  when: 103
                </span>
              
            

            <code class="ruby">    case agent_type</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="103" data-linenumber="149">
            
              <span class="hits">103</span>
            

            
              
                <span class="hits" title="when branch hit 26 times">
                  when: 26
                </span>
              
            

            <code class="ruby">    when &quot;ruby-rails-expert&quot; then &quot;Rails/Ruby Expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="26" data-linenumber="150">
            
              <span class="hits">26</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;javascript-package-expert&quot; then &quot;JavaScript Expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="151">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 25 times">
                  when: 25
                </span>
              
            

            <code class="ruby">    when &quot;tailwind-css-expert&quot; then &quot;Tailwind CSS Expert&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="25" data-linenumber="152">
            
              <span class="hits">25</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;test-runner-fixer&quot; then &quot;Test Runner&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="153">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;error-debugger&quot; then &quot;Error Debugger&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="154">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="when branch hit 2 times">
                  when: 2
                </span>
              
            

            <code class="ruby">    when &quot;project-orchestrator&quot; then &quot;Project Orchestrator&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="155">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    when &quot;git-auto-commit&quot; then &quot;Git Auto-Commit&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            
              
            

            <code class="ruby">    else agent_type.humanize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="160">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def status_badge_color</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="57" data-linenumber="161">
            
              <span class="hits">57</span>
            

            
              
                <span class="hits" title="when branch hit 49 times">
                  when: 49
                </span>
              
            

            <code class="ruby">    case status</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="49" data-linenumber="162">
            
              <span class="hits">49</span>
            

            
              
                <span class="hits" title="when branch hit 4 times">
                  when: 4
                </span>
              
            

            <code class="ruby">    when &quot;active&quot; then &quot;green&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="4" data-linenumber="163">
            
              <span class="hits">4</span>
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;completed&quot; then &quot;blue&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="164">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;failed&quot; then &quot;red&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="165">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">    when &quot;paused&quot; then &quot;yellow&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            

            
              
                <span class="hits" title="else branch hit 4 times">
                  else: 4
                </span>
              
            

            <code class="ruby">    when &quot;pending&quot; then &quot;gray&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="167">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    else &quot;gray&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="171">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="173">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def set_defaults</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="469" data-linenumber="174">
            
              <span class="hits">469</span>
            

            
              
            

            <code class="ruby">    self.metadata ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="469" data-linenumber="175">
            
              <span class="hits">469</span>
            

            
              
            

            <code class="ruby">    self.context ||= {}</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="469" data-linenumber="176">
            
              <span class="hits">469</span>
            

            
              
            

            <code class="ruby">    self.status ||= &quot;active&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="179">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def ensure_context_hash</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="113" data-linenumber="180">
            
              <span class="hits">113</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 111 times">
                  else: 111
                </span>
              
            

            <code class="ruby">    self.context = {} if context.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="091d018c57e564910ac4993725f73fe7cca94575">
  <div class="header">
    <h3>app/models/sub_agent_message.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>26</b> relevant lines.
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class SubAgentMessage &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  belongs_to :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby">  # Validations</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :role, presence: true, inclusion: { in: %w[user assistant system] }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :content, presence: true, length: { maximum: 100_000 }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Scopes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="10">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">  scope :by_role, -&gt;(role) { where(role: role) }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="11">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">  scope :recent, -&gt; { order(created_at: :desc) }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  # Callbacks</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="14">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  before_validation :strip_content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">  # Instance methods</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="17">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def user_message?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="18">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    role == &quot;user&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="21">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def assistant_message?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="22">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    role == &quot;assistant&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="25">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def system_message?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="26">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    role == &quot;system&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="29">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def word_count</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="30">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    content.to_s.split.size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="33">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def truncate_content(max_length = 100)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="34">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">    return content if content.length &lt;= max_length</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    &quot;#{content[0...max_length]}...&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="38">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def formatted_for_display</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="40">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      id: id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">      role: role,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">      content: content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">      created_at: created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">      user_name: user.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="48">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def export</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="50">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      role: role,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      content: content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      timestamp: created_at,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      user: user.name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="57">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="59">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def strip_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="143" data-linenumber="60">
            
              <span class="hits">143</span>
            

            
              
            

            <code class="ruby">    self.content = content.to_s.strip</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="8f31e0dd08a399d5e262d7187972ada946e410cb">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  50.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>32</b> relevant lines.
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>1</b> branches covered</span> and
          <span class="red"><b>1</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="1">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">class User &lt; ApplicationRecord</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="2">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_secure_password</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="3">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :sessions, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="4">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :documents, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="5">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :identities, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="6">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :context_items, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="7">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :sub_agents, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="8">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  has_many :cloud_integrations, dependent: :destroy</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="10">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  enum :role, { user: &quot;user&quot;, editor: &quot;editor&quot;, admin: &quot;admin&quot; }, default: :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="12">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :name, presence: true</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="13">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :email_address, presence: true, uniqueness: { case_sensitive: false }, format: { with: URI::MailTo::EMAIL_REGEXP }</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="14">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  validates :role, inclusion: { in: roles.keys }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="507" data-linenumber="16">
            
              <span class="hits">507</span>
            

            
              
            

            <code class="ruby">  normalizes :email_address, with: -&gt;(e) { e.strip.downcase }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  # Rails 8 authentication token support</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="19">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  generates_token_for :password_reset, expires_in: 2.hours do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="20">
            
              <span class="hits">38</span>
            

            
              
            

            <code class="ruby">    password_salt</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="23">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  generates_token_for :email_confirmation, expires_in: 24.hours do</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="29" data-linenumber="24">
            
              <span class="hits">29</span>
            

            
              
            

            <code class="ruby">    email_address</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="27">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.find_by_password_reset_token(token)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="28">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    find_by_token_for(:password_reset, token)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="31">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.find_by_password_reset_token!(token)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="32">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    find_by_token_for!(:password_reset, token)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="35">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.find_by_email_confirmation_token(token)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="36">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    find_by_token_for(:email_confirmation, token)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="39">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def self.find_by_email_confirmation_token!(token)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="40">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    find_by_token_for!(:email_confirmation, token)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="43">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def confirm_email!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="44">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update!(email_confirmed: true, email_confirmed_at: Time.current)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="47">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def send_confirmation_email</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="48">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    UserMailer.confirmation(self).deliver_later</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="51">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="53">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">  def password_salt</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="38" data-linenumber="54">
            
              <span class="hits">38</span>
            

            
              
                <span class="hits" title="then branch hit 38 times">
                  then: 38
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    password_digest&amp;.last(10)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="04d664c6b250f4ceb1543a7dd094fabc8b2281ca">
  <div class="header">
    <h3>app/policies/application_policy.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>27</b> relevant lines.
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># frozen_string_literal: true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="2">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ApplicationPolicy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :user, :record</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(user, record)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="7">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="8">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">    @record = record</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="11">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="12">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="15">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="16">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="20">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="23">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="24">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    create?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="27">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="28">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="31">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def edit?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="32">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="35">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="39">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  class Scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def initialize(user, scope)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="41">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="42">
            
              <span class="hits">18</span>
            

            
              
            

            <code class="ruby">      @scope = scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="45">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def resolve</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise NoMethodError, &quot;You must define #resolve in #{self.class}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="49">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="51">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    attr_reader :user, :scope</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="288d62f2a7c5e48d17e085fc93101503f4461083">
  <div class="header">
    <h3>app/policies/context_item_policy.rb</h3>
    <h4>
      <span class="green">
  100.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>14</b> relevant lines.
      <span class="green"><b>14</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class ContextItemPolicy &lt; ApplicationPolicy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  class Scope &lt; ApplicationPolicy::Scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def resolve</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">      # Users can only see context items belonging to their documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="5">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      scope.joins(:document).where(documents: { user_id: user.id })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # User must own the document to view its context items</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="11">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # User must own the context item (through its document)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="16">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    # User must own the document to create context items for it</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="21">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    record.document.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="24">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    # User must own the context item to update it</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="26">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # User must own the context item to destroy it</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="31">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="b150ecee3a5557ba72077e50e07ca704a8ca886c">
  <div class="header">
    <h3>app/policies/document_policy.rb</h3>
    <h4>
      <span class="green">
  96.77%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>31</b> relevant lines.
      <span class="green"><b>30</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>2</b> total branches, </span>
          <span class="green"><b>2</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class DocumentPolicy &lt; ApplicationPolicy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :user, :document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(user, document)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="82" data-linenumber="5">
            
              <span class="hits">82</span>
            

            
              
            

            <code class="ruby">    @user = user</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="82" data-linenumber="6">
            
              <span class="hits">82</span>
            

            
              
            

            <code class="ruby">    @document = document</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="13">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    # Users can see their own documents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # Admins can see all documents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    # Editors can see all documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="71" data-linenumber="17">
            
              <span class="hits">71</span>
            

            
              
            

            <code class="ruby">    owner? || admin? || editor?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="20">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    # All authenticated users can create documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="22">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    user.present?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="25">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def new?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="26">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    create?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # Users can update their own documents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">    # Admins can update all documents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    # Editors can update all documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="33">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">    owner? || admin? || editor?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def edit?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="37">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="40">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">    # Users can destroy their own documents</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    # Admins can destroy all documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="43">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    owner? || admin?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="46">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  class Scope &lt; ApplicationPolicy::Scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="47">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def resolve</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="48">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      if user.admin? || user.editor?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
            

            <code class="ruby">        # Admins and editors can see all documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="50">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        scope.all</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">        # Regular users can only see their own documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="53">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        scope.where(user: user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="58">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="60">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def owner?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="88" data-linenumber="61">
            
              <span class="hits">88</span>
            

            
              
            

            <code class="ruby">    user.present? &amp;&amp; document.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="64">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def admin?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="22" data-linenumber="65">
            
              <span class="hits">22</span>
            

            
              
            

            <code class="ruby">    user.present? &amp;&amp; user.admin?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="68">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def editor?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="69">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">    user.present? &amp;&amp; user.editor?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="4cd7e23bc5c50bd2ef364b6ff90a7a488a5e4a85">
  <div class="header">
    <h3>app/policies/sub_agent_policy.rb</h3>
    <h4>
      <span class="green">
  95.0%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>20</b> relevant lines.
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>0</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SubAgentPolicy &lt; ApplicationPolicy</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  class Scope &lt; ApplicationPolicy::Scope</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="3">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def resolve</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby">      # Users can only see sub_agents belonging to their documents</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="5">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      scope.joins(:document).where(documents: { user_id: user.id })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def index?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # Checked at document level in controller</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="11">
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="14">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def show?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # User must own the sub_agent (through its document)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="16">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id || record.document.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="19">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def create?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    # User must own the document to create sub_agents for it</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="21">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    record.document.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="24">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    # User must own the sub_agent or the document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="21" data-linenumber="26">
            
              <span class="hits">21</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id || record.document.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def destroy?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">    # User must own the sub_agent or the document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="31">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    record.user_id == user.id || record.document.user_id == user.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="34">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def activate?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="35">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="38">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def complete?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="39">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="42">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def pause?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="43">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    update?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="c462efa6723942ffd0dd9f5bba5bc334edab43ee">
  <div class="header">
    <h3>app/services/claude_service.rb</h3>
    <h4>
      <span class="green">
  96.92%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  68.75%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>65</b> relevant lines.
      <span class="green"><b>63</b> lines covered</span> and
      <span class="red"><b>2</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>11</b> branches covered</span> and
          <span class="red"><b>5</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="never" data-hits="" data-linenumber="1">
            

            
              
            

            <code class="ruby"># Service class for interacting with Claude AI via Anthropic SDK</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="2">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">class ClaudeService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="3">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  class ApiError &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="4">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  class ConfigurationError &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="5">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="6">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  MAX_CONTEXT_TOKENS = 100_000 # Claude&#39;s context window limit</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="8">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def initialize(session_id: nil, sub_agent_name: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="9">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    @session_id = session_id || SecureRandom.uuid</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="10">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    @sub_agent_name = sub_agent_name</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="11">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    @client = create_client</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="12">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">    @context_manager = ContextManager.new(@session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">  # Send a message to Claude with optional context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="16">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def send_message(content, context: {}, system_prompt: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="17">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">    raise ConfigurationError, &quot;Anthropic client not configured&quot; unless @client</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="19">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    messages = build_messages(content, context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">    begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="22">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      response = @client.messages(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        model: Rails.application.config.anthropic[:model],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">        max_tokens: Rails.application.config.anthropic[:max_tokens],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">        temperature: Rails.application.config.anthropic[:temperature],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        system: system_prompt || default_system_prompt,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        messages: messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby">      # Store the interaction</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="31">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">      store_interaction(content, response.content.first.text, context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">      # Return structured response</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="35">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">        response: response.content.first.text,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">        usage: response.usage,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        session_id: @session_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        sub_agent: @sub_agent_name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    rescue Anthropic::Error =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="41">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      raise ApiError, &quot;Claude API error: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  # Create a sub-agent for isolated context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="46">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def create_sub_agent(name, initial_context: {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent_id = &quot;#{@session_id}:#{name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    # Initialize sub-agent with its own context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="50">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent = self.class.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      session_id: sub_agent_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      sub_agent_name: name</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby">    # Set initial context if provided</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="2" data-linenumber="56">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    if initial_context.any?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="57">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      sub_agent.set_context(initial_context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="60">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  # Set or update context for the session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="64">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def set_context(context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="65">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    @context_manager.set_context(context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">  # Get current context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="69">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def get_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="70">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    @context_manager.get_context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  # Clear context for the session</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="74">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def clear_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @context_manager.clear_context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">  # Get conversation history</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="79">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def conversation_history(limit: 10)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="80">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    ClaudeMessage.where(session_id: @session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">                 .order(created_at: :desc)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">                 .limit(limit)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">  # Stream a response (returns an enumerator)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="86">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def stream_message(content, context: {}, system_prompt: nil)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">    raise ConfigurationError, &quot;Anthropic client not configured&quot; unless @client</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    messages = build_messages(content, context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    Enumerator.new do |yielder|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="92">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      @client.messages(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        model: Rails.application.config.anthropic[:model],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">        max_tokens: Rails.application.config.anthropic[:max_tokens],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">        temperature: Rails.application.config.anthropic[:temperature],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">        system: system_prompt || default_system_prompt,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">        messages: messages,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">        stream: proc do |chunk|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            

            
              
            

            <code class="ruby">          yielder &lt;&lt; chunk</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="105">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="107">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def create_client</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="38" data-linenumber="108">
            
              <span class="hits">38</span>
            

            
              
                <span class="hits" title="then branch hit 38 times">
                  then: 38
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">    api_key = Rails.application.config.anthropic&amp;.dig(:api_key)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="38" data-linenumber="109">
            
              <span class="hits">38</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 37 times">
                  else: 37
                </span>
              
            

            <code class="ruby">    return nil if api_key.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="37" data-linenumber="111">
            
              <span class="hits">37</span>
            

            
              
            

            <code class="ruby">    Anthropic::Client.new(access_token: api_key)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="114">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def default_system_prompt</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="115">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">    &quot;You are Claude, an AI assistant created by Anthropic to be helpful, harmless, and honest. &quot; \</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    &quot;You are part of Claude Code for Creators, a creative writing platform.&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="119">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def build_messages(content, context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="120">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    messages = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">    # Add context messages if available</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="123">
            
              <span class="hits">10</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">    if context[:previous_messages]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="124">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      messages.concat(context[:previous_messages])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">    # Add the current message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="128">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    messages &lt;&lt; { role: &quot;user&quot;, content: content }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="130">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    messages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="133">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  def store_interaction(user_content, assistant_response, context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="134">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    ClaudeMessage.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">      session_id: @session_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      sub_agent_name: @sub_agent_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      role: &quot;user&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      content: user_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">      context: context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="7" data-linenumber="142">
            
              <span class="hits">7</span>
            

            
              
            

            <code class="ruby">    ClaudeMessage.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">      session_id: @session_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">      sub_agent_name: @sub_agent_name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">      role: &quot;assistant&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">      content: assistant_response,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">      context: {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            
              
            

            <code class="ruby">    Rails.logger.error &quot;Failed to store Claude interaction: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">  # Internal context manager</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="154">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">  class ContextManager</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="155">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    def initialize(session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="43" data-linenumber="156">
            
              <span class="hits">43</span>
            

            
              
            

            <code class="ruby">      @session_id = session_id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="159">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    def set_context(context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="160">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      session = ClaudeSession.find_or_create_by(session_id: @session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="9" data-linenumber="161">
            
              <span class="hits">9</span>
            

            
              
            

            <code class="ruby">      session.update!(context: session.context.merge(context))</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="164">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    def get_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="165">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">      session = ClaudeSession.find_by(session_id: @session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="6" data-linenumber="166">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 6 times">
                  then: 6
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      session&amp;.context || {}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="169">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">    def clear_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="170">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      session = ClaudeSession.find_by(session_id: @session_id)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="171">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      session&amp;.update!(context: {})</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="2b560731d0e2360c0fea28ebc1c08a7fe670213d">
  <div class="header">
    <h3>app/services/cloud_services/base_service.rb</h3>
    <h4>
      <span class="green">
  98.28%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="yellow">
  87.5%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>58</b> relevant lines.
      <span class="green"><b>57</b> lines covered</span> and
      <span class="red"><b>1</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>16</b> total branches, </span>
          <span class="green"><b>14</b> branches covered</span> and
          <span class="red"><b>2</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="1">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">module CloudServices</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="2">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class BaseService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="3">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    attr_reader :integration, :user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="4">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="5">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def initialize(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="6">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      @integration = integration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="36" data-linenumber="7">
            
              <span class="hits">36</span>
            

            
              
            

            <code class="ruby">      @user = integration.user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="10">
            

            
              
            

            <code class="ruby">    # Common OAuth2 configuration</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="11">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def oauth2_client</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="12">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise NotImplementedError, &quot;Subclasses must implement oauth2_client&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # Refresh access token if needed</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="16">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def refresh_token!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="17">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      return unless integration.needs_refresh?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="20">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">        response = oauth2_refresh_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="22">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        integration.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">          access_token: response[&quot;access_token&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">          refresh_token: response[&quot;refresh_token&quot;] || integration.refresh_token,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">          expires_at: calculate_expiry(response[&quot;expires_in&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="28">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        Rails.logger.error &quot;Failed to refresh token for #{integration.provider}: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="31">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    # List files from the cloud service</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="36">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def list_files(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="37">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise NotImplementedError, &quot;Subclasses must implement list_files&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">    # Import a file from cloud service</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="41">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def import_file(file_id)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="42">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise NotImplementedError, &quot;Subclasses must implement import_file&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    # Export a document to cloud service</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="46">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def export_document(document, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="47">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      raise NotImplementedError, &quot;Subclasses must implement export_document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    # Sync files metadata</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="51">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def sync_files</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="52">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 3 times">
                  then: 3
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      refresh_token! if integration.needs_refresh?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="54">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      result = list_files</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="3" data-linenumber="55">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">      files = result.is_a?(Hash) ? result[:files] : result</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="57">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      files.each do |file_data|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="58">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        cloud_file = integration.cloud_files.find_or_initialize_by(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">          file_id: file_data[:id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="62">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        cloud_file.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">          provider: integration.provider,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">          name: file_data[:name],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">          mime_type: file_data[:mime_type],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">          size: file_data[:size],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">          metadata: file_data[:metadata] || {},</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">          last_synced_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="72">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      integration.cloud_files.synced.count</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="75">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    protected</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">    # Build callback URL with proper host and protocol</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="78">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def self.build_callback_url(path)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="79">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      options = Rails.application.config.action_mailer.default_url_options</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="80">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 10 times">
                  else: 10
                </span>
              
            

            <code class="ruby">      protocol = Rails.env.production? ? &quot;https&quot; : &quot;http&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="81">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      host = options[:host]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="82">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      port = options[:port]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="84">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      url = &quot;#{protocol}://#{host}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="85">
            
              <span class="hits">11</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 9 times">
                  else: 9
                </span>
              
            

            <code class="ruby">      url += &quot;:#{port}&quot; if port &amp;&amp; port != 80 &amp;&amp; port != 443</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="86">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      url += path</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="11" data-linenumber="87">
            
              <span class="hits">11</span>
            

            
              
            

            <code class="ruby">      url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby">    # Calculate token expiry time</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="91">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def calculate_expiry(expires_in)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="92">
            
              <span class="hits">6</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 5 times">
                  else: 5
                </span>
              
            

            <code class="ruby">      return nil if expires_in.nil?</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="93">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      Time.current + expires_in.seconds</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">    # Common error handling</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="97">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def handle_api_error(error)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="98">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      case error</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when Net::HTTPUnauthorized</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="100">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise AuthenticationError, &quot;Invalid or expired credentials&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when Net::HTTPForbidden</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="102">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise AuthorizationError, &quot;Access denied&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when Net::HTTPNotFound</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise NotFoundError, &quot;Resource not found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="106">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise ApiError, &quot;API request failed: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">    # Parse response body</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="111">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def parse_response(response)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="112">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">    rescue JSON::ParserError</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="114">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      response.body</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="117">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="119">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    def oauth2_refresh_request</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            

            
              
            

            <code class="ruby">      raise NotImplementedError, &quot;Subclasses must implement oauth2_refresh_request&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">  # Custom error classes</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class ApiError &lt; StandardError; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="126">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class AuthenticationError &lt; ApiError; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="127">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class AuthorizationError &lt; ApiError; end</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="128">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">  class NotFoundError &lt; ApiError; end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="d7326628ecfcc07fd1c3e1f6dce5521fc4f4f7de">
  <div class="header">
    <h3>app/services/cloud_services/dropbox_service.rb</h3>
    <h4>
      <span class="red">
  24.59%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>61</b> relevant lines.
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>46</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>21</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>21</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="1">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">module CloudServices</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="2">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">  class DropboxService &lt; BaseService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="3">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    BASE_URL = &quot;https://api.dropboxapi.com/2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="4">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    CONTENT_URL = &quot;https://content.dropboxapi.com/2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="5">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    OAUTH_URL = &quot;https://www.dropbox.com/oauth2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="6">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">    # OAuth2 configuration for Dropbox</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="8">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def self.oauth2_config</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">        client_id: Rails.application.credentials.dig(:dropbox, :client_id),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">        client_secret: Rails.application.credentials.dig(:dropbox, :client_secret),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby">        redirect_uri: build_callback_url(&quot;/cloud_integrations/dropbox/callback&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="16">
            

            
              
            

            <code class="ruby">    # Generate OAuth2 authorization URL</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="17">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def self.authorization_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">      params = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="19">
            

            
              
            

            <code class="ruby">        client_id: oauth2_config[:client_id],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        redirect_uri: oauth2_config[:redirect_uri],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">        response_type: &quot;code&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        token_access_type: &quot;offline&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">      &quot;#{OAUTH_URL}/authorize?#{params.to_query}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">    # Exchange authorization code for tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="29">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def self.exchange_code(code)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="30">
            

            
              
            

            <code class="ruby">      response = HTTParty.post(&quot;#{BASE_URL.sub(&#39;/2&#39;, &#39;&#39;)}/oauth2/token&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby">        body: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">          code: code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">          client_id: oauth2_config[:client_id],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">          client_secret: oauth2_config[:client_secret],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">          redirect_uri: oauth2_config[:redirect_uri],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby">          grant_type: &quot;authorization_code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="40">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      raise ApiError, &quot;Failed to exchange code: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="42">
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">    # List files from Dropbox</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="46">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def list_files(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="47">
            

            
              
            

            <code class="ruby">      path = options[:path] || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="48">
            

            
              
            

            <code class="ruby">      cursor = options[:cursor]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="51">
            

            
              
            

            <code class="ruby">        if cursor</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="52">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          # Continue from cursor</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="53">
            

            
              
            

            <code class="ruby">          response = api_request(&quot;/files/list_folder/continue&quot;, { cursor: cursor })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="55">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          # Initial request</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="56">
            

            
              
            

            <code class="ruby">          response = api_request(&quot;/files/list_folder&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">            path: path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby">            recursive: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">            include_deleted: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">            include_has_explicit_shared_members: false,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">            include_mounted_folders: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">            limit: 100</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">          })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">        files = response[&quot;entries&quot;].select { |e| e[&quot;.tag&quot;] == &quot;file&quot; }.map do |file|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="68">
            

            
              
            

            <code class="ruby">            id: file[&quot;id&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">            name: file[&quot;name&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">            mime_type: mime_type_from_path(file[&quot;name&quot;]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">            size: file[&quot;size&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">            metadata: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">              path_lower: file[&quot;path_lower&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">              path_display: file[&quot;path_display&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">              rev: file[&quot;rev&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">              server_modified: file[&quot;server_modified&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="82">
            

            
              
            

            <code class="ruby">          files: files,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">          cursor: response[&quot;cursor&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">          has_more: response[&quot;has_more&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="87">
            

            
              
            

            <code class="ruby">        handle_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="90">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">    # Import a file from Dropbox</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="92">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def import_file(file_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">        # Get file metadata first</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="95">
            

            
              
            

            <code class="ruby">        metadata = api_request(&quot;/files/get_metadata&quot;, { path: file_id })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby">        # Download file content</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="98">
            

            
              
            

            <code class="ruby">        response = HTTParty.post(&quot;#{CONTENT_URL}/files/download&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">          headers: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">            &quot;Authorization&quot; =&gt; &quot;Bearer #{integration.access_token}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby">            &quot;Dropbox-API-Arg&quot; =&gt; { path: file_id }.to_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
            

            <code class="ruby">        })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="105">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        raise ApiError, &quot;Failed to download file&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="108">
            

            
              
            

            <code class="ruby">          name: metadata[&quot;name&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">          content: response.body,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">          mime_type: mime_type_from_path(metadata[&quot;name&quot;]),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">          size: metadata[&quot;size&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="114">
            

            
              
            

            <code class="ruby">        handle_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    # Export a document to Dropbox</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="119">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def export_document(document, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            

            
              
            

            <code class="ruby">      folder_path = options[:folder_path] || &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="121">
            

            
              
            

            <code class="ruby">      file_name = &quot;#{document.title}.html&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="122">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      path = folder_path.present? ? &quot;#{folder_path}/#{file_name}&quot; : &quot;/#{file_name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">      # Convert document content to HTML</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="125">
            

            
              
            

            <code class="ruby">      content = &lt;&lt;~HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">        &lt;!DOCTYPE html&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">        &lt;html&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">        &lt;head&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">          &lt;title&gt;#{CGI.escapeHTML(document.title)}&lt;/title&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">        &lt;/head&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">        &lt;body&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">          &lt;h1&gt;#{CGI.escapeHTML(document.title)}&lt;/h1&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">          #{document.content}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">        &lt;/body&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">        &lt;/html&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">        # Upload file</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="140">
            

            
              
            

            <code class="ruby">        response = HTTParty.post(&quot;#{CONTENT_URL}/files/upload&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">          headers: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">            &quot;Authorization&quot; =&gt; &quot;Bearer #{integration.access_token}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">            &quot;Dropbox-API-Arg&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">              path: path,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">              mode: &quot;add&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">              autorename: true,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">              mute: false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">            }.to_json,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">            &quot;Content-Type&quot; =&gt; &quot;application/octet-stream&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">          },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">          body: content</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">        })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="154">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">        raise ApiError, &quot;Failed to upload file: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            
              
            

            <code class="ruby">        file_data = JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">        # Create or update cloud file record</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            

            
              
            

            <code class="ruby">        cloud_file = integration.cloud_files.find_or_create_by(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">          file_id: file_data[&quot;id&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="163">
            

            
              
            

            <code class="ruby">        cloud_file.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">          provider: &quot;dropbox&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">          name: file_data[&quot;name&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">          mime_type: &quot;text/html&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">          size: file_data[&quot;size&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">          document: document,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby">          metadata: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby">            path_lower: file_data[&quot;path_lower&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">            path_display: file_data[&quot;path_display&quot;],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">            rev: file_data[&quot;rev&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">          },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">          last_synced_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="177">
            

            
              
            

            <code class="ruby">        cloud_file</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">      rescue =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="179">
            

            
              
            

            <code class="ruby">        handle_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="183">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="184">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="185">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def api_request(endpoint, body)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            

            
              
            

            <code class="ruby">      response = HTTParty.post(&quot;#{BASE_URL}#{endpoint}&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">        headers: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">          &quot;Authorization&quot; =&gt; &quot;Bearer #{integration.access_token}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">          &quot;Content-Type&quot; =&gt; &quot;application/json&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">        body: body.to_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="194">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      raise ApiError, &quot;API request failed: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="195">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="196">
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="199">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def oauth2_refresh_request</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="200">
            

            
              
            

            <code class="ruby">      response = HTTParty.post(&quot;#{BASE_URL.sub(&#39;/2&#39;, &#39;&#39;)}/oauth2/token&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">        body: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
            

            <code class="ruby">          refresh_token: integration.refresh_token,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="203">
            

            
              
            

            <code class="ruby">          client_id: Rails.application.credentials.dig(:dropbox, :client_id),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
            

            <code class="ruby">          client_secret: Rails.application.credentials.dig(:dropbox, :client_secret),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="205">
            

            
              
            

            <code class="ruby">          grant_type: &quot;refresh_token&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="206">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="209">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      raise ApiError, &quot;Failed to refresh token: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="214">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">    def mime_type_from_path(path)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="215">
            

            
              
            

            <code class="ruby">      extension = File.extname(path).downcase</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="216">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="217">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      case extension</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="218">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;.txt&quot; then &quot;text/plain&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="219">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;.html&quot;, &quot;.htm&quot; then &quot;text/html&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="220">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;.pdf&quot; then &quot;application/pdf&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="221">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;.doc&quot; then &quot;application/msword&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="222">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;.docx&quot; then &quot;application/vnd.openxmlformats-officedocument.wordprocessingml.document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="223">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      when &quot;.md&quot; then &quot;text/markdown&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="224">
            

            
              
            

            <code class="ruby">      else &quot;application/octet-stream&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="225">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="226">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="227">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="228">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="695fe6fa6edefe2dfb1769f99ca069b20a91426b">
  <div class="header">
    <h3>app/services/cloud_services/google_drive_service.rb</h3>
    <h4>
      <span class="green">
  94.83%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  71.43%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>58</b> relevant lines.
      <span class="green"><b>55</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>14</b> total branches, </span>
          <span class="green"><b>10</b> branches covered</span> and
          <span class="red"><b>4</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">require &quot;google/apis/drive_v3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">require &quot;googleauth&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">module CloudServices</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="5">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  class GoogleDriveService &lt; BaseService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="6">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    SCOPES = [ &quot;https://www.googleapis.com/auth/drive.readonly&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">              &quot;https://www.googleapis.com/auth/drive.file&quot; ].freeze</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="9">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def initialize(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="10">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      super</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="11">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      @drive_service = Google::Apis::DriveV3::DriveService.new</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="12">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      @drive_service.authorization = google_auth</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">    # OAuth2 configuration for Google</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="16">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def self.oauth2_config</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="8" data-linenumber="18">
            
              <span class="hits">8</span>
            

            
              
            

            <code class="ruby">        client_id: Rails.application.credentials.dig(:google, :client_id),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">        client_secret: Rails.application.credentials.dig(:google, :client_secret),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">        redirect_uri: build_callback_url(&quot;/cloud_integrations/google/callback&quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby">        scope: SCOPES.join(&quot; &quot;),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">        access_type: &quot;offline&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">        prompt: &quot;consent&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="25">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">    # Generate OAuth2 authorization URL</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="28">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def self.authorization_url</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="29">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      params = oauth2_config.slice(:client_id, :redirect_uri, :scope, :access_type, :prompt)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="30">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      params[:response_type] = &quot;code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="31">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="32">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      &quot;https://accounts.google.com/o/oauth2/v2/auth?#{params.to_query}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">    # Exchange authorization code for tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="36">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def self.exchange_code(code)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="37">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      response = HTTParty.post(&quot;https://oauth2.googleapis.com/token&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">        body: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">          code: code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">          client_id: oauth2_config[:client_id],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">          client_secret: oauth2_config[:client_secret],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">          redirect_uri: oauth2_config[:redirect_uri],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">          grant_type: &quot;authorization_code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="47">
            
              <span class="hits">2</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
            

            <code class="ruby">      raise ApiError, &quot;Failed to exchange code: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="49">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="50">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">    # List files from Google Drive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="53">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def list_files(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="54">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      page_token = options[:page_token]</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="55">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">      query = options[:query] || &quot;mimeType != &#39;application/vnd.google-apps.folder&#39;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="58">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        response = @drive_service.list_files(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">          q: query,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">          page_size: 100,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">          page_token: page_token,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">          fields: &quot;files(id, name, mimeType, size, modifiedTime, webViewLink), nextPageToken&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="65">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        files = response.files.map do |file|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="66">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="67">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">            id: file.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">            name: file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">            mime_type: file.mime_type,</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="70">
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">            size: file.size&amp;.to_i,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">            metadata: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">              modified_time: file.modified_time,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">              web_view_link: file.web_view_link</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="79">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">          files: files,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">          next_page_token: response.next_page_token</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="81">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">      rescue Google::Apis::Error =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="83">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        handle_google_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="86">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">    # Import a file from Google Drive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="88">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def import_file(file_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="4" data-linenumber="90">
            
              <span class="hits">4</span>
            

            
              
            

            <code class="ruby">        file = @drive_service.get_file(file_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="92">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">        content = case file.mime_type</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">        when &quot;application/vnd.google-apps.document&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">          # Export Google Docs as HTML</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="95">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          @drive_service.export_file(file_id, &quot;text/html&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">        when &quot;application/vnd.google-apps.spreadsheet&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">          # Export Google Sheets as CSV</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="98">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          @drive_service.export_file(file_id, &quot;text/csv&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="99">
            

            
              
            

            <code class="ruby">        when &quot;application/vnd.google-apps.presentation&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="100">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">          # Export Google Slides as PDF</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="101">
            

            
              
            

            <code class="ruby">          @drive_service.export_file(file_id, &quot;application/pdf&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="102">
            

            
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="103">
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
            

            <code class="ruby">          # Download regular files</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="104">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">          @drive_service.get_file(file_id, download_dest: StringIO.new)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="108">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">          name: file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">          content: content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby">          mime_type: file.mime_type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby">          size: content.bytesize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="112">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">      rescue Google::Apis::Error =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="114">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        handle_google_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="116">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby">    # Export a document to Google Drive</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="119">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def export_document(document, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="120">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      folder_id = options[:folder_id] || &quot;root&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">      file_metadata = {</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="123">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        name: document.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">        parents: [ folder_id ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      # Convert document content to HTML</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="128">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">      content = &lt;&lt;~HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby">        &lt;!DOCTYPE html&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="130">
            

            
              
            

            <code class="ruby">        &lt;html&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">        &lt;head&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">          &lt;title&gt;#{CGI.escapeHTML(document.title)}&lt;/title&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="133">
            

            
              
            

            <code class="ruby">        &lt;/head&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby">        &lt;body&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby">          #{document.content}</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">        &lt;/body&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">        &lt;/html&gt;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      HTML</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="141">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        file = @drive_service.create_file(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">          file_metadata,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">          fields: &quot;id, name, webViewLink&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">          upload_source: StringIO.new(content),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">          content_type: &quot;text/html&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">        # Create or update cloud file record</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="149">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        cloud_file = integration.cloud_files.find_or_create_by(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">          file_id: file.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="151">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="153">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        cloud_file.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby">          provider: &quot;google_drive&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">          name: file.name,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="156">
            

            
              
            

            <code class="ruby">          mime_type: &quot;text/html&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby">          size: content.bytesize,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="158">
            

            
              
            

            <code class="ruby">          document: document,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="159">
            

            
              
            

            <code class="ruby">          metadata: { web_view_link: file.web_view_link },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">          last_synced_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="163">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">        cloud_file</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby">      rescue Google::Apis::Error =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="165">
            

            
              
            

            <code class="ruby">        handle_google_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="166">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="169">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="170">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="171">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def google_auth</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">      # Create Google auth credentials from tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="15" data-linenumber="173">
            
              <span class="hits">15</span>
            

            
              
            

            <code class="ruby">      Google::Auth::UserRefreshCredentials.new(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">        client_id: Rails.application.credentials.dig(:google, :client_id),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">        client_secret: Rails.application.credentials.dig(:google, :client_secret),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">        scope: SCOPES,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">        access_token: integration.access_token,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">        refresh_token: integration.refresh_token,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">        expires_at: integration.expires_at</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">      )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="183">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def oauth2_refresh_request</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="184">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      response = HTTParty.post(&quot;https://oauth2.googleapis.com/token&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">        body: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="186">
            

            
              
            

            <code class="ruby">          refresh_token: integration.refresh_token,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">          client_id: Rails.application.credentials.dig(:google, :client_id),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">          client_secret: Rails.application.credentials.dig(:google, :client_secret),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby">          grant_type: &quot;refresh_token&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="190">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="192">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="1" data-linenumber="193">
            
              <span class="hits">1</span>
            

            
              
                <span class="hits" title="else branch hit 1 times">
                  else: 1
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      raise ApiError, &quot;Failed to refresh token: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="194">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="195">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="196">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="197">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="198">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">    def handle_google_api_error(error)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="199">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">      case error.status_code</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when 401</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="201">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise AuthenticationError, &quot;Google authentication failed: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="202">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when 403</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="203">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise AuthorizationError, &quot;Google authorization failed: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="204">
            

            
              
                <span class="hits" title="when branch hit 1 times">
                  when: 1
                </span>
              
            

            <code class="ruby">      when 404</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="205">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">        raise NotFoundError, &quot;Google resource not found: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="206">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="207">
            

            
              
            

            <code class="ruby">        raise ApiError, &quot;Google API error: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="211">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="efc6940cc6ca4ef58691ecccc8cf69a418dc6233">
  <div class="header">
    <h3>app/services/cloud_services/notion_service.rb</h3>
    <h4>
      <span class="red">
  17.65%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="red">
  0.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>119</b> relevant lines.
      <span class="green"><b>21</b> lines covered</span> and
      <span class="red"><b>98</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>53</b> total branches, </span>
          <span class="green"><b>0</b> branches covered</span> and
          <span class="red"><b>53</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="1">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">require &quot;notion-ruby-client&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="2">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">require &quot;nokogiri&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="4">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">module CloudServices</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="5">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">  class NotionService &lt; BaseService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="6">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    OAUTH_URL = &quot;https://api.notion.com/v1/oauth&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="8">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def initialize(integration)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="9">
            

            
              
            

            <code class="ruby">      super</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="10">
            

            
              
            

            <code class="ruby">      @client = Notion::Client.new(token: integration.access_token)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="12">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="13">
            

            
              
            

            <code class="ruby">    # OAuth2 configuration for Notion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="14">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def self.oauth2_config</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="15">
            

            
              
            

            <code class="ruby">      {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">        client_id: Rails.application.credentials.dig(:notion, :client_id),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">        client_secret: Rails.application.credentials.dig(:notion, :client_secret),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby">        redirect_uri: build_callback_url(&quot;/cloud_integrations/notion/callback&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="20">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="21">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="22">
            

            
              
            

            <code class="ruby">    # Generate OAuth2 authorization URL</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="23">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def self.authorization_url</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="24">
            

            
              
            

            <code class="ruby">      params = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="25">
            

            
              
            

            <code class="ruby">        client_id: oauth2_config[:client_id],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">        redirect_uri: oauth2_config[:redirect_uri],</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby">        response_type: &quot;code&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">        owner: &quot;user&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="29">
            

            
              
            

            <code class="ruby">      }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="30">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="31">
            

            
              
            

            <code class="ruby">      &quot;#{OAUTH_URL}/authorize?#{params.to_query}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="33">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="34">
            

            
              
            

            <code class="ruby">    # Exchange authorization code for tokens</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="35">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def self.exchange_code(code)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="36">
            

            
              
            

            <code class="ruby">      response = HTTParty.post(&quot;#{OAUTH_URL}/token&quot;, {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">        headers: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="38">
            

            
              
            

            <code class="ruby">          &quot;Authorization&quot; =&gt; &quot;Basic #{Base64.strict_encode64(&quot;#{oauth2_config[:client_id]}:#{oauth2_config[:client_secret]}&quot;)}&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="39">
            

            
              
            

            <code class="ruby">          &quot;Content-Type&quot; =&gt; &quot;application/json&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="40">
            

            
              
            

            <code class="ruby">        },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby">        body: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="42">
            

            
              
            

            <code class="ruby">          grant_type: &quot;authorization_code&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">          code: code,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby">          redirect_uri: oauth2_config[:redirect_uri]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">        }.to_json</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="46">
            

            
              
            

            <code class="ruby">      })</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="47">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="48">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      raise ApiError, &quot;Failed to exchange code: #{response.body}&quot; unless response.success?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="50">
            

            
              
            

            <code class="ruby">      JSON.parse(response.body)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">    # List pages from Notion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="54">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def list_pages(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="55">
            

            
              
            

            <code class="ruby">      start_cursor = options[:start_cursor]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="57">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="58">
            

            
              
            

            <code class="ruby">        response = @client.search(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="59">
            

            
              
            

            <code class="ruby">          filter: { property: &quot;object&quot;, value: &quot;page&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">          start_cursor: start_cursor,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="61">
            

            
              
            

            <code class="ruby">          page_size: 100</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="62">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="64">
            

            
              
            

            <code class="ruby">        files = response.results.map do |page|</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="66">
            

            
              
            

            <code class="ruby">            id: page.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="67">
            

            
              
            

            <code class="ruby">            name: extract_page_title(page),</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="68">
            

            
              
            

            <code class="ruby">            mime_type: &quot;application/x-notion-page&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby">            size: nil, # Notion doesn&#39;t provide size</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">            metadata: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="71">
            

            
              
            

            <code class="ruby">              url: page.url,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="72">
            

            
              
            

            <code class="ruby">              created_time: page.created_time,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">              last_edited_time: page.last_edited_time,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby">              parent_type: page.parent.type,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">              parent_id: page.parent[page.parent.type.to_sym]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="76">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="77">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="78">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="81">
            

            
              
            

            <code class="ruby">          files: files,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="82">
            

            
              
            

            <code class="ruby">          next_cursor: response.next_cursor,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="83">
            

            
              
            

            <code class="ruby">          has_more: response.has_more</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="84">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby">      rescue Notion::Api::Errors::NotionError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="86">
            

            
              
            

            <code class="ruby">        handle_notion_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="87">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="89">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="90">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    alias_method :list_files, :list_pages</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby">    # Import a page from Notion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="93">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def import_page(page_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="94">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="95">
            

            
              
            

            <code class="ruby">        # Get page details</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="96">
            

            
              
            

            <code class="ruby">        page = @client.page(page_id: page_id)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="98">
            

            
              
            

            <code class="ruby">        # Get page content blocks</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="99">
            

            
              
            

            <code class="ruby">        blocks = []</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="100">
            

            
              
            

            <code class="ruby">        start_cursor = nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="102">
            

            
              
            

            <code class="ruby">        loop do</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="103">
            

            
              
            

            <code class="ruby">          response = @client.block_children(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">            block_id: page_id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby">            start_cursor: start_cursor,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">            page_size: 100</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="107">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="108">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="109">
            

            
              
            

            <code class="ruby">          blocks.concat(response.results)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="110">
            

            
              
            

            <code class="ruby">          start_cursor = response.next_cursor</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="111">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="112">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">          break unless response.has_more</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="115">
            

            
              
            

            <code class="ruby">        # Convert blocks to HTML</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="116">
            

            
              
            

            <code class="ruby">        content = blocks_to_html(blocks)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="117">
            

            
              
            

            <code class="ruby">        title = extract_page_title(page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">        {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="120">
            

            
              
            

            <code class="ruby">          name: title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="121">
            

            
              
            

            <code class="ruby">          content: content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">          mime_type: &quot;text/html&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby">          size: content.bytesize</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="124">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="125">
            

            
              
            

            <code class="ruby">      rescue Notion::Api::Errors::NotionError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="126">
            

            
              
            

            <code class="ruby">        handle_notion_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="128">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="130">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    alias_method :import_file, :import_page</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">    # Export a document to Notion</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="133">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def export_document(document, options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="134">
            

            
              
            

            <code class="ruby">      parent_page_id = options[:parent_page_id]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="135">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      begin</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">        # Create page properties</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">        properties = {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="139">
            

            
              
            

            <code class="ruby">          &quot;title&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">            &quot;title&quot; =&gt; [</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="141">
            

            
              
            

            <code class="ruby">              {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">                &quot;type&quot; =&gt; &quot;text&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby">                &quot;text&quot; =&gt; { &quot;content&quot; =&gt; document.title }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">              }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="145">
            

            
              
            

            <code class="ruby">            ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="146">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="147">
            

            
              
            

            <code class="ruby">        }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">        # Create page</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="150">
            

            
              
            

            <code class="ruby">        page = @client.create_page(</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="151">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          parent: parent_page_id ? { page_id: parent_page_id } : { type: &quot;workspace&quot; },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="152">
            

            
              
            

            <code class="ruby">          properties: properties</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="153">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="154">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="155">
            

            
              
            

            <code class="ruby">        # Add content blocks</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="156">
            

            
              
            

            <code class="ruby">        blocks = html_to_blocks(document.content.to_s)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="157">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="158">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if blocks.any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="159">
            

            
              
            

            <code class="ruby">          @client.update_block_children(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="160">
            

            
              
            

            <code class="ruby">            block_id: page.id,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="161">
            

            
              
            

            <code class="ruby">            children: blocks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="162">
            

            
              
            

            <code class="ruby">          )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="163">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="164">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="165">
            

            
              
            

            <code class="ruby">        # Create or update cloud file record</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="166">
            

            
              
            

            <code class="ruby">        cloud_file = integration.cloud_files.find_or_create_by(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="167">
            

            
              
            

            <code class="ruby">          file_id: page.id</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="168">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="169">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="170">
            

            
              
            

            <code class="ruby">        cloud_file.update!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="171">
            

            
              
            

            <code class="ruby">          provider: &quot;notion&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="172">
            

            
              
            

            <code class="ruby">          name: document.title,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="173">
            

            
              
            

            <code class="ruby">          mime_type: &quot;application/x-notion-page&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="174">
            

            
              
            

            <code class="ruby">          size: nil,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="175">
            

            
              
            

            <code class="ruby">          document: document,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="176">
            

            
              
            

            <code class="ruby">          metadata: {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="177">
            

            
              
            

            <code class="ruby">            url: page.url,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="178">
            

            
              
            

            <code class="ruby">            created_time: page.created_time,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="179">
            

            
              
            

            <code class="ruby">            last_edited_time: page.last_edited_time</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="180">
            

            
              
            

            <code class="ruby">          },</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="181">
            

            
              
            

            <code class="ruby">          last_synced_at: Time.current</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="182">
            

            
              
            

            <code class="ruby">        )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="183">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="184">
            

            
              
            

            <code class="ruby">        cloud_file</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="185">
            

            
              
            

            <code class="ruby">      rescue Notion::Api::Errors::NotionError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="186">
            

            
              
            

            <code class="ruby">        handle_notion_api_error(e)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="187">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="188">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="189">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="190">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="191">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="192">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def extract_page_title(page)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="193">
            

            
              
            

            <code class="ruby">      # Try to extract title from properties</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="194">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      if page.properties &amp;&amp; page.properties[&quot;title&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="195">
            

            
              
            

            <code class="ruby">        title_property = page.properties[&quot;title&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="196">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if title_property[&quot;title&quot;] &amp;&amp; title_property[&quot;title&quot;].any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="197">
            

            
              
            

            <code class="ruby">          return title_property[&quot;title&quot;].map { |t| t[&quot;plain_text&quot;] }.join</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="198">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="199">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="200">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="201">
            

            
              
            

            <code class="ruby">      # Try other common property names</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="202">
            

            
              
            

            <code class="ruby">      %w[Title Name Page].each do |prop_name|</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="203">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if page.properties &amp;&amp; page.properties[prop_name]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="204">
            

            
              
            

            <code class="ruby">          prop = page.properties[prop_name]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="205">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          if prop[&quot;title&quot;] &amp;&amp; prop[&quot;title&quot;].any?</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="206">
            

            
              
            

            <code class="ruby">            return prop[&quot;title&quot;].map { |t| t[&quot;plain_text&quot;] }.join</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="207">
            

            
              
            

            <code class="ruby">          end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="208">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="209">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="210">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="211">
            

            
              
            

            <code class="ruby">      &quot;Untitled&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="212">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="213">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="214">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def blocks_to_html(blocks)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="215">
            

            
              
            

            <code class="ruby">      html_parts = blocks.map do |block|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="216">
            

            
              
            

            <code class="ruby">        case block.type</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="217">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;paragraph&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="218">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.paragraph.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="219">
            

            
              
            

            <code class="ruby">          &quot;&lt;p&gt;#{text}&lt;/p&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="220">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;heading_1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="221">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.heading_1.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="222">
            

            
              
            

            <code class="ruby">          &quot;&lt;h1&gt;#{text}&lt;/h1&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="223">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;heading_2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="224">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.heading_2.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="225">
            

            
              
            

            <code class="ruby">          &quot;&lt;h2&gt;#{text}&lt;/h2&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="226">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;heading_3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="227">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.heading_3.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="228">
            

            
              
            

            <code class="ruby">          &quot;&lt;h3&gt;#{text}&lt;/h3&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="229">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;bulleted_list_item&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="230">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.bulleted_list_item.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="231">
            

            
              
            

            <code class="ruby">          &quot;&lt;li&gt;#{text}&lt;/li&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="232">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;numbered_list_item&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="233">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.numbered_list_item.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="234">
            

            
              
            

            <code class="ruby">          &quot;&lt;li&gt;#{text}&lt;/li&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="235">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;quote&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="236">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.quote.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="237">
            

            
              
            

            <code class="ruby">          &quot;&lt;blockquote&gt;#{text}&lt;/blockquote&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="238">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;code&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="239">
            

            
              
            

            <code class="ruby">          text = extract_rich_text(block.code.rich_text)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="240">
            

            
              
            

            <code class="ruby">          language = block.code.language</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="241">
            

            
              
            

            <code class="ruby">          &quot;&lt;pre&gt;&lt;code class=\&quot;language-#{language}\&quot;&gt;#{CGI.escapeHTML(text)}&lt;/code&gt;&lt;/pre&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="242">
            

            
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="243">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          # Skip unsupported block types</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="244">
            

            
              
            

            <code class="ruby">          &quot;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="245">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="246">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="247">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="248">
            

            
              
            

            <code class="ruby">      html_parts.join(&quot;\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="249">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="250">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="251">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def extract_rich_text(rich_text_array)</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="252">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
            

            <code class="ruby">      return &quot;&quot; unless rich_text_array</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="253">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="254">
            

            
              
            

            <code class="ruby">      rich_text_array.map do |rt|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="255">
            

            
              
            

            <code class="ruby">        text = CGI.escapeHTML(rt[&quot;plain_text&quot;])</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="256">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="257">
            

            
              
            

            <code class="ruby">        # Apply formatting</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="258">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if rt[&quot;annotations&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="259">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          text = &quot;&lt;strong&gt;#{text}&lt;/strong&gt;&quot; if rt[&quot;annotations&quot;][&quot;bold&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="260">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          text = &quot;&lt;em&gt;#{text}&lt;/em&gt;&quot; if rt[&quot;annotations&quot;][&quot;italic&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="261">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          text = &quot;&lt;u&gt;#{text}&lt;/u&gt;&quot; if rt[&quot;annotations&quot;][&quot;underline&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="262">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          text = &quot;&lt;s&gt;#{text}&lt;/s&gt;&quot; if rt[&quot;annotations&quot;][&quot;strikethrough&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="263">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">          text = &quot;&lt;code&gt;#{text}&lt;/code&gt;&quot; if rt[&quot;annotations&quot;][&quot;code&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="264">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="265">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="266">
            

            
              
            

            <code class="ruby">        # Add link if present</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="267">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        if rt[&quot;href&quot;]</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="268">
            

            
              
            

            <code class="ruby">          text = &quot;&lt;a href=\&quot;#{CGI.escapeHTML(rt[&#39;href&#39;])}\&quot;&gt;#{text}&lt;/a&gt;&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="269">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="270">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="271">
            

            
              
            

            <code class="ruby">        text</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="272">
            

            
              
            

            <code class="ruby">      end.join</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="273">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="274">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="275">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def html_to_blocks(html_content)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="276">
            

            
              
            

            <code class="ruby">      # Simple HTML to Notion blocks conversion</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="277">
            

            
              
            

            <code class="ruby">      # This is a basic implementation - could be expanded</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="278">
            

            
              
            

            <code class="ruby">      doc = Nokogiri::HTML::DocumentFragment.parse(html_content)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="279">
            

            
              
            

            <code class="ruby">      blocks = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="280">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="281">
            

            
              
            

            <code class="ruby">      doc.children.each do |node|</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="282">
            

            
              
            

            <code class="ruby">        block = case node.name</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="283">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;p&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="284">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="285">
            

            
              
            

            <code class="ruby">            &quot;object&quot; =&gt; &quot;block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="286">
            

            
              
            

            <code class="ruby">            &quot;type&quot; =&gt; &quot;paragraph&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="287">
            

            
              
            

            <code class="ruby">            &quot;paragraph&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="288">
            

            
              
            

            <code class="ruby">              &quot;rich_text&quot; =&gt; [ { &quot;type&quot; =&gt; &quot;text&quot;, &quot;text&quot; =&gt; { &quot;content&quot; =&gt; node.text } } ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="289">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="290">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="291">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;h1&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="292">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="293">
            

            
              
            

            <code class="ruby">            &quot;object&quot; =&gt; &quot;block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="294">
            

            
              
            

            <code class="ruby">            &quot;type&quot; =&gt; &quot;heading_1&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="295">
            

            
              
            

            <code class="ruby">            &quot;heading_1&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="296">
            

            
              
            

            <code class="ruby">              &quot;rich_text&quot; =&gt; [ { &quot;type&quot; =&gt; &quot;text&quot;, &quot;text&quot; =&gt; { &quot;content&quot; =&gt; node.text } } ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="297">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="298">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="299">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;h2&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="300">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="301">
            

            
              
            

            <code class="ruby">            &quot;object&quot; =&gt; &quot;block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="302">
            

            
              
            

            <code class="ruby">            &quot;type&quot; =&gt; &quot;heading_2&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="303">
            

            
              
            

            <code class="ruby">            &quot;heading_2&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="304">
            

            
              
            

            <code class="ruby">              &quot;rich_text&quot; =&gt; [ { &quot;type&quot; =&gt; &quot;text&quot;, &quot;text&quot; =&gt; { &quot;content&quot; =&gt; node.text } } ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="305">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="306">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="307">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;h3&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="308">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="309">
            

            
              
            

            <code class="ruby">            &quot;object&quot; =&gt; &quot;block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="310">
            

            
              
            

            <code class="ruby">            &quot;type&quot; =&gt; &quot;heading_3&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="311">
            

            
              
            

            <code class="ruby">            &quot;heading_3&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="312">
            

            
              
            

            <code class="ruby">              &quot;rich_text&quot; =&gt; [ { &quot;type&quot; =&gt; &quot;text&quot;, &quot;text&quot; =&gt; { &quot;content&quot; =&gt; node.text } } ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="313">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="314">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="315">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">        when &quot;blockquote&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="316">
            

            
              
            

            <code class="ruby">          {</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="317">
            

            
              
            

            <code class="ruby">            &quot;object&quot; =&gt; &quot;block&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="318">
            

            
              
            

            <code class="ruby">            &quot;type&quot; =&gt; &quot;quote&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="319">
            

            
              
            

            <code class="ruby">            &quot;quote&quot; =&gt; {</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="320">
            

            
              
            

            <code class="ruby">              &quot;rich_text&quot; =&gt; [ { &quot;type&quot; =&gt; &quot;text&quot;, &quot;text&quot; =&gt; { &quot;content&quot; =&gt; node.text } } ]</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="321">
            

            
              
            

            <code class="ruby">            }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="322">
            

            
              
            

            <code class="ruby">          }</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="323">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="324">
            

            
              
            

            <code class="ruby">          next</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="325">
            

            
              
            

            <code class="ruby">        end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="326">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="0" data-linenumber="327">
            

            
              
                <span class="hits" title="then branch hit 0 times">
                  then: 0
                </span>
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">        blocks &lt;&lt; block if block</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="328">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="329">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="330">
            

            
              
            

            <code class="ruby">      blocks</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="331">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="332">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="333">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def handle_notion_api_error(error)</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="334">
            

            
              
            

            <code class="ruby">      case error.code</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="335">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;unauthorized&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="336">
            

            
              
            

            <code class="ruby">        raise AuthenticationError, &quot;Notion authentication failed: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="337">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;restricted_resource&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="338">
            

            
              
            

            <code class="ruby">        raise AuthorizationError, &quot;Notion access restricted: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="339">
            

            
              
                <span class="hits" title="when branch hit 0 times">
                  when: 0
                </span>
              
            

            <code class="ruby">      when &quot;object_not_found&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="340">
            

            
              
            

            <code class="ruby">        raise NotFoundError, &quot;Notion resource not found: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed-branch" data-hits="" data-linenumber="341">
            

            
              
                <span class="hits" title="else branch hit 0 times">
                  else: 0
                </span>
              
            

            <code class="ruby">      else</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="342">
            

            
              
            

            <code class="ruby">        raise ApiError, &quot;Notion API error: #{error.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="343">
            

            
              
            

            <code class="ruby">      end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="344">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="345">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="346">
            

            
              
            

            <code class="ruby">    # Notion doesn&#39;t use refresh tokens in the same way</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="347">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    def oauth2_refresh_request</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="348">
            

            
              
            

            <code class="ruby">      # Notion tokens don&#39;t expire by default</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="349">
            

            
              
            

            <code class="ruby">      { &quot;access_token&quot; =&gt; integration.access_token }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="350">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="351">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="352">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
        <div class="source_table" id="61186a6d864ccc7ef45640587372542da21e7749">
  <div class="header">
    <h3>app/services/sub_agent_service.rb</h3>
    <h4>
      <span class="green">
  95.77%
</span>

      lines covered
    </h4>

    
      <h4>
        <span class="green">
  100.0%
</span>

        branches covered
      </h4>
    

    <div class="t-line-summary">
      <b>71</b> relevant lines.
      <span class="green"><b>68</b> lines covered</span> and
      <span class="red"><b>3</b> lines missed.</span>
    </div>

    
      <div class="t-branch-summary">
          <span><b>6</b> total branches, </span>
          <span class="green"><b>6</b> branches covered</span> and
          <span class="red"><b>0</b> branches missed.</span>
      </div>
    

  </div>

  <pre>
    <ol>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="1">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">class SubAgentService</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="2">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  attr_reader :sub_agent, :errors</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="3">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="4">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="5">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    @sub_agent = sub_agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="51" data-linenumber="6">
            
              <span class="hits">51</span>
            

            
              
            

            <code class="ruby">    @errors = []</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="7">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="8">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="9">
            

            
              
            

            <code class="ruby">  # Initialize a new sub-agent with necessary setup</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="10">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def initialize_agent</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="11">
            

            
              
            

            <code class="ruby">    # Basic initialization - can be expanded later</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="12">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    sub_agent.activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="13">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="14">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="15">
            

            
              
            

            <code class="ruby">    @errors &lt;&lt; &quot;Failed to initialize agent: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="16">
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="17">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="18">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="19">
            

            
              
            

            <code class="ruby">  # Activate the sub-agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="20">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def activate</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="21">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    sub_agent.activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="22">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="23">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="24">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @errors &lt;&lt; &quot;Failed to activate agent: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="25">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="26">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="27">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="28">
            

            
              
            

            <code class="ruby">  # Complete the sub-agent&#39;s work</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="29">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def complete</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="30">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    sub_agent.complete!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="31">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="32">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="33">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @errors &lt;&lt; &quot;Failed to complete agent: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="34">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="35">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="36">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="37">
            

            
              
            

            <code class="ruby">  # Class method to create a new sub-agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="38">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def self.create(user, document, params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="39">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent = document.sub_agents.build(params)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="40">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent.user = user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="41">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="42">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new(sub_agent)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="43">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="44">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="45">
            

            
              
            

            <code class="ruby">  # Send a message to the sub-agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="46">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def send_message(user, content)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="18" data-linenumber="47">
            
              <span class="hits">18</span>
            

            
              
                <span class="hits" title="then branch hit 12 times">
                  then: 12
                </span>
              
                <span class="hits" title="else branch hit 6 times">
                  else: 6
                </span>
              
            

            <code class="ruby">    return nil if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="48">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="49">
            

            
              
            

            <code class="ruby">    # Create user message</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="6" data-linenumber="50">
            
              <span class="hits">6</span>
            

            
              
            

            <code class="ruby">    message = sub_agent.messages.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="51">
            

            
              
            

            <code class="ruby">      role: &quot;user&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="52">
            

            
              
            

            <code class="ruby">      content: content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="53">
            

            
              
            

            <code class="ruby">      user: user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="54">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="55">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="56">
            

            
              
            

            <code class="ruby">    # Generate assistant response (mock for now)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="57">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    generate_assistant_response(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="58">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="59">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    message</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="60">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="61">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @errors &lt;&lt; &quot;Failed to send message: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="62">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    nil</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="63">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="64">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="65">
            

            
              
            

            <code class="ruby">  # Merge content from sub-agent</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="66">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def merge_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="67">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    assistant_messages = sub_agent.messages.by_role(&quot;assistant&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="68">
            
              <span class="hits">5</span>
            

            
              
                <span class="hits" title="then branch hit 2 times">
                  then: 2
                </span>
              
                <span class="hits" title="else branch hit 3 times">
                  else: 3
                </span>
              
            

            <code class="ruby">    return nil if assistant_messages.empty?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="69">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="70">
            

            
              
            

            <code class="ruby">    # Collect all assistant messages</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="71">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_parts = assistant_messages.map(&amp;:content)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="72">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content_parts.join(&quot;\n\n&quot;)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="73">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="74">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="75">
            

            
              
            

            <code class="ruby">  # Merge content to document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="76">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def merge_to_document(options = {})</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="77">
            
              <span class="hits">3</span>
            

            
              
            

            <code class="ruby">    content = merge_content</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="3" data-linenumber="78">
            
              <span class="hits">3</span>
            

            
              
                <span class="hits" title="then branch hit 1 times">
                  then: 1
                </span>
              
                <span class="hits" title="else branch hit 2 times">
                  else: 2
                </span>
              
            

            <code class="ruby">    return false if content.blank?</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="79">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="80">
            

            
              
            

            <code class="ruby">    # Append content to document</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="81">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    current_content = sub_agent.document.content.to_s</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="82">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    separator = options[:separator] || &quot;\n\n&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="83">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    heading = &quot;## Content from #{sub_agent.name}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="84">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    new_content = &quot;#{current_content}#{separator}#{heading}#{separator}#{content}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="85">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="2" data-linenumber="86">
            
              <span class="hits">2</span>
            

            
              
            

            <code class="ruby">    sub_agent.document.update!(content: new_content)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="87">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    true</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="88">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="89">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    @errors &lt;&lt; &quot;Failed to merge to document: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="90">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    false</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="91">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="92">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="93">
            

            
              
            

            <code class="ruby">  # Context management</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="94">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def update_context(new_context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="95">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.update_context(new_context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="96">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="97">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="98">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def merge_context(additional_context)</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="99">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.merge_context(additional_context)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="100">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="101">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="102">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def clear_context</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="103">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.clear_context</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="104">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="105">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="106">
            

            
              
            

            <code class="ruby">  # Status management</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="107">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def activate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="108">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.activate!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="109">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="110">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="111">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def deactivate!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="112">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.deactivate!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="113">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="114">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="115">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def complete!</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="116">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.complete!</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="117">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="118">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="119">
            

            
              
            

            <code class="ruby">  # Export and summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="120">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def export_conversation</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="121">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.export_conversation</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="122">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="123">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="124">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def summary</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="125">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.summary</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="126">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="127">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="128">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  private</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="129">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="130">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def generate_assistant_response(user)</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="131">
            

            
              
            

            <code class="ruby">    # Mock assistant response for testing</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="132">
            

            
              
            

            <code class="ruby">    # In production, this would call the AI API</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="133">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    response_content = &quot;I understand your message. How can I help you further?&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="134">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="135">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">    sub_agent.messages.create!(</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="136">
            

            
              
            

            <code class="ruby">      role: &quot;assistant&quot;,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="137">
            

            
              
            

            <code class="ruby">      content: response_content,</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="138">
            

            
              
            

            <code class="ruby">      user: user</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="139">
            

            
              
            

            <code class="ruby">    )</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="140">
            

            
              
            

            <code class="ruby">  rescue StandardError =&gt; e</code>
          </li>
        </div>
      
        <div>
          <li class="missed" data-hits="0" data-linenumber="141">
            

            
              
            

            <code class="ruby">    Rails.logger.error &quot;Failed to generate assistant response: #{e.message}&quot;</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="142">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="143">
            

            
              
            

            <code class="ruby"></code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="144">
            

            
              
            

            <code class="ruby">  # Helper method for conversation history</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="10" data-linenumber="145">
            
              <span class="hits">10</span>
            

            
              
            

            <code class="ruby">  def conversation_history</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="1" data-linenumber="146">
            
              <span class="hits">1</span>
            

            
              
            

            <code class="ruby">    sub_agent.messages.recent.limit(20).map do |msg|</code>
          </li>
        </div>
      
        <div>
          <li class="covered" data-hits="5" data-linenumber="147">
            
              <span class="hits">5</span>
            

            
              
            

            <code class="ruby">      { role: msg.role, content: msg.content }</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="148">
            

            
              
            

            <code class="ruby">    end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="149">
            

            
              
            

            <code class="ruby">  end</code>
          </li>
        </div>
      
        <div>
          <li class="never" data-hits="" data-linenumber="150">
            

            
              
            

            <code class="ruby">end</code>
          </li>
        </div>
      
    </ol>
  </pre>
</div>

      
      </div>
    </div>
  </body>
</html>
