<%= form_with url: document_context_items_path(document), 
              method: :get, 
              local: false,
              data: { 
                turbo_frame: "context_sidebar",
                controller: "search-filter",
                action: "turbo:submit-start->search-filter#formSubmitStart turbo:submit-end->search-filter#formSubmitEnd turbo:frame-render->search-filter#frameRendered",
                "search-filter-document-id-value": document.id
              },
              class: "space-y-3" do |f| %>
  
  <!-- Search Input -->
  <div class="relative">
    <%= f.text_field :query, 
                     value: params[:query],
                     class: "w-full px-3 py-2 pl-10 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                     placeholder: "Search items... (âŒ˜K)",
                     "aria-label": "Search context items",
                     data: { 
                       "search-filter-target": "searchInput",
                       action: "input->search-filter#debounceSearch"
                     } %>
    <svg class="absolute left-3 top-2.5 h-4 w-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
    </svg>
    <% if params[:query].present? %>
      <button type="button"
              class="absolute right-2 top-2 text-gray-400 hover:text-gray-600"
              data-action="click->search-filter#clearSearch"
              title="Clear search"
              aria-label="Clear search">
        <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    <% end %>
  </div>
  
  <!-- Filters Row -->
  <div class="flex gap-2">
    <!-- Type Filter -->
    <div class="flex-1">
      <%= f.select :type, 
                   options_for_select([
                     ["All types", ""],
                     ["Snippets only", "snippet"],
                     ["Drafts only", "draft"],
                     ["Versions only", "version"]
                   ], params[:type]),
                   {},
                   class: "w-full text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                   data: { 
                     "search-filter-target": "typeFilter",
                     action: "change->search-filter#filterChanged"
                   } %>
    </div>
    
    <!-- Date Range Filter -->
    <div class="flex-1">
      <%= f.select :date_range, 
                   options_for_select([
                     ["All time", ""],
                     ["Today", "today"],
                     ["This week", "week"],
                     ["This month", "month"],
                     ["Last 3 months", "quarter"],
                     ["This year", "year"]
                   ], params[:date_range]),
                   {},
                   class: "w-full text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                   data: { 
                     "search-filter-target": "dateFilter",
                     action: "change->search-filter#filterChanged"
                   } %>
    </div>
  </div>
  
  <!-- Search Results Info -->
  <% if params[:query].present? || params[:type].present? || params[:date_range].present? %>
    <div class="flex items-center justify-between text-xs">
      <span class="text-gray-600" data-results-count>
        <% if @search_results_count %>
          Found <%= @search_results_count %> <%= "item".pluralize(@search_results_count) %>
        <% end %>
      </span>
      <button type="button"
              class="text-blue-600 hover:text-blue-800 font-medium"
              data-action="click->search-filter#clearAllFilters"
              aria-label="Clear all filters">
        Clear filters
      </button>
    </div>
  <% end %>
  
  <!-- Sort Options -->
  <div class="flex items-center justify-between pt-2 border-t border-gray-100">
    <label class="text-xs text-gray-600">Sort by:</label>
    <%= f.select :sort_by,
                 options_for_select([
                   ["Most Recent", "recent"],
                   ["Alphabetical", "alphabetical"],
                   ["Last Modified", "modified"],
                   ["Manual Order", "manual"]
                 ], params[:sort_by] || "recent"),
                 {},
                 class: "text-xs border border-gray-300 rounded px-2 py-1 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",
                 data: { 
                   "search-filter-target": "sortSelect",
                   action: "change->search-filter#sortChanged"
                 } %>
  </div>
<% end %>