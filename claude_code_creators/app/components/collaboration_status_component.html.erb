<div class="<%= container_class %>"
     data-controller="collaboration-status"
     <% configuration_data.each do |key, value| %>
       data-<%= key.to_s.gsub('_', '-') %>-value="<%= value %>"
     <% end %>
     <%= accessibility_attributes.map { |k, v| "#{k}=\"#{v}\"" }.join(' ').html_safe %>
     data-collaboration-status-target="container">

  <!-- Connection Status Indicator -->
  <div class="flex items-center space-x-2">
    <!-- Status Dot -->
    <div class="<%= status_indicator_class(:connected) %>"
         data-collaboration-status-target="statusIndicator"
         aria-hidden="true"></div>
    
    <!-- Status Text -->
    <span class="<%= status_text_class %>"
          data-collaboration-status-target="statusText">
      <%= status_message(:connected) %>
    </span>
  </div>

  <!-- Connection Quality (if enabled) -->
  <% if show_connection_quality %>
    <div class="<%= divider_class %>" aria-hidden="true"></div>
    
    <div class="<%= connection_quality_class(:excellent) %>"
         data-collaboration-status-target="connectionQuality">
      
      <!-- Signal Strength Bars -->
      <div class="flex items-end space-x-px"
           data-collaboration-status-target="signalBars"
           aria-label="Connection quality">
        <% (1..4).each do |level| %>
          <div class="<%= signal_bar_class(level, :excellent) %>"
               data-signal-level="<%= level %>"></div>
        <% end %>
      </div>
      
      <!-- Quality Text (detailed style only) -->
      <% if style == :detailed %>
        <span class="text-xs font-medium"
              data-collaboration-status-target="qualityText">
          <%= connection_quality_text(:excellent) %>
        </span>
      <% end %>
    </div>
  <% end %>

  <!-- Sync Status (if enabled) -->
  <% if show_sync_status %>
    <div class="<%= divider_class %>" aria-hidden="true"></div>
    
    <div class="<%= sync_status_class %>"
         data-collaboration-status-target="syncStatus">
      
      <!-- Sync Icon -->
      <div class="<%= icon_class %> text-creative-accent-teal"
           data-collaboration-status-target="syncIcon">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-full h-full">
          <%= sync_icon_svg(:saved).html_safe %>
        </svg>
      </div>
      
      <!-- Sync Text -->
      <span data-collaboration-status-target="syncText">
        Saved
      </span>
    </div>
  <% end %>

  <!-- Last Save Time (if enabled) -->
  <% if show_last_save %>
    <div class="<%= divider_class %>" aria-hidden="true"></div>
    
    <div class="<%= last_save_class %>"
         data-collaboration-status-target="lastSave">
      <span data-collaboration-status-target="lastSaveText">
        Just now
      </span>
    </div>
  <% end %>

  <!-- Collaboration Info (detailed style only) -->
  <% if style == :detailed %>
    <div class="<%= divider_class %>" aria-hidden="true"></div>
    
    <div class="flex items-center space-x-1 text-xs text-creative-neutral-500 dark:text-creative-neutral-500">
      <!-- Users Count -->
      <div class="flex items-center space-x-1"
           data-collaboration-status-target="usersInfo">
        <svg class="w-3 h-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
        </svg>
        <span data-collaboration-status-target="activeUsersCount">
          1
        </span>
      </div>
    </div>
  <% end %>
</div>

<!-- Notification Toast (for status changes) -->
<div class="fixed top-4 right-4 z-50 transform transition-all duration-300 ease-out translate-x-full opacity-0"
     data-collaboration-status-target="notificationToast">
  <div class="bg-white dark:bg-creative-neutral-800 border border-creative-neutral-200 dark:border-creative-neutral-700 rounded-lg shadow-creative-lg px-4 py-3 flex items-center space-x-3">
    <!-- Notification Icon -->
    <div class="flex-shrink-0 w-5 h-5"
         data-collaboration-status-target="notificationIcon">
      <!-- Icon will be dynamically set -->
    </div>
    
    <!-- Notification Message -->
    <div class="flex-1">
      <p class="text-sm font-medium text-creative-neutral-900 dark:text-white"
         data-collaboration-status-target="notificationTitle">
        <!-- Title will be set dynamically -->
      </p>
      <p class="text-xs text-creative-neutral-600 dark:text-creative-neutral-400"
         data-collaboration-status-target="notificationMessage">
        <!-- Message will be set dynamically -->
      </p>
    </div>
    
    <!-- Close Button -->
    <button type="button"
            class="flex-shrink-0 text-creative-neutral-400 hover:text-creative-neutral-600 dark:hover:text-creative-neutral-200"
            data-collaboration-status-target="notificationClose"
            data-action="click->collaboration-status#closeNotification">
      <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
  </div>
</div>

<!-- Styles for collaboration status -->
<style>
  /* Base collaboration status styles */
  .collaboration-status {
    user-select: none;
    pointer-events: auto;
  }

  /* Status indicator animations */
  .collaboration-status .status-indicator {
    position: relative;
  }

  .collaboration-status .status-indicator.connected::after {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 50%;
    background: inherit;
    opacity: 0.3;
    animation: statusPulse 2s infinite;
  }

  .collaboration-status .status-indicator.syncing {
    animation: statusSpin 1s linear infinite;
  }

  /* Signal bars animations */
  .signal-bars .signal-bar {
    animation: signalFade 2s ease-in-out infinite;
  }

  .signal-bars .signal-bar:nth-child(1) { animation-delay: 0s; }
  .signal-bars .signal-bar:nth-child(2) { animation-delay: 0.2s; }
  .signal-bars .signal-bar:nth-child(3) { animation-delay: 0.4s; }
  .signal-bars .signal-bar:nth-child(4) { animation-delay: 0.6s; }

  /* Auto-hide functionality */
  .collaboration-status.auto-hide {
    transition: opacity 300ms ease-in-out, transform 300ms ease-in-out;
  }

  .collaboration-status.auto-hide.hidden {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
  }

  /* Notification toast animations */
  .notification-toast {
    transition: transform 300ms ease-out, opacity 300ms ease-out;
  }

  .notification-toast.show {
    transform: translateX(0);
    opacity: 1;
  }

  .notification-toast.hide {
    transform: translateX(100%);
    opacity: 0;
  }

  /* Hover effects */
  .collaboration-status:hover {
    transform: translateY(-1px);
    shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  /* Dark mode adjustments */
  @media (prefers-color-scheme: dark) {
    .collaboration-status {
      backdrop-filter: blur(10px) saturate(180%);
    }
    
    .collaboration-status:hover {
      shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2);
    }
  }

  /* Mobile responsive adjustments */
  @media (max-width: 640px) {
    .collaboration-status {
      position: fixed !important;
      bottom: 1rem !important;
      left: 1rem !important;
      right: 1rem !important;
      top: auto !important;
      width: auto !important;
      max-width: calc(100vw - 2rem);
    }
    
    .collaboration-status .divider {
      display: none;
    }
    
    .collaboration-status .detailed-only {
      display: none !important;
    }
    
    .notification-toast {
      position: fixed;
      top: 1rem;
      left: 1rem;
      right: 1rem;
      width: auto;
    }
  }

  /* High contrast mode */
  @media (prefers-contrast: high) {
    .collaboration-status {
      border-width: 2px;
    }
    
    .status-indicator {
      border: 1px solid currentColor;
    }
    
    .signal-bar {
      border: 1px solid currentColor;
    }
  }

  /* Reduced motion preferences */
  @media (prefers-reduced-motion: reduce) {
    .collaboration-status,
    .collaboration-status *,
    .notification-toast {
      animation: none !important;
      transition: none !important;
    }
    
    .status-indicator.connected::after {
      display: none;
    }
  }

  /* Keyframe animations */
  @keyframes statusPulse {
    0%, 100% {
      opacity: 0.3;
      transform: scale(1);
    }
    50% {
      opacity: 0.1;
      transform: scale(1.1);
    }
  }

  @keyframes statusSpin {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }

  @keyframes signalFade {
    0%, 100% {
      opacity: 0.7;
    }
    50% {
      opacity: 1;
    }
  }

  /* Focus management for accessibility */
  .collaboration-status:focus-within {
    outline: 2px solid theme('colors.creative.primary.500');
    outline-offset: 2px;
  }

  /* Print styles */
  @media print {
    .collaboration-status,
    .notification-toast {
      display: none !important;
    }
  }

  /* Performance optimizations */
  .collaboration-status,
  .status-indicator,
  .signal-bar,
  .notification-toast {
    will-change: transform, opacity;
    backface-visibility: hidden;
  }

  /* Tooltip styles for detailed information */
  .collaboration-status [data-tooltip] {
    position: relative;
  }

  .collaboration-status [data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 0.5rem;
    padding: 0.5rem;
    background: theme('colors.creative.neutral.900');
    color: white;
    font-size: 0.75rem;
    white-space: nowrap;
    border-radius: 0.375rem;
    z-index: 1000;
  }

  .collaboration-status [data-tooltip]:hover::before {
    content: '';
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 4px solid transparent;
    border-top-color: theme('colors.creative.neutral.900');
    z-index: 1000;
  }
</style>