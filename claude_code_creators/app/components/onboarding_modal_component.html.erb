<div class="<%= modal_class %>" 
     data-controller="onboarding-modal"
     data-onboarding-modal-current-step-value="<%= current_step %>"
     data-onboarding-modal-total-steps-value="<%= total_steps %>"
     data-onboarding-modal-user-id-value="<%= current_user.id %>"
     style="<%= show_modal ? '' : 'display: none;' %>"
     data-onboarding-modal-target="modal">
  
  <!-- Backdrop -->
  <div class="<%= backdrop_class %>" 
       data-action="click->onboarding-modal#close"
       data-onboarding-modal-target="backdrop"></div>
  
  <!-- Modal Content -->
  <div class="<%= content_class %>" data-onboarding-modal-target="content">
    <!-- Close Button -->
    <button class="<%= close_button_class %>"
            data-action="click->onboarding-modal#close"
            title="Close onboarding">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
      </svg>
    </button>
    
    <!-- Header -->
    <div class="<%= header_class %>">
      <!-- Progress Indicator -->
      <div class="<%= progress_class %>">
        <% (1..total_steps).each do |step| %>
          <div class="<%= progress_step_class(step) %>">
            <% if step < current_step %>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
              </svg>
            <% else %>
              <%= step %>
            <% end %>
          </div>
          <% unless step == total_steps %>
            <div class="<%= progress_line_class(step) %>"></div>
          <% end %>
        <% end %>
      </div>
      
      <!-- Step Title -->
      <div class="text-center">
        <div class="w-16 h-16 mx-auto mb-4 bg-creative-primary-100 dark:bg-creative-primary-900/30 rounded-2xl flex items-center justify-center">
          <svg class="w-8 h-8 text-creative-primary-600 dark:text-creative-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <%= render "shared/onboarding_icon", icon: step_content[:icon] %>
          </svg>
        </div>
        
        <h2 class="text-2xl font-bold text-creative-neutral-900 dark:text-creative-neutral-100 mb-2">
          <%= step_content[:title] %>
        </h2>
        
        <p class="text-creative-neutral-600 dark:text-creative-neutral-400">
          <%= step_content[:subtitle] %>
        </p>
      </div>
    </div>
    
    <!-- Body -->
    <div class="<%= body_class %>" data-onboarding-modal-target="stepContent">
      <% content = step_content[:content] %>
      
      <!-- Description -->
      <p class="text-creative-neutral-700 dark:text-creative-neutral-300 text-lg leading-relaxed mb-6">
        <%= content[:description] %>
      </p>
      
      <!-- Features (for steps 1-3) -->
      <% if content[:features] %>
        <div class="space-y-4 mb-6">
          <% content[:features].each do |feature| %>
            <div class="<%= feature_card_class %>">
              <div class="w-10 h-10 bg-creative-primary-100 dark:bg-creative-primary-900/30 rounded-lg flex items-center justify-center flex-shrink-0">
                <svg class="w-5 h-5 text-creative-primary-600 dark:text-creative-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <%= render "shared/onboarding_icon", icon: feature[:icon] %>
                </svg>
              </div>
              <div>
                <h4 class="font-semibold text-creative-neutral-900 dark:text-creative-neutral-100 mb-1">
                  <%= feature[:title] %>
                </h4>
                <p class="text-sm text-creative-neutral-600 dark:text-creative-neutral-400">
                  <%= feature[:description] %>
                </p>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
      
      <!-- Next Steps (for final step) -->
      <% if content[:next_steps] %>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
          <% content[:next_steps].each do |step| %>
            <%= link_to step[:url], 
                        class: action_card_class,
                        data: { 
                          action: "click->onboarding-modal#handleActionClick",
                          onboarding_action: step[:action]
                        } do %>
              <div class="w-12 h-12 bg-white dark:bg-creative-neutral-700 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-200">
                <svg class="w-6 h-6 text-creative-primary-600 dark:text-creative-primary-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <%= render "shared/onboarding_icon", icon: step[:icon] %>
                </svg>
              </div>
              
              <h4 class="font-semibold text-creative-neutral-900 dark:text-creative-neutral-100 mb-2">
                <%= step[:title] %>
              </h4>
              
              <p class="text-sm text-creative-neutral-600 dark:text-creative-neutral-400 mb-4">
                <%= step[:description] %>
              </p>
              
              <div class="text-sm font-medium text-creative-primary-600 dark:text-creative-primary-400">
                <%= step[:action] %> ‚Üí
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
      
      <!-- Tip -->
      <% if content[:tip] %>
        <div class="bg-creative-accent-amber/10 border border-creative-accent-amber/20 rounded-xl p-4">
          <p class="text-sm text-creative-neutral-700 dark:text-creative-neutral-300">
            <%= content[:tip] %>
          </p>
        </div>
      <% end %>
    </div>
    
    <!-- Footer -->
    <div class="<%= footer_class %>">
      <!-- Navigation -->
      <div class="flex items-center space-x-3">
        <% if can_go_previous? %>
          <button class="btn btn-outline"
                  data-action="click->onboarding-modal#previousStep">
            ‚Üê Previous
          </button>
        <% end %>
        
        <button class="btn btn-ghost text-creative-neutral-600 dark:text-creative-neutral-400"
                data-action="click->onboarding-modal#skipOnboarding">
          Skip Tour
        </button>
      </div>
      
      <!-- Progress Text & Next Button -->
      <div class="flex items-center space-x-4">
        <span class="text-sm text-creative-neutral-500 dark:text-creative-neutral-400">
          Step <%= current_step %> of <%= total_steps %>
        </span>
        
        <% if can_go_next? %>
          <button class="btn btn-primary"
                  data-action="click->onboarding-modal#nextStep">
            Next Step ‚Üí
          </button>
        <% else %>
          <button class="btn btn-primary"
                  data-action="click->onboarding-modal#completeOnboarding">
            Get Started! üöÄ
          </button>
        <% end %>
      </div>
    </div>
  </div>
</div>